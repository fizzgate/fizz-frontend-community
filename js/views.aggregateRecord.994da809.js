/*!
 * Fizz-Admin v2.6.6
 * (c) 2020-2022 Joker-Lee
 * AGPL v3 Licensed.
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views.aggregateRecord"],{"047b":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"发布","append-to-body":"",visible:t.visible,"before-close":t.handleClose,width:"500px"},on:{"update:visible":function(e){t.visible=e}}},[a("div",{staticClass:"b-tip"},[t._v("确定发布【"+t._s(t.name)+"】此接口吗?")]),a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"sub-title",staticStyle:{width:"80px"}},[t._v("备注：")]),a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入备注"},model:{value:t.remark,callback:function(e){t.remark=e},expression:"remark"}})],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small",loading:t.loading},on:{click:t.confirmPublish}},[t._v("确 定\n    ")]),a("el-button",{attrs:{size:"small"},on:{click:function(e){return t.handleClose()}}},[t._v("取 消")])],1)])},r=[],n=(a("c5f6"),a("708f")),o={name:"publish-dialog",data:function(){return{loading:!1,remark:""}},props:{visible:{type:Boolean,default:!1},name:{type:String,default:"*"},id:{type:[String,Number],required:!0},callback:{type:Function}},watch:{visible:function(t){t||(this.remark="")}},methods:{confirmPublish:function(){var t=this;if(this.id)return this.loading=!0,Object(n["k"])({id:this.id,remark:this.remark}).then((function(){t.callback&&"function"===typeof t.callback&&t.callback(),t.$message.success("发布成功"),t.$emit("update:visible",!1)})).finally((function(){t.loading=!1}));this.$message.error("信息错误，请重新选择！")},handleClose:function(t){this.$emit("update:visible",!1),t&&t()}}},l=o,s=(a("8138"),a("2877")),c=Object(s["a"])(l,i,r,!1,null,"47ee163f",null);e["default"]=c.exports},"0e71":function(t,e,a){"use strict";a("d691")},"0f43":function(t,e,a){"use strict";a.d(e,"f",(function(){return s})),a.d(e,"e",(function(){return c})),a.d(e,"j",(function(){return u})),a.d(e,"h",(function(){return p})),a.d(e,"c",(function(){return d})),a.d(e,"i",(function(){return f})),a.d(e,"g",(function(){return m})),a.d(e,"d",(function(){return g})),a.d(e,"b",(function(){return h})),a.d(e,"a",(function(){return b}));a("8e6e"),a("ac6a"),a("456d");var i=a("ade3"),r=a("b5c6"),n=a("da71");function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function l(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){Object(i["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var s=function(t,e,a){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply/listApply"),method:"get",params:l(l({},a),{},{current:t,size:e})})},c=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply/detail/").concat(t),method:"get"})},u=function(t){var e=t.applyId,a=t.configId,i=t.remark;return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply/revoke/").concat(e,"/").concat(a),method:"post",params:{remark:i}})},p=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply/revoke/").concat(t),method:"post"})},d=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply/exec/").concat(t),method:"post"})},f=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply/rollback/").concat(t),method:"post"})},m=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply/resubmit"),method:"post",data:t})},g=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply-config-op-log/list/").concat(t),method:"get"})},h=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply/change-approval-user"),method:"post",data:t})},b=function(){return Object(r["a"])({url:"".concat(n["a"],"/aggregate-apply/approval-by-oa"),method:"get"})}},"0f98":function(t,e,a){},"100c":function(t,e,a){},1120:function(t,e,a){},"11f5f":function(t,e,a){"use strict";a("3151")},"134f":function(t,e,a){"use strict";a.d(e,"b",(function(){return s})),a.d(e,"a",(function(){return c}));a("8e6e"),a("ac6a"),a("456d");var i=a("ade3"),r=a("b5c6"),n=a("da71");function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function l(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){Object(i["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var s=function(t,e,a){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply/listApproval"),method:"get",params:l(l({},a),{},{current:t,size:e})})},c=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply/approve"),method:"post",data:t})}},"163d":function(t,e,a){"use strict";a("5cf2")},"1a1f":function(t,e,a){"use strict";a.r(e);var i,r,n=a("0f43"),o={name:"apply",data:function(){return{form:{},query:{},loading:!0,page:{pageSize:10,currentPage:1,total:0},data:[],detailDialog:{visible:!1,data:[],id:""}}},watch:{data:function(){var t=this;this.$nextTick((function(){t.$refs.crud.refreshTable()}))}},methods:{rowView:function(t){var e=this;this.detailDialog.id=t.id,Object(n["e"])(this.detailDialog.id).then((function(t){e.detailDialog.data=t.data.data,e.detailDialog.visible=!0}))},searchReset:function(){this.option.column=this.option.column.map((function(t){return delete t.searchValue,t})),this.query={},this.onLoad(this.page)},searchChange:function(t,e){if(t.createTime&&t.createTime.length>0&&(t.createTimeStart=t.createTime[0]||"",t.createTimeEnd=t.createTime[1]||"",delete t.createTime),new Date(t.createTimeStart)>new Date(t.createTimeEnd))return this.$message.error("请选择结束时间晚于开始时间"),!1;this.query=t,this.page.currentPage=1,this.onLoad(this.page,t),e()},currentChange:function(t){this.page.currentPage=t},sizeChange:function(t){this.page.pageSize=t},refreshChange:function(){this.onLoad(this.page,this.query)}}},l=o,s=a("2877"),c=Object(s["a"])(l,i,r,!1,null,"562b71be",null);e["default"]=c.exports},"1e65":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("basic-container",[a("avue-crud",{ref:"crud",attrs:{data:t.data,page:t.page,search:t.search,option:t.option,"table-loading":t.loading,permission:t.permissionList},on:{"update:page":function(e){t.page=e},"update:search":function(e){t.search=e},"search-change":t.searchChange,"search-reset":t.searchReset,"current-change":t.currentChange,"size-change":t.sizeChange,"refresh-change":t.refreshChange,"on-load":t.onLoad},scopedSlots:t._u([{key:"createTimeSearch",fn:function(e){var i=e.size;return[a("datetime-range",{attrs:{defaultValue:t.search.createTime,"start-placeholder":"开始日期","end-placeholder":"结束日期",type:"datetime",size:i,defaultTime:["00:00:00","00:00:00"]},on:{"update:defaultValue":function(e){return t.$set(t.search,"createTime",e)},"update:default-value":function(e){return t.$set(t.search,"createTime",e)},change:function(e){return t.search.createTime=e}}})]}},{key:"type",fn:function(e){var a=e.row;return[t._v("\n      "+t._s((0===a.type?"发布":1===a.type&&"下线")||a.type)+"\n    ")]}},{key:"status",fn:function(e){var i=e.row;return[1===i.status?a("span",{staticClass:"color-danger"},[t._v("审核不通过")]):2===i.status?a("span",{staticClass:"color-success"},[t._v("审核通过")]):a("span",[t._v(t._s(0===i.status?"待审核":3===i.status&&"撤回"))])]}},{key:"menu",fn:function(e){var i=e.row,r=e.type,n=e.size;e.index;return[a("el-button",{attrs:{size:n,type:r},on:{click:function(e){return t.rowView(i)}}},[t._v("查看")]),t.permissionList.auditBtn&&0===i.status?a("el-button",{attrs:{size:n,type:r},on:{click:function(e){return t.rowAudit(i)}}},[t._v("审核")]):t._e()]}}])}),a("audit-detail",{attrs:{visible:t.detailDialog.visible,audit:!0,id:t.detailDialog.id,data:t.detailDialog.data,callback:t.refreshChange},on:{"update:visible":function(e){return t.$set(t.detailDialog,"visible",e)}}}),a("el-dialog",{attrs:{title:"["+t.auditDialog.title+"]-审核","append-to-body":"",visible:t.auditDialog.visible,width:"500px"},on:{"update:visible":function(e){return t.$set(t.auditDialog,"visible",e)}}},[a("el-form",{attrs:{size:"small","label-width":"100px"}},[a("el-form-item",{attrs:{label:"审核结果：",required:""}},[a("el-radio-group",{model:{value:t.auditDialog.type,callback:function(e){t.$set(t.auditDialog,"type",e)},expression:"auditDialog.type"}},t._l(t.auditState,(function(e){return a("el-radio",{key:e.value,attrs:{label:e.value}},[t._v(t._s(e.label))])})),1)],1),a("el-form-item",{attrs:{label:"审核备注："}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"审核备注（选填）"},model:{value:t.auditDialog.remark,callback:function(e){t.$set(t.auditDialog,"remark",e)},expression:"auditDialog.remark"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small",loading:t.auditDialog.loading},on:{click:t.auditConfirm}},[t._v("确 定\n      ")]),a("el-button",{attrs:{size:"small"},on:{click:function(e){t.auditDialog.visible=!1}}},[t._v("取 消")])],1)],1)],1)},r=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("ade3")),o=a("134f"),l=a("cec1"),s=a("5880"),c=a("1a1f"),u=a("218b"),p=a("8e7d");function d(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function f(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?d(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var m={data:function(){return{search:{},query:{status:0},option:{dialogWidth:900,border:!0,index:!0,addBtn:!1,editBtn:!1,delBtn:!1,columnBtn:!1,menuWidth:100,menuPosition:"right",column:[{label:"申请时间",prop:"createTime",searchRange:!0,search:!0,searchslot:!0,searchSpan:12,type:"datetime",valueFormat:"yyyy-MM-dd HH:mm:ss"},{label:"标题",prop:"title",search:!0,minWidth:180},{label:"操作类型",prop:"type",slot:!0,width:80},{label:"申请人",prop:"createBy"},{label:"审核状态",prop:"status",slot:!0,width:100,search:!0,type:"select",searchValue:0,dicData:l["a"]}]},auditDialog:{visible:!1,loading:!1,title:"",id:"",remark:""}}},mixins:[c["default"]],components:{auditDetail:u["default"],datetimeRange:p["default"]},computed:f(f({},Object(s["mapGetters"])(["permission"])),{},{permissionList:function(){return{auditBtn:this.vaildData(this.permission.aggregate_apply_audit,!1),viewBtn:this.vaildData(this.permission.aggregateRecord_audit_view,!1)}},auditState:function(){return l["b"]}}),methods:{rowView:function(t){this.detailDialog.id=t.id;var e="/aggregateRecord/auditDetail";this.$router.push({path:e,query:{originId:t.id}})},rowAudit:function(t){this.auditDialog.id=t.id,this.auditDialog.title=t.title,this.auditDialog.visible=!0},auditConfirm:function(){var t=this;if(!this.auditDialog.type)return this.$message.error("请选择审核结果"),!1;var e={};return e.id=this.auditDialog.id,e.approvalResult=this.auditDialog.type,e.approvalRemark=this.auditDialog.remark,this.auditDialog.loading=!0,Object(o["a"])(e).then((function(){t.$message.success("审核成功"),t.onLoad(t.page),t.auditDialog.visible=!1,t.auditDialog.loading=!1})).catch((function(){t.auditDialog.loading=!1}))},onLoad:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,Object(o["b"])(t.currentPage,t.pageSize,Object.assign(a,this.query)).then((function(t){var a=t.data.data;e.page.total=a.total,e.data=a.records,e.loading=!1}))}}},g=m,h=a("2877"),b=Object(h["a"])(g,i,r,!1,null,null,null);e["default"]=b.exports},"218b":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"audit-detail",attrs:{title:t.title,"append-to-body":"",top:"5vh",width:"60%",visible:t.visible,"before-close":t.handleClose},on:{"update:visible":function(e){t.visible=e}}},[a("div",{staticClass:"apply-table-wrap"},[a("div",{staticClass:"b-tip"},[t._v("操作以下接口：")]),a("el-table",{attrs:{data:t.tableData,border:"",stripe:"",size:"mini","max-height":"200"}},[a("el-table-column",{attrs:{prop:"serviceName",label:"所属服务"}}),a("el-table-column",{attrs:{prop:"name",label:"接口名"}})],1)],1),a("el-form",{ref:"auditForm",staticClass:"data-form",attrs:{model:t.auditForm,rules:t.rules,disabled:!t.permissionList.auditBtn,size:"mini","label-width":"100px"}},[a("el-form-item",{attrs:{label:"标题："}},[t._v("\n      "+t._s(t.auditForm.title)+"\n    ")]),a("el-form-item",{attrs:{label:"申请类型："}},[t._v("\n      "+t._s((0===t.auditForm.type?"发布":1===t.auditForm.type&&"下线")||t.auditForm.type||"-")+"\n    ")]),a("el-form-item",{attrs:{label:"申请原因："}},[t._v("\n      "+t._s(t.auditForm.reason)+"\n    ")]),a("el-form-item",{attrs:{label:"申请人："}},[t._v("\n      "+t._s(t.auditForm.applyBy||t.auditForm.createBy)+"\n    ")]),a("el-form-item",{attrs:{label:"申请时间："}},[t._v("\n      "+t._s(t.auditForm.createTime)+"\n    ")]),t.auditPermission?[a("el-form-item",{attrs:{label:"审核结果：",prop:"approvalResult",required:""}},[a("el-radio-group",{model:{value:t.auditForm.approvalResult,callback:function(e){t.$set(t.auditForm,"approvalResult",e)},expression:"auditForm.approvalResult"}},t._l(t.auditState,(function(e){return a("el-radio",{key:e.value,attrs:{label:e.value}},[t._v(t._s(e.label))])})),1)],1),a("el-form-item",{attrs:{label:"审核备注：",prop:"approvalRemark"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"审核备注（选填）"},model:{value:t.auditForm.approvalRemark,callback:function(e){t.$set(t.auditForm,"approvalRemark",e)},expression:"auditForm.approvalRemark"}})],1)]:[a("el-form-item",{attrs:{label:"审核人："}},[t._v("\n        "+t._s(t.auditForm.approvalBy)+"\n      ")]),a("el-form-item",{attrs:{label:"审核结果："}},[2===t.auditForm.approvalResult?a("el-tag",{attrs:{size:"mini",type:"success"}},[t._v("审核通过")]):1===t.auditForm.approvalResult?a("el-tag",{attrs:{size:"mini",type:"danger"}},[t._v("审核不通过")]):a("span",[t._v(t._s(t.auditForm.approvalResult))])],1),a("el-form-item",{attrs:{label:"审核备注："}},[t._v("\n        "+t._s(t.auditForm.approvalRemark)+"\n      ")]),a("el-form-item",{attrs:{label:"审核时间："}},[t._v("\n        "+t._s(t.auditForm.approvalTime)+"\n      ")])]],2),t.auditPermission?a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t.permissionList.auditBtn?a("el-button",{attrs:{type:"primary",size:"small",loading:t.loading},on:{click:t.confirm}},[t._v("审核\n    ")]):t._e(),a("el-button",{attrs:{size:"small"},on:{click:function(e){return t.handleClose()}}},[t._v("取消")])],1):t._e()],1)},r=[],n=(a("8e6e"),a("456d"),a("ac6a"),a("ade3")),o=(a("c5f6"),a("5880")),l=a("134f"),s=a("cec1");function c(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function u(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?c(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var p={name:"apply-detail",data:function(){return{loading:!1,tableData:[],auditForm:{type:"",remark:""}}},props:{visible:{type:Boolean,default:!1},title:{type:String,default:"发布|下线审核"},audit:{type:Boolean,default:!1},id:{type:[String,Number],required:!0},data:{type:Object,required:!0},callback:{type:Function}},computed:u(u({},Object(o["mapGetters"])(["permission"])),{},{permissionList:function(){return{auditBtn:this.vaildData(this.permission.aggregate_apply_audit,!1)}},auditState:function(){return s["b"]},auditPermission:function(){return this.permissionList.auditBtn&&this.audit&&0===this.auditForm.status||!1}}),components:{},watch:{data:{immediate:!0,handler:function(){this.init()}}},methods:{confirm:function(){var t=this;if(!this.auditForm.approvalResult)return this.$message.error("请选择审核结果"),!1;var e={};return e.id=this.auditForm.id,e.approvalResult=this.auditForm.approvalResult,e.approvalRemark=this.auditForm.approvalRemark,this.loading=!0,Object(l["a"])(e).then((function(){t.callback&&"function"===typeof t.callback&&t.callback(),t.$message.success("审核成功"),t.$emit("update:visible",!1),t.loading=!1})).catch((function(){t.loading=!1}))},init:function(){this.auditForm=this.data;var t=[];(this.data.configs||[]).forEach((function(e){t.push(Object.assign({id:e.configId,name:e.configName},e))})),this.tableData=t},handleClose:function(t){this.$emit("update:visible",!1),t&&t()}}},d=p,f=(a("7fc3"),a("5d17"),a("2877")),m=Object(f["a"])(d,i,r,!1,null,"2092a22f",null);e["default"]=m.exports},"227d":function(t,e,a){},"247e":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"apply-dialog",attrs:{title:t.title,"append-to-body":"",width:"80%",visible:t.visible,"before-close":t.handleClose},on:{"update:visible":function(e){t.visible=e}}},[a("div",{staticClass:"apply-table-wrap"},[a("div",{staticClass:"b-tip"},[t._v("\n      操作以下接口：\n      "),a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(e){t.drawer=!0}}},[t._v("添加")])],1),a("el-table",{staticStyle:{width:"100%"},attrs:{data:t.tableData,border:"",stripe:"",size:"mini","max-height":"240"}},[a("el-table-column",{attrs:{prop:"serviceName",label:"所属服务"}}),a("el-table-column",{attrs:{prop:"name",label:"接口名"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(e.row.name||e.row.configName)+"\n        ")]}}])}),a("el-table-column",{attrs:{fixed:"right",align:"center",label:"操作",width:"60"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.deleteRow(e.$index,t.tableData)}}},[t._v("\n            移除\n          ")])]}}])})],1)],1),a("el-form",{ref:"applyForm",attrs:{model:t.applyForm,rules:t.rules,size:"small","label-width":"120px"}},[a("el-form-item",{attrs:{label:"标题：",prop:"title"}},[a("el-input",{attrs:{placeholder:"发布|下线标题"},model:{value:t.applyForm.title,callback:function(e){t.$set(t.applyForm,"title",e)},expression:"applyForm.title"}})],1),a("el-form-item",{attrs:{label:"类型：",prop:"type"}},[a("el-radio-group",{model:{value:t.applyForm.type,callback:function(e){t.$set(t.applyForm,"type",e)},expression:"applyForm.type"}},[a("el-radio",{attrs:{label:0}},[t._v("发布")]),a("el-radio",{attrs:{label:1}},[t._v("下线")])],1)],1),a("el-form-item",{attrs:{label:"申请原因：",prop:"reason"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"申请原因"},model:{value:t.applyForm.reason,callback:function(e){t.$set(t.applyForm,"reason",e)},expression:"applyForm.reason"}})],1),t.isOA?t._e():a("el-form-item",{attrs:{label:"选择审核人：",prop:"approvalUser"}},[a("el-select",{attrs:{placeholder:"请选择审核人"},model:{value:t.applyForm.approvalUser,callback:function(e){t.$set(t.applyForm,"approvalUser",e)},expression:"applyForm.approvalUser"}},t._l(t.approvalUsers,(function(t){return a("el-option",{key:t.userId,attrs:{label:t.userName,value:t.userId}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small",loading:t.loading},on:{click:t.confirm}},[t._v("提交\n    ")]),a("el-button",{attrs:{size:"small"},on:{click:function(e){return t.handleClose()}}},[t._v("取 消")])],1),a("el-drawer",{ref:"drawer",attrs:{"append-to-body":"",title:"添加接口",size:"60%",visible:t.drawer},on:{"update:visible":function(e){t.drawer=e}}},[a("div",[a("div",{staticStyle:{"padding-bottom":"50px"}},[a("apply-api",{attrs:{selection:t.selectionApi},on:{"update:selection":function(e){t.selectionApi=e}}})],1),a("footer",{staticClass:"drawer-footer"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(e){return t.handleDrawerConfirm()}}},[t._v("确 定")]),a("el-button",{attrs:{size:"small"},on:{click:function(e){t.drawer=!1}}},[t._v("取 消")])],1)])])],1)},r=[],n=(a("4f7f"),a("5df3"),a("1c4c"),a("456d"),a("ac6a"),a("c5f6"),a("708f")),o=a("0f43"),l=a("6d18"),s={name:"publish-dialog",data:function(){return{loading:!1,drawer:!1,selectionApi:[],tableData:[],applyForm:{title:"",type:"",reason:"",approvalUser:""},approvalUsers:[],rules:{title:[{required:!0,message:"请输入申请标题",trigger:"blur"}],type:[{required:!0,message:"请选择申请类型",trigger:"change"}],approvalUser:[{required:!0,message:"请选择审核人",trigger:"change"}]},isOA:!1}},props:{visible:{type:Boolean,default:!1},list:{type:Array,default:function(){return[]}},form:{type:Object,default:function(){return{}}},id:{type:[Number,String]},callback:{type:Function}},computed:{title:function(){return this.id?"发布|下线申请修改":"发布|下线申请"},ids:function(){var t=[];return this.tableData.forEach((function(e){t.push(e.id||e.configId)})),t}},components:{applyApi:l["default"]},watch:{visible:{handler:function(t){t||(this.applyForm={title:"",type:"",reason:"",approvalUser:""})}},list:{deep:!0,handler:function(){this.initData()}},form:{deep:!0,handler:function(t){var e=this;Object.keys(this.applyForm).forEach((function(a){e.applyForm[a]=t[a]}))}},ids:{handler:function(){this.getApprovalUsers()}}},methods:{handleDrawerConfirm:function(){this.$refs.drawer.closeDrawer(),this.addData(this.selectionApi)},getApprovalUsers:function(){var t=this;if(!this.ids||0===this.ids.length)return!1;Object(n["e"])({configIds:this.ids}).then((function(e){var a=e.data.data;t.approvalUsers=a.approvalUsers||[],t.applyForm.approvalUser&&!t.approvalUsers.some((function(e){return e.userId===t.applyForm.approvalUser}))&&(t.applyForm.approvalUser="")}))},confirm:function(){var t=this;if(!this.ids||0===this.ids.length)return this.$message.warning("请选择至少一个接口"),!1;this.$refs.applyForm.validate((function(e){if(e){var a={};a.configIds=t.ids,a.title=t.applyForm.title,a.approvalUser=t.applyForm.approvalUser,a.type=t.applyForm.type,a.reason=t.applyForm.reason,t.loading=!0,t.id?(a.applyId=t.id,t.updateApply(a)):t.addApply(a)}}))},addApply:function(t){var e=this;return Object(n["b"])(t).then((function(){e.callback&&"function"===typeof e.callback&&e.callback(),e.$message.success("申请成功"),e.$emit("update:visible",!1),e.loading=!1})).catch((function(){e.loading=!1}))},updateApply:function(t){var e=this;return Object(o["g"])(t).then((function(){e.callback&&"function"===typeof e.callback&&e.callback(),e.$message.success("修改成功"),e.$emit("update:visible",!1),e.loading=!1})).catch((function(){e.loading=!1}))},deleteRow:function(t,e){e.splice(t,1)},initData:function(){this.tableData=this.list||[].concat(this.list)},addData:function(t){var e={},a=this.tableData.concat(t);a=Array.from(new Set(a)),a=a.reduce((function(t,a){var i=a.id||a.configId;return e[i]||(e[i]=!0,t.push(a)),t}),[]),this.tableData=a},handleClose:function(t){this.$emit("update:visible",!1),t&&t()},approvalByOa:function(){var t=this;Object(o["a"])().then((function(e){200==e.data.code&&(t.isOA=e.data.data)}))}},created:function(){this.approvalByOa()}},c=s,u=(a("8cb1"),a("3bae"),a("2877")),p=Object(u["a"])(c,i,r,!1,null,"0f487c47",null);e["default"]=p.exports},3151:function(t,e,a){},"340c":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("basic-container",[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"audit-detail"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("b",[t._v("发布|下线审核详情")])]),a("div",{staticClass:"apply-table-wrap"},[a("div",{staticClass:"b-tip"},[t._v("操作以下接口：")]),a("el-table",{attrs:{data:t.tableData,border:"",stripe:"",size:"mini","max-height":"200"}},[a("el-table-column",{attrs:{prop:"serviceName",label:"所属服务"}}),a("el-table-column",{attrs:{prop:"name",label:"接口名"}})],1)],1),a("el-form",{ref:"auditForm",staticClass:"data-form",attrs:{model:t.auditForm,rules:t.rules,disabled:!t.permissionList.auditBtn,size:"mini","label-width":"100px"}},[a("el-form-item",{attrs:{label:"标题："}},[t._v("\n        "+t._s(t.auditForm.title)+"\n      ")]),a("el-form-item",{attrs:{label:"申请类型："}},[t._v("\n        "+t._s((0===t.auditForm.type?"发布":1===t.auditForm.type&&"下线")||t.auditForm.type||"-")+"\n      ")]),a("el-form-item",{attrs:{label:"申请原因："}},[t._v("\n        "+t._s(t.auditForm.reason)+"\n      ")]),a("el-form-item",{attrs:{label:"申请人："}},[t._v("\n        "+t._s(t.auditForm.applyBy||t.auditForm.createBy)+"\n      ")]),a("el-form-item",{attrs:{label:"申请时间："}},[t._v("\n        "+t._s(t.auditForm.createTime)+"\n      ")]),t.auditPermission?[a("el-form-item",{attrs:{label:"审核结果：",prop:"approvalResult",required:""}},[a("el-radio-group",{model:{value:t.auditForm.approvalResult,callback:function(e){t.$set(t.auditForm,"approvalResult",e)},expression:"auditForm.approvalResult"}},t._l(t.auditState,(function(e){return a("el-radio",{key:e.value,attrs:{label:e.value}},[t._v(t._s(e.label))])})),1)],1),a("el-form-item",{attrs:{label:"审核备注：",prop:"approvalRemark"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"审核备注（选填）"},model:{value:t.auditForm.approvalRemark,callback:function(e){t.$set(t.auditForm,"approvalRemark",e)},expression:"auditForm.approvalRemark"}})],1)]:[a("el-form-item",{attrs:{label:"审核人："}},[t._v("\n          "+t._s(t.auditForm.approvalBy)+"\n        ")]),a("el-form-item",{attrs:{label:"审核结果："}},[2===t.auditForm.approvalResult?a("el-tag",{attrs:{size:"mini",type:"success"}},[t._v("审核通过")]):1===t.auditForm.approvalResult?a("el-tag",{attrs:{size:"mini",type:"danger"}},[t._v("审核不通过")]):a("span",[t._v(t._s(t.auditForm.approvalResult))])],1),a("el-form-item",{attrs:{label:"审核备注："}},[t._v("\n          "+t._s(t.auditForm.approvalRemark)+"\n        ")]),a("el-form-item",{attrs:{label:"审核时间："}},[t._v("\n          "+t._s(t.auditForm.approvalTime)+"\n        ")])]],2),t.auditPermission?a("footer",[t.permissionList.auditBtn?a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-circle-check",loading:t.loading},on:{click:t.confirm}},[t._v("审核\n      ")]):t._e(),a("el-button",{attrs:{size:"small",icon:"el-icon-circle-close"},on:{click:function(e){return t.handleClose()}}},[t._v("取消")])],1):t._e()],1)],1)},r=[],n=(a("8e6e"),a("456d"),a("ac6a"),a("ade3")),o=a("5880"),l=a("134f"),s=a("cec1"),c=a("0f43");function u(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function p(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?u(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var d={name:"audit-detail",data:function(){return{loading:!1,tableData:[],auditForm:{type:"",remark:""}}},computed:p(p({},Object(o["mapGetters"])(["permission"])),{},{permissionList:function(){return{auditBtn:this.vaildData(this.permission.aggregate_apply_audit,!1)}},auditState:function(){return s["b"]},auditPermission:function(){return this.permissionList.auditBtn&&0===this.auditForm.status||!1},originId:function(){return this.$route.query.originId||""}}),components:{},watch:{originId:{immediate:!0,handler:function(t){t&&this.init()}}},methods:{init:function(){var t=this;Object(c["e"])(this.originId).then((function(e){var a=e.data.data,i=[];t.auditForm=a,(a.configs||[]).forEach((function(t){i.push(Object.assign({id:t.configId,name:t.configName},t))})),t.tableData=i}))},confirm:function(){var t=this;if(!this.auditForm.approvalResult)return this.$message.error("请选择审核结果"),!1;var e={};return e.id=this.auditForm.id,e.approvalResult=this.auditForm.approvalResult,e.approvalRemark=this.auditForm.approvalRemark,this.loading=!0,Object(l["a"])(e).then((function(){t.init(),t.$message.success("审核成功"),t.loading=!1})).catch((function(){t.loading=!1}))},handleClose:function(){this.$router.$avueRouter.closeTag(),this.$router.push({path:"/aggregateRecord/audit"})}}},f=d,m=(a("39cf"),a("3b96"),a("2877")),g=Object(m["a"])(f,i,r,!1,null,"5382e071",null);e["default"]=g.exports},"39cf":function(t,e,a){"use strict";a("849e")},"3b96":function(t,e,a){"use strict";a("9542")},"3bae":function(t,e,a){"use strict";a("c640")},"480d":function(t,e,a){"use strict";a("100c")},"54b2":function(t,e,a){},"58a2":function(t,e,a){},"5a57":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"api-state-tag"},[a("el-badge",{attrs:{value:1===t.isModified?"改":""}},[0==t.currentState?a("el-tag",{attrs:{size:"small"}},[t._v("未发布")]):1==t.currentState?a("el-tag",{attrs:{size:"small",type:"success"}},[t._v("已发布")]):2==t.currentState?a("el-tag",{attrs:{size:"small",type:"danger"}},[t._v("已下线")]):t._e()],1),a("div",{staticClass:"color-warning"},[t._v(t._s(t.getApprovalStateName(t.approvalState)))])],1)},r=[],n=(a("7514"),a("c5f6"),a("f874")),o={name:"api-state-tag",props:{currentState:{required:!0,type:[String,Number]},approvalState:{required:!0,type:[String,Number]},isModified:{type:[String,Number]}},methods:{getApprovalStateName:function(t){if([0,5,6,7].some((function(e){return e===t})))return"";var e=n["b"].find((function(e){return parseInt(e.value)===t}));return e&&e.label||""}}},l=o,s=(a("a8eb"),a("795c"),a("2877")),c=Object(s["a"])(l,i,r,!1,null,"4014e4cc",null);e["default"]=c.exports},"5cf2":function(t,e,a){},"5d17":function(t,e,a){"use strict";a("c2ee")},"62bb0":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("basic-container",[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"audit-detail"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("b",[t._v("发布|下线申请详情")])]),a("div",{staticClass:"apply-table-wrap"},[a("div",{staticClass:"b-tip"},[t._v("操作以下接口：")]),a("el-table",{attrs:{data:t.tableData,border:"",stripe:"",size:"mini","max-height":"200"}},[a("el-table-column",{attrs:{prop:"serviceName",label:"所属服务"}}),a("el-table-column",{attrs:{prop:"name",label:"接口名"}}),a("el-table-column",{attrs:{align:"center",label:"状态",width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.formData.id===e.row.applyId?[t._v("\n              "+t._s(t.getApprovalStateName(e.row.approvalState))+"\n            ")]:[t._v("-")]]}}])}),2===t.formData.status?a("el-table-column",{attrs:{fixed:"right",align:"center",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.formData.id===e.row.applyId?[t.permissionList.publishBtn&&2===e.row.approvalState?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.publish(e.row)}}},[t._v("\n                发布\n              ")]):t._e(),t.permissionList.offlineBtn&&3===e.row.approvalState?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.offline(e.row)}}},[t._v("\n                下线\n              ")]):t._e(),!t.permissionList.revokeBtn||2!==e.row.approvalState&&3!==e.row.approvalState?t._e():a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.rowRevoke(e.row)}}},[t._v("\n                撤回\n              ")])]:t._e()]}}],null,!1,945224970)}):t._e()],1)],1),a("el-form",{staticClass:"data-form",attrs:{size:"mini","label-width":"100px"}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"标题："}},[t._v("\n            "+t._s(t.formData.title)+"\n          ")])],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请人："}},[t._v("\n            "+t._s(t.formData.createBy)+"\n          ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核人："}},[t._v("\n            "+t._s(t.formData.approvalBy)+"\n          ")])],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请类型："}},[t._v("\n            "+t._s((0===t.formData.type?"发布":1===t.formData.type&&"下线")||t.formData.type||"-")+"\n          ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核结果："}},[1===t.formData.approvalResult?a("el-tag",{attrs:{size:"mini",type:"danger"}},[t._v("审核不通过")]):2===t.formData.approvalResult?a("el-tag",{attrs:{size:"mini",type:"success"}},[t._v("审核通过")]):a("span",[t._v(t._s(t.formData.approvalResult))])],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请原因："}},[t._v("\n            "+t._s(t.formData.reason)+"\n          ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核备注："}},[t._v("\n            "+t._s(t.formData.approvalRemark)+"\n          ")])],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请时间："}},[t._v("\n            "+t._s(t.formData.createTime)+"\n          ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核时间："}},[t._v("\n            "+t._s(t.formData.approvalTime)+"\n          ")])],1)],1)],1),t.logData&&0!==t.logData.length?[a("el-divider",[t._v("操作日志")]),a("el-table",{attrs:{data:t.logData,border:"",stripe:"",size:"mini","max-height":"300"}},[a("el-table-column",{attrs:{align:"center",label:"操作类型",width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t.getOpTypeName(e.row.opType))+"\n          ")]}}],null,!1,3264585741)}),a("el-table-column",{attrs:{prop:"serviceName",label:"所属服务"}}),a("el-table-column",{attrs:{prop:"name",label:"接口名"}}),a("el-table-column",{attrs:{prop:"opBy",label:"操作人"}}),a("el-table-column",{attrs:{prop:"opTime",label:"操作时间"}}),a("el-table-column",{attrs:{prop:"remark",label:"备注"}})],1)]:t._e(),0===t.formData.status||2===t.formData.status?a("footer",[2===t.formData.status?[t.permissionList.rollback?a("el-button",{attrs:{type:"primary",size:"small",loading:t.rollbackLoading,plain:""},on:{click:t.rollback}},[t._v("\n          批量回滚\n        ")]):t._e(),0===t.formData.type&&t.permissionList.batchPublishBtn||1===t.formData.type&&t.permissionList.batchOfflineBtn?a("el-button",{attrs:{type:"primary",size:"small",loading:t.executeLoading,plain:""},on:{click:t.execute}},[t._v("\n          "+t._s((0===t.formData.type?"批量发布":1===t.formData.type&&"批量下线")||"批量执行")+"\n        ")]):t._e()]:t._e(),0!==t.formData.status||t.isOA?t._e():[t.permissionList.applyBtn?a("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:t.changeAudit}},[t._v("\n          修改审核人\n        ")]):t._e(),t.permissionList.revokeBtn?a("el-button",{attrs:{type:"primary",size:"small",loading:t.revokeLoading},on:{click:t.revoke}},[t._v("撤回\n        ")]):t._e()],a("el-button",{attrs:{size:"small"},on:{click:function(e){return t.handleClose()}}},[t._v("返回")])],2):t._e(),a("revoke-dialog",{attrs:{visible:t.revokeDialog.visible,form:t.revokeDialog.form,id:t.revokeDialog.id,callback:t.init},on:{"update:visible":function(e){return t.$set(t.revokeDialog,"visible",e)}}}),a("publish-dialog",{attrs:{visible:t.publishDialog.visible,name:t.publishDialog.name,id:t.publishDialog.id,callback:t.init},on:{"update:visible":function(e){return t.$set(t.publishDialog,"visible",e)}}}),a("el-dialog",{attrs:{"append-to-body":"",title:"修改审核人",visible:t.auditDialogVisible},on:{"update:visible":function(e){t.auditDialogVisible=e}}},[a("el-form",{attrs:{model:t.auditForm,size:"small"}},[a("el-form-item",{attrs:{label:"审核人"}},[a("el-select",{attrs:{placeholder:"请选择审核人"},model:{value:t.auditForm.approvalUser,callback:function(e){t.$set(t.auditForm,"approvalUser",e)},expression:"auditForm.approvalUser"}},t._l(t.approvalUsers,(function(t){return a("el-option",{key:t.userId,attrs:{label:t.userName,value:t.userId}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleAuditChange}},[t._v("确 定")]),a("el-button",{attrs:{size:"small"},on:{click:function(e){t.auditDialogVisible=!1}}},[t._v("取 消")])],1)],1)],2)],1)},r=[],n=(a("8e6e"),a("456d"),a("7f7f"),a("7514"),a("ac6a"),a("ade3")),o=a("0f43"),l=a("708f"),s=a("f874"),c=a("cec1"),u=a("5880"),p=a("047b"),d=a("c43f");function f(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function m(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?f(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var g={name:"apply-detail",data:function(){return{revokeLoading:!1,executeLoading:!1,rollbackLoading:!1,tableData:[],logData:[],approvalUsers:[],formData:{},publishDialog:{visible:!1,title:"接口",name:"",id:""},revokeDialog:{visible:!1,form:{},id:""},auditForm:{applyId:"",approvalUser:""},auditDialogVisible:!1,isOA:!1}},computed:m(m({},Object(u["mapGetters"])(["permission"])),{},{permissionList:function(){return{applyBtn:this.vaildData(this.permission.aggregate_api_apply,!1),publishBtn:this.vaildData(this.permission.aggregate_api_publish,!1),offlineBtn:this.vaildData(this.permission.aggregate_api_offline,!1),batchPublishBtn:this.vaildData(this.permission.aggregate_apply_batchPublish,!1),batchOfflineBtn:this.vaildData(this.permission.aggregate_apply_batchOffline,!1),revokeBtn:this.vaildData(this.permission.aggregate_apply_revoke,!1),rollback:this.vaildData(this.permission.aggregate_apply_rollback,!1)}},ids:function(){var t=[];return this.tableData.forEach((function(e){t.push(e.id||e.configId)})),t},originId:function(){return this.$route.query.originId||""}}),components:{publishDialog:p["default"],revokeDialog:d["default"]},watch:{originId:{immediate:!0,handler:function(t){t&&this.init()}}},methods:{getOpTypeName:function(t){var e=c["c"].find((function(e){return parseInt(e.value)===t}));return e&&e.label||t},getApprovalStateName:function(t){var e=s["b"].find((function(e){return parseInt(e.value)===t}));return e&&e.label||""},getApprovalUsers:function(){var t=this;if(!this.ids||0===this.ids.length)return!1;Object(l["e"])({configIds:this.ids}).then((function(e){var a=e.data.data;t.approvalUsers=a.approvalUsers||[]}))},handleAuditChange:function(){var t=this;this.auditDialogVisible=!1;var e={};return e.applyId=this.auditForm.applyId,e.approvalUserId=this.auditForm.approvalUser,Object(o["b"])(e).then((function(){t.$message.success("修改成功"),t.init(),t.auditDialogVisible=!1}))},changeAudit:function(){this.getApprovalUsers(),this.auditForm.applyId=this.formData.id,this.auditForm.approvalUser=this.formData.approvalUser,this.auditDialogVisible=!0},rowRevoke:function(t){this.revokeDialog.id=this.originId,this.revokeDialog.visible=!0,this.revokeDialog.form=t},revoke:function(){var t=this;this.$confirm("确定撤回该申请?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return t.revokeLoading=!0,Object(o["h"])(t.originId).then((function(){t.$message.success("撤回成功"),t.init(),t.revokeLoading=!1})).catch((function(){t.revokeLoading=!1}))}))},execute:function(){var t=this;this.$confirm("确定批量执行该申请的操作?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return t.executeLoading=!0,Object(o["c"])(t.originId).then((function(){t.$message.success("操作成功"),t.init(),t.executeLoading=!1})).catch((function(){t.executeLoading=!1}))}))},rollback:function(){var t=this;this.$confirm("确定批量回滚该申请的操作?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return t.rollbackLoading=!0,Object(o["i"])(t.originId).then((function(){t.init(),t.$message.success("回滚成功"),t.rollbackLoading=!1})).catch((function(){t.rollbackLoading=!1}))}))},offline:function(t){var e=this;this.$confirm("确定下线【".concat(t.name,"】此接口吗?"),{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return Object(l["i"])(t.id)})).then((function(){e.$message.success("下线成功"),e.init()}))},publish:function(t){t.id?(this.publishDialog.visible=!0,this.publishDialog.name=t.name,this.publishDialog.id=t.id):this.$message.error("数据缺失，无法发布！")},handleClose:function(){this.$router.$avueRouter.closeTag(),this.$router.push({path:"/aggregateRecord/apply"})},getApplyLog:function(){var t=this;return this.logData=[],Object(o["d"])(this.originId).then((function(e){t.logData=e.data.data}))},getDetail:function(){var t=this;Object(o["e"])(this.originId).then((function(e){var a=e.data.data,i=[];t.formData=a,(a.configs||[]).forEach((function(t){i.push(Object.assign({id:t.configId,name:t.configName},t))})),t.tableData=i}))},init:function(){this.getDetail(),this.getApplyLog()},approvalByOa:function(){var t=this;Object(o["a"])().then((function(e){200==e.data.code&&(t.isOA=e.data.data)}))}},created:function(){this.approvalByOa()}},h=g,b=(a("0e71"),a("480d"),a("2877")),v=Object(b["a"])(h,i,r,!1,null,"424fed57",null);e["default"]=v.exports},6356:function(t,e,a){"use strict";a("b3f0")},"6d18":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("basic-container",{staticClass:"apply-api"},[a("avue-crud",{ref:"crud",attrs:{data:t.data,page:t.page,option:t.option,"table-loading":t.loading,"cell-class-name":"api-cell"},on:{"update:page":function(e){t.page=e},"search-change":t.searchChange,"search-reset":t.searchReset,"selection-change":t.selectionChange,"current-change":t.currentChange,"size-change":t.sizeChange,"refresh-change":t.refreshChange,"on-load":t.onLoad},scopedSlots:t._u([{key:"currentState",fn:function(t){var e=t.row;return[a("api-state-tag",{attrs:{"is-modified":e.isModified,"current-state":e.currentState,"approval-state":e.approvalState}})]}}])})],1)},r=[],n=(a("ac6a"),a("708f")),o=a("f874"),l=a("5a57"),s={data:function(){return{query:{},loading:!0,page:{pageSize:10,currentPage:1,total:0},selectionList:[],option:{size:"mini",border:!0,selection:!0,tip:!1,columnBtn:!1,addBtn:!1,menu:!1,menuPosition:"right",searchGutter:"0",selectable:function(t){return![1,2,3].some((function(e){return t.approvalState===e}))},column:[{label:"所属服务",prop:"serviceName",search:!0,searchSpan:12},{label:"接口名",prop:"name",minWidth:120,search:!0,searchSpan:12},{label:"方法",prop:"method",width:80},{label:"路径",prop:"path",minWidth:120,search:!0,searchSpan:12},{label:"开发人员",prop:"developer"},{label:"状态",prop:"currentState",slot:!0,width:100,align:"center",search:!0,type:"select",dicData:o["a"],searchSpan:12}]},data:[]}},props:{selection:{type:[Object,Array]}},components:{apiStateTag:l["default"]},computed:{ids:function(){var t=[];return this.selectionList.forEach((function(e){t.push(e.id)})),t.join(",")}},watch:{selectionList:{deep:!0,handler:function(){this.emitData()}}},methods:{emitData:function(){this.$emit("update:selection",this.selectionList)},searchReset:function(){this.query={},this.onLoad(this.page)},searchChange:function(t,e){this.query=t,this.page.currentPage=1,this.onLoad(this.page,t),e()},selectionChange:function(t){this.selectionList=t},selectionClear:function(){this.selectionList=[],this.$refs.crud.toggleSelection()},currentChange:function(t){this.page.currentPage=t},sizeChange:function(t){this.page.pageSize=t},refreshChange:function(){this.onLoad(this.page,this.query)},onLoad:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,Object(n["g"])(t.currentPage,t.pageSize,Object.assign(a,this.query)).then((function(t){var a=t.data.data;e.page.total=a.total,e.data=a.records,e.loading=!1,e.selectionClear()}))}}},c=s,u=(a("dbd4"),a("78bb"),a("2877")),p=Object(u["a"])(c,i,r,!1,null,"71d8cb96",null);e["default"]=p.exports},7050:function(t,e,a){"use strict";a("94a6")},7079:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"apply-detail",attrs:{title:"发布|下线申请","append-to-body":"",top:"5vh",width:"70%",visible:t.visible,"before-close":t.handleClose},on:{"update:visible":function(e){t.visible=e}}},[a("div",{staticClass:"apply-table-wrap"},[a("div",{staticClass:"b-tip"},[t._v("操作以下接口：")]),a("el-table",{attrs:{data:t.tableData,border:"",stripe:"",size:"mini","max-height":"200"}},[a("el-table-column",{attrs:{prop:"serviceName",label:"所属服务"}}),a("el-table-column",{attrs:{prop:"name",label:"接口名"}}),a("el-table-column",{attrs:{align:"center",label:"状态",width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.formData.id===e.row.applyId?[t._v("\n            "+t._s(t.getApprovalStateName(e.row.approvalState))+"\n          ")]:[t._v("-")]]}}])}),2===t.formData.status?a("el-table-column",{attrs:{fixed:"right",align:"center",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.formData.id===e.row.applyId?[t.permissionList.publishBtn&&2===e.row.approvalState?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.publish(e.row)}}},[t._v("\n              发布\n            ")]):t._e(),t.permissionList.offlineBtn&&3===e.row.approvalState?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.offline(e.row)}}},[t._v("\n              下线\n            ")]):t._e(),!t.permissionList.revokeBtn||2!==e.row.approvalState&&3!==e.row.approvalState?t._e():a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.rowRevoke(e.row)}}},[t._v("\n              撤回\n            ")])]:t._e()]}}],null,!1,4163813898)}):t._e()],1)],1),a("el-form",{staticClass:"data-form",attrs:{size:"mini","label-width":"100px"}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"标题："}},[t._v("\n          "+t._s(t.formData.title)+"\n        ")])],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请人："}},[t._v("\n          "+t._s(t.formData.createBy)+"\n        ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核人："}},[t._v("\n          "+t._s(t.formData.approvalBy)+"\n        ")])],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请类型："}},[t._v("\n          "+t._s((0===t.formData.type?"发布":1===t.formData.type&&"下线")||t.formData.type||"-")+"\n        ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核结果："}},[1===t.formData.approvalResult?a("el-tag",{attrs:{size:"mini",type:"danger"}},[t._v("审核不通过")]):2===t.formData.approvalResult?a("el-tag",{attrs:{size:"mini",type:"success"}},[t._v("审核通过")]):a("span",[t._v(t._s(t.formData.approvalResult))])],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请原因："}},[t._v("\n          "+t._s(t.formData.reason)+"\n        ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核备注："}},[t._v("\n          "+t._s(t.formData.approvalRemark)+"\n        ")])],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请时间："}},[t._v("\n          "+t._s(t.formData.createTime)+"\n        ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核时间："}},[t._v("\n          "+t._s(t.formData.approvalTime)+"\n        ")])],1)],1)],1),t.logData&&0!==t.logData.length?[a("el-divider",[t._v("操作日志")]),a("el-table",{attrs:{data:t.logData,border:"",stripe:"",size:"mini","max-height":"300"}},[a("el-table-column",{attrs:{align:"center",label:"操作类型",width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(t.getOpTypeName(e.row.opType))+"\n        ")]}}],null,!1,3314202637)}),a("el-table-column",{attrs:{prop:"serviceName",label:"所属服务"}}),a("el-table-column",{attrs:{prop:"name",label:"接口名"}}),a("el-table-column",{attrs:{prop:"opBy",label:"操作人"}}),a("el-table-column",{attrs:{prop:"opTime",label:"操作时间"}}),a("el-table-column",{attrs:{prop:"remark",label:"备注"}})],1)]:t._e(),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[2===t.formData.status?[t.permissionList.rollback?a("el-button",{attrs:{type:"primary",size:"small",loading:t.rollbackLoading,plain:""},on:{click:t.rollback}},[t._v("\n        批量回滚\n      ")]):t._e(),0===t.formData.type&&t.permissionList.batchPublishBtn||1===t.formData.type&&t.permissionList.batchOfflineBtn?a("el-button",{attrs:{type:"primary",size:"small",loading:t.executeLoading,plain:""},on:{click:t.execute}},[t._v("\n        "+t._s((0===t.formData.type?"批量发布":1===t.formData.type&&"批量下线")||"批量执行")+"\n      ")]):t._e()]:t._e(),0===t.formData.status?[t.permissionList.applyBtn?a("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:t.changeAudit}},[t._v("\n        修改审核人\n      ")]):t._e(),t.permissionList.revokeBtn?a("el-button",{attrs:{type:"primary",size:"small",loading:t.revokeLoading},on:{click:t.revoke}},[t._v("撤回\n      ")]):t._e()]:t._e(),a("el-button",{attrs:{size:"small"},on:{click:function(e){return t.handleClose()}}},[t._v("取消")])],2),a("revoke-dialog",{attrs:{visible:t.revokeDialog.visible,form:t.revokeDialog.form,id:t.revokeDialog.id,callback:t.revokeCallback},on:{"update:visible":function(e){return t.$set(t.revokeDialog,"visible",e)}}}),a("publish-dialog",{attrs:{visible:t.publishDialog.visible,name:t.publishDialog.name,id:t.publishDialog.id,callback:t.publishCallback},on:{"update:visible":function(e){return t.$set(t.publishDialog,"visible",e)}}}),a("el-dialog",{attrs:{"append-to-body":"",title:"修改审核人",visible:t.auditDialogVisible},on:{"update:visible":function(e){t.auditDialogVisible=e}}},[a("el-form",{attrs:{model:t.auditForm,size:"small"}},[a("el-form-item",{attrs:{label:"审核人"}},[a("el-select",{attrs:{placeholder:"请选择审核人"},model:{value:t.auditForm.approvalUser,callback:function(e){t.$set(t.auditForm,"approvalUser",e)},expression:"auditForm.approvalUser"}},t._l(t.approvalUsers,(function(t){return a("el-option",{key:t.userId,attrs:{label:t.userName,value:t.userId}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleAuditChange}},[t._v("确 定")]),a("el-button",{attrs:{size:"small"},on:{click:function(e){t.auditDialogVisible=!1}}},[t._v("取 消")])],1)],1)],2)},r=[],n=(a("8e6e"),a("456d"),a("7f7f"),a("7514"),a("ac6a"),a("ade3")),o=(a("c5f6"),a("0f43")),l=a("708f"),s=a("4870"),c=a("5880"),u=a("047b"),p=a("c43f");function d(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function f(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?d(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var m={name:"apply-detail",data:function(){return{revokeLoading:!1,executeLoading:!1,rollbackLoading:!1,tableData:[],logData:[],approvalUsers:[],formData:{},publishDialog:{visible:!1,title:"接口",name:"",id:""},revokeDialog:{visible:!1,form:{},id:""},auditForm:{applyId:"",approvalUser:""},auditDialogVisible:!1}},props:{visible:{type:Boolean,default:!1},id:{type:[String,Number],required:!0},data:{type:Object,required:!0},callback:{type:Function}},computed:f(f({},Object(c["mapGetters"])(["permission"])),{},{permissionList:function(){return{applyBtn:this.vaildData(this.permission.aggregate_api_apply,!1),publishBtn:this.vaildData(this.permission.aggregate_api_publish,!1),offlineBtn:this.vaildData(this.permission.aggregate_api_offline,!1),batchPublishBtn:this.vaildData(this.permission.aggregate_apply_batchPublish,!1),batchOfflineBtn:this.vaildData(this.permission.aggregate_apply_batchOffline,!1),revokeBtn:this.vaildData(this.permission.aggregate_apply_revoke,!1),rollback:this.vaildData(this.permission.aggregate_apply_rollback,!1)}},ids:function(){var t=[];return this.tableData.forEach((function(e){t.push(e.id||e.configId)})),t}}),components:{publishDialog:u["default"],revokeDialog:p["default"]},watch:{visible:function(t){t&&this.getApplyLog()},data:{immediate:!0,handler:function(){this.init()}}},methods:{getOpTypeName:function(t){var e=s["e"].find((function(e){return parseInt(e.value)===t}));return e&&e.label||t},getApprovalStateName:function(t){var e=s["d"].find((function(e){return parseInt(e.value)===t}));return e&&e.label||""},getApprovalUsers:function(){var t=this;if(!this.ids||0===this.ids.length)return!1;Object(l["e"])({configIds:this.ids}).then((function(e){var a=e.data.data;t.approvalUsers=a.approvalUsers||[]}))},handleAuditChange:function(){var t=this;this.auditDialogVisible=!1;var e={};return e.applyId=this.auditForm.applyId,e.approvalUserId=this.auditForm.approvalUser,Object(o["b"])(e).then((function(){t.$message.success("修改成功"),t.auditDialogVisible=!1,setTimeout((function(){t.handleClose(),t.callback&&"function"===typeof t.callback&&t.callback()}),300)}))},changeAudit:function(){this.getApprovalUsers(),this.auditForm.applyId=this.formData.id,this.auditForm.approvalUser=this.formData.approvalUser,this.auditDialogVisible=!0},rowRevoke:function(t){this.revokeDialog.id=this.id,this.revokeDialog.visible=!0,this.revokeDialog.form=t},revoke:function(){var t=this;this.$confirm("确定撤回该申请?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return t.revokeLoading=!0,Object(o["h"])(t.id).then((function(){t.callback&&"function"===typeof t.callback&&t.callback(),t.$message.success("撤回成功"),t.$emit("update:visible",!1),t.revokeLoading=!1})).catch((function(){t.revokeLoading=!1}))}))},revokeCallback:function(){this.changeState(this.revokeDialog.form.id,7),this.getApplyLog()},execute:function(){var t=this;this.$confirm("确定批量执行该申请的操作?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return t.executeLoading=!0,Object(o["c"])(t.id).then((function(){t.callback&&"function"===typeof t.callback&&t.callback(),t.$message.success("操作成功"),t.$emit("update:visible",!1),t.executeLoading=!1})).catch((function(){t.executeLoading=!1}))}))},rollback:function(){var t=this;this.$confirm("确定批量回滚该申请的操作?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return t.rollbackLoading=!0,Object(o["i"])(t.id).then((function(){t.callback&&"function"===typeof t.callback&&t.callback(),t.$message.success("回滚成功"),t.$emit("update:visible",!1),t.rollbackLoading=!1})).catch((function(){t.rollbackLoading=!1}))}))},offline:function(t){var e=this;this.$confirm("确定下线【".concat(t.name,"】此接口吗?"),{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return Object(l["i"])(t.id)})).then((function(){e.$message({type:"success",message:"下线成功"}),e.changeState(t.id)}))},publish:function(t){t.id?(this.publishDialog.visible=!0,this.publishDialog.name=t.name,this.publishDialog.id=t.id):this.$message.error("数据缺失，无法发布！")},publishCallback:function(){this.changeState(this.publishDialog.id)},changeState:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;this.tableData.map((function(a){if(a.id===t)return a.approvalState=e,a}))},init:function(){this.formData=this.data;var t=[];(this.data.configs||[]).forEach((function(e){t.push(Object.assign({id:e.configId,name:e.configName},e))})),this.tableData=t},handleClose:function(t){this.$emit("update:visible",!1),t&&t()},getApplyLog:function(){var t=this;return this.logData=[],Object(o["d"])(this.id).then((function(e){t.logData=e.data.data}))}}},g=m,h=(a("6356"),a("163d"),a("2877")),b=Object(h["a"])(g,i,r,!1,null,"0c56b194",null);e["default"]=b.exports},"708f":function(t,e,a){"use strict";a.d(e,"g",(function(){return s})),a.d(e,"f",(function(){return c})),a.d(e,"l",(function(){return u})),a.d(e,"a",(function(){return p})),a.d(e,"m",(function(){return d})),a.d(e,"k",(function(){return f})),a.d(e,"i",(function(){return m})),a.d(e,"b",(function(){return g})),a.d(e,"e",(function(){return h})),a.d(e,"d",(function(){return b})),a.d(e,"h",(function(){return v})),a.d(e,"j",(function(){return y})),a.d(e,"c",(function(){return O}));a("8e6e"),a("ac6a"),a("456d"),a("a481");var i=a("ade3"),r=a("b5c6"),n=a("da71");function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function l(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){Object(i["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var s=function(t,e,a){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-config/aggregateconfig/list"),method:"get",params:l(l({},a),{},{current:t,size:e})})},c=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-config/aggregateconfig/detail"),method:"get",params:{id:t}})},u=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-config/aggregateconfig/remove"),method:"post",params:{ids:t}})},p=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-config/aggregateconfig/save"),method:"post",data:t})},d=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-config/aggregateconfig/update"),method:"post",data:t})},f=function(t){var e=t.id,a=void 0===e?"":e,i=t.remark,o=void 0===i?"":i;return Object(r["a"])({url:"".concat(n["a"],"/aggregate/publish"),method:"post",params:{id:a,remark:o}})},m=function(t){return Object(r["a"])({url:"".concat(n["a"],"/aggregate/offline"),method:"post",params:{ids:t}})},g=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply/save"),method:"post",data:t})},h=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply/getApprovalUsers"),method:"post",data:t})},b=function(t){return Object(r["a"])({url:"".concat(n["a"],"/aggregate/export"),method:"post",params:{ids:t},responseType:"blob"}).then((function(t){var e=new Blob([t.data],{type:"application/json;charset=utf-8"});if(window.navigator.msSaveBlob)window.navigator.msSaveBlob(e,unescape(t.headers.filename.replace(/\\u/g,"%u")));else{var a=document.createElement("a"),i=window.URL.createObjectURL(e);a.href=i,a.download=unescape(t.headers.filename.replace(/\\u/g,"%u")),document.body.appendChild(a),a.click(),document.body.removeChild(a),window.URL.revokeObjectURL(i)}}))},v=function(t){return Object(r["a"])({url:"".concat(n["a"],"/aggregate/import"),method:"post",data:t})},y=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-config/aggregateconfig/turn-on-debug-mode"),method:"post",params:{ids:t}})},O=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-config/aggregateconfig/turn-off-debug-mode"),method:"post",params:{ids:t}})}},"78bb":function(t,e,a){"use strict";a("92c9")},"795c":function(t,e,a){"use strict";a("58a2")},"7ec3":function(t,e,a){"use strict";a("0f98")},"7fc3":function(t,e,a){"use strict";a("a945")},8138:function(t,e,a){"use strict";a("1120")},"849e":function(t,e,a){},"8cb1":function(t,e,a){"use strict";a("c0c5")},"8e7d":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"datatime-range",class:t.className},[a("div",{staticClass:"picker-item"},[a("el-date-picker",{attrs:{type:t.type,placeholder:t.startPlaceholder,align:"right","picker-options":t.startPickerOptions,clearable:t.startClear,readonly:t.readonly,"value-format":t.valueFormat,size:t.size,"default-time":t.defaultTime[0]},on:{change:t.changeTime},model:{value:t.startTime,callback:function(e){t.startTime=e},expression:"startTime"}})],1),a("span",{staticClass:"interval"},[t._v("-")]),a("div",{staticClass:"picker-item"},[a("el-date-picker",{attrs:{type:t.type,placeholder:t.endPlaceholder,align:"right","picker-options":t.endPickerOptions,clearable:t.endClear,readonly:t.readonly,"value-format":t.valueFormat,size:t.size,"default-time":t.defaultTime[1]},on:{change:t.changeTime},model:{value:t.endTime,callback:function(e){t.endTime=e},expression:"endTime"}})],1)])},r=[],n=(a("6b54"),a("6762"),a("2fdb"),{name:"datatime-range",props:{className:{type:String,default:""},readonly:{type:Boolean,default:!1},size:{type:String,default:"small",validator:function(t){return-1!==["large","small","mini"].indexOf(t)}},type:{type:String,default:"datetime",validator:function(t){return-1!==["year","month","date","week","datetime"].indexOf(t)}},defaultValue:{type:Array,default:function(){return["",""]}},valueFormat:{type:String,default:"yyyy-MM-dd HH:mm:ss"},startOptions:{type:Object,default:function(){return{}}},endOptions:{type:Object,default:function(){return{}}},notMaxtTodayStart:{type:Boolean,default:!0},notMaxtTodayEnd:{type:Boolean,default:!0},startPlaceholder:{type:String,default:"请选择开始时间"},endPlaceholder:{type:String,default:"请选择结束时间"},defaultTime:{type:String|Array,default:function(t){return"string"===typeof t?[t,t]:t||["",""]}},clearable:{type:Boolean,default:!0},startClearable:{},endClearable:{}},computed:{startPickerOptions:function(){return["date","datetime"].includes(this.type)?Object.assign({},this.beginDate(),this.defaultOption,this.startOptions):Object.assign({},this.defaultOption,this.startOptions)},endPickerOptions:function(){return["date","datetime"].includes(this.type)?Object.assign({},this.processDate(),this.defaultOption,this.endOptions):Object.assign({},this.defaultOption,this.endOptions)}},data:function(){return{startTime:"",endTime:"",defaultOption:{},distance:0,startClear:!1,endClear:!1}},watch:{defaultValue:{immediate:!0,handler:function(){this.startTime=this.defaultValue[0]||"",this.endTime=this.defaultValue[1]||""}}},methods:{beginDate:function(){var t=this;return{disabledDate:function(e){var a=(new Date).getTime(),i=e.getTime();if(t.endTime){var r=new Date(t.endTime).getTime();return t.notMaxtTodayStart?Math.min(r,a)<i:r<i}if(t.notMaxtTodayStart)return a<i}}},processDate:function(){var t=this;return{disabledDate:function(e){var a=(new Date).getTime(),i=e.getTime();if(t.startTime){var r=new Date(t.startTime).getTime();return t.notMaxtTodayEnd?r-t.distance>i||i>a:r-t.distance>i}if(t.notMaxtTodayEnd)return a<i}}},changeTime:function(){if(this.distance=0,this.startTime&&"datetime"===this.type){var t=new Date(this.startTime);(t.getHours()>0||t.getMinutes()>0||t.getSeconds()>0)&&(this.distance=864e5)}if(this.startTime&&this.endTime){var e=new Date(this.startTime).getTime(),a=new Date(this.endTime).getTime();if(e>a)return this.$message({showClose:!0,message:"开始时间不能大于结束时间！",type:"warning"}),void(this.startTime=this.endTime)}this.$emit("change",[this.startTime,this.endTime]),this.$emit("update:time",[this.startTime,this.endTime])}},mounted:function(){this.startClear="[object Boolean]"!==Object.prototype.toString.call(this.startClearable)?this.clearable:this.startClearable,this.endClear="[object Boolean]"!==Object.prototype.toString.call(this.endClearable)?this.clearable:this.endClearable}}),o=n,l=(a("7050"),a("2877")),s=Object(l["a"])(o,i,r,!1,null,"4969b99b",null);e["default"]=s.exports},"8fe7":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("basic-container",[a("avue-crud",{ref:"crud",attrs:{data:t.data,page:t.page,search:t.search,option:t.option,"table-loading":t.loading,permission:t.permissionList},on:{"update:page":function(e){t.page=e},"update:search":function(e){t.search=e},"search-change":t.searchChange,"search-reset":t.searchReset,"current-change":t.currentChange,"size-change":t.sizeChange,"refresh-change":t.refreshChange,"on-load":t.onLoad},scopedSlots:t._u([{key:"createTimeSearch",fn:function(e){var i=e.size;return[a("datetime-range",{attrs:{defaultValue:t.search.createTime,"start-placeholder":"开始日期","end-placeholder":"结束日期",type:"datetime",size:i,defaultTime:["00:00:00","00:00:00"]},on:{"update:defaultValue":function(e){return t.$set(t.search,"createTime",e)},"update:default-value":function(e){return t.$set(t.search,"createTime",e)},change:function(e){return t.search.createTime=e}}})]}},{key:"type",fn:function(e){var a=e.row;return[t._v("\n      "+t._s((0===a.type?"发布":1===a.type&&"下线")||a.type)+"\n    ")]}},{key:"status",fn:function(e){var i=e.row;return[1===i.status?a("span",{staticClass:"color-danger"},[t._v("审核不通过")]):2===i.status?a("span",{staticClass:"color-success"},[t._v("审核通过")]):a("span",[t._v(t._s(0===i.status?"待审核":3===i.status&&"撤回"))])]}},{key:"menu",fn:function(e){var i=e.row,r=e.type,n=e.size;e.index;return[a("el-button",{attrs:{size:n,type:r},on:{click:function(e){return t.rowView(i)}}},[t._v("查看")]),!t.permissionList.applyBtn||3!==i.status&&1!==i.status?t._e():a("el-button",{attrs:{size:n,type:r},on:{click:function(e){return t.rowEidt(i)}}},[t._v("编辑")]),t.permissionList.revokeBtn&&0===i.status?a("el-button",{attrs:{size:n,type:r},on:{click:function(e){return t.rowRevoke(i)}}},[t._v("撤回")]):t._e(),a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(e){return t.copyID(i.id)}}},[t._v("复制发布ID")])]}}])},[a("template",{slot:"menuLeft"},[t.permissionList.applyBtn?a("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:t.handleApply}},[t._v("发布|下线申请\n      ")]):t._e()],1)],2),a("input",{ref:"idInput",staticClass:"id-input"}),a("apply-detail",{attrs:{visible:t.detailDialog.visible,id:t.detailDialog.id,data:t.detailDialog.data,callback:t.refreshChange},on:{"update:visible":function(e){return t.$set(t.detailDialog,"visible",e)}}}),a("apply-dialog",{attrs:{visible:t.applyDialog.visible,list:t.applyDialog.list,form:t.applyDialog.form,id:t.applyDialog.id,callback:t.refreshChange},on:{"update:visible":function(e){return t.$set(t.applyDialog,"visible",e)}}})],1)},r=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("ade3")),o=a("0f43"),l=a("cec1"),s=a("5880"),c=a("1a1f"),u=a("7079"),p=a("247e"),d=a("8e7d");function f(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function m(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?f(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var g={data:function(){return{search:{},applyDialog:{visible:!1,list:[]},option:{dialogWidth:900,border:!0,index:!0,addBtn:!1,editBtn:!1,delBtn:!1,columnBtn:!1,menuPosition:"right",column:[{label:"发布ID",prop:"id"},{label:"申请时间",prop:"createTime",searchRange:!0,search:!0,searchslot:!0,searchSpan:12,type:"datetime",valueFormat:"yyyy-MM-dd HH:mm:ss"},{label:"标题",prop:"title",search:!0,minWidth:180},{label:"操作类型",prop:"type",slot:!0,width:80},{label:"申请状态",prop:"status",slot:!0,width:100,search:!0,type:"select",dicData:l["a"]},{label:"审核人",prop:"approvalBy"},{label:"审核时间",prop:"approvalTime"}]}}},mixins:[c["default"]],components:{applyDetail:u["default"],applyDialog:p["default"],datetimeRange:d["default"]},computed:m(m({},Object(s["mapGetters"])(["permission"])),{},{permissionList:function(){return{viewBtn:this.vaildData(this.permission.aggregateRecord_apply_view,!1),revokeBtn:this.vaildData(this.permission.aggregate_apply_revoke,!1),applyBtn:this.vaildData(this.permission.aggregate_api_apply,!1)}}}),methods:{rowView:function(t){var e="/aggregateRecord/applyDetail";this.$router.push({path:e,query:{originId:t.id}})},rowEidt:function(t){var e=this;this.applyDialog.id=t.id,Object(o["e"])(t.id).then((function(t){var a=t.data.data;e.applyDialog.visible=!0,e.applyDialog.form=a,e.applyDialog.list=a.configs}))},handleApply:function(){this.applyDialog.id="",this.applyDialog.list=[],this.applyDialog.form={},this.applyDialog.visible=!0},rowRevoke:function(t){var e=this;this.$confirm("确定撤回【".concat(t.title,"】申请吗?"),{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return Object(o["h"])(t.id)})).then((function(){e.onLoad(e.page),e.$message({type:"success",message:"撤回成功"})}))},onLoad:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,Object(o["f"])(t.currentPage,t.pageSize,Object.assign(a,this.query)).then((function(t){var a=t.data.data;e.page.total=a.total,e.data=a.records,e.loading=!1}))},copyID:function(t){this.$refs.idInput.value=t,this.$refs.idInput.select(),document.execCommand("copy"),this.$message({message:"发布ID已复制到粘贴板！",type:"success"})}}},h=g,b=(a("11f5f"),a("2877")),v=Object(b["a"])(h,i,r,!1,null,"543032d2",null);e["default"]=v.exports},"92c9":function(t,e,a){},"94a6":function(t,e,a){},9542:function(t,e,a){},a8eb:function(t,e,a){"use strict";a("227d")},a945:function(t,e,a){},b3f0:function(t,e,a){},c0c5:function(t,e,a){},c2ee:function(t,e,a){},c43f:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"撤回关联配置","append-to-body":"",visible:t.visible,"before-close":t.handleClose,width:"500px"},on:{"update:visible":function(e){t.visible=e}}},[a("div",{staticClass:"b-tip"},[t._v("确定撤回该申请的【"+t._s(t.form.name)+"】接口吗?")]),a("el-form",{ref:"revokeForm",attrs:{model:t.revokeForm,rules:t.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入备注"},model:{value:t.revokeForm.remark,callback:function(e){t.$set(t.revokeForm,"remark",e)},expression:"revokeForm.remark"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small",loading:t.loading},on:{click:t.confirm}},[t._v("确 定\n    ")]),a("el-button",{attrs:{size:"small"},on:{click:function(e){return t.handleClose()}}},[t._v("取 消")])],1)],1)},r=[],n=(a("c5f6"),a("0f43")),o={name:"publish-dialog",data:function(){return{loading:!1,revokeForm:{},rules:{remark:[{required:!0,message:"备注不能为空",trigger:"blur"}]}}},props:{visible:{type:Boolean,default:!1},form:{type:Object,default:function(){return{}}},id:{type:[String,Number],required:!0},callback:{type:Function}},watch:{visible:function(t){t||(this.revokeForm.remark="")}},methods:{confirm:function(){var t=this;this.id?this.$refs.revokeForm.validate((function(e){if(e)return t.loading=!0,Object(n["j"])({applyId:t.id,configId:t.form.id,remark:t.revokeForm.remark}).then((function(){t.callback&&"function"===typeof t.callback&&t.callback(),t.$message.success("撤回成功"),t.$emit("update:visible",!1)})).finally((function(){t.loading=!1}))})):this.$message.error("信息错误，请重新选择！")},handleClose:function(t){this.$emit("update:visible",!1),t&&t()}}},l=o,s=(a("7ec3"),a("2877")),c=Object(s["a"])(l,i,r,!1,null,"9763a388",null);e["default"]=c.exports},c640:function(t,e,a){},d691:function(t,e,a){},dbd4:function(t,e,a){"use strict";a("54b2")},e4d1:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("basic-container",{staticClass:"aggregate-operation-log"},[a("avue-crud",{ref:"crud",attrs:{data:t.data,page:t.page,search:t.search,option:t.option,"table-loading":t.loading},on:{"update:page":function(e){t.page=e},"update:search":function(e){t.search=e},"search-change":t.searchChange,"search-reset":t.searchReset,"current-change":t.currentChange,"size-change":t.sizeChange,"refresh-change":t.refreshChange,"on-load":t.onLoad},scopedSlots:t._u([{key:"approvalTimeSearch",fn:function(e){var i=e.size;return[a("datetime-range",{attrs:{defaultValue:t.search.approvalTime,"start-placeholder":"开始日期","end-placeholder":"结束日期",type:"datetime",size:i,defaultTime:["00:00:00","00:00:00"]},on:{"update:defaultValue":function(e){return t.$set(t.search,"approvalTime",e)},"update:default-value":function(e){return t.$set(t.search,"approvalTime",e)},change:function(e){return t.search.approvalTime=e}}})]}},{key:"type",fn:function(e){var a=e.row;return[t._v("\n      "+t._s((0===a.type?"发布":1===a.type&&"下线")||a.type||"-")+"\n    ")]}},{key:"approvalResult",fn:function(e){var i=e.row;e.size;return[2===i.approvalResult?a("span",{staticClass:"color-success"},[t._v("通过")]):t._e(),1===i.approvalResult?a("span",{staticClass:"color-danger"},[t._v("不通过")]):t._e()]}},{key:"menu",fn:function(e){var i=e.row,r=e.type,n=e.size;return[a("el-button",{attrs:{icon:"el-icon-view",size:n,type:r},on:{click:function(e){return t.rowView(i)}}},[t._v("查看\n      ")])]}}])}),a("audit-detail",{attrs:{visible:t.detailDialog.visible,title:"发布|下线审核日志",id:t.detailDialog.id,data:t.detailDialog.data,callback:t.refreshChange},on:{"update:visible":function(e){return t.$set(t.detailDialog,"visible",e)}}})],1)},r=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("ade3")),o=a("b5c6"),l=a("da71");function s(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function c(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?s(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var u=function(t,e,a){return Object(o["a"])({url:"".concat(l["a"],"/blade-aggregate-apply-approval-log/list"),method:"get",params:c(c({},a),{},{current:t,size:e})})},p=function(t){return Object(o["a"])({url:"".concat(l["a"],"/blade-aggregate-apply-approval-log/detail/").concat(t),method:"get",params:{id:t}})},d=a("cec1"),f=a("218b"),m=a("8e7d"),g={name:"audit-log",data:function(){return{search:{},query:{},loading:!0,page:{pageSize:10,currentPage:1,total:0},option:{menuWidth:80,border:!0,index:!0,addBtn:!1,editBtn:!1,delBtn:!1,columnBtn:!1,menuPosition:"right",column:[{label:"申请时间",prop:"applyTime"},{label:"标题",prop:"title",search:!0},{label:"申请人",prop:"applyBy"},{label:"申请类型",prop:"type",width:80,slot:!0},{label:"审核人",prop:"approvalBy"},{label:"审核结果",prop:"approvalResult",slot:!0,width:80,search:!0,type:"select",dicData:d["b"]},{label:"审核时间",prop:"approvalTime",searchRange:!0,search:!0,searchslot:!0,searchSpan:12,type:"datetime",valueFormat:"yyyy-MM-dd HH:mm:ss"}]},data:[],detailDialog:{visible:!1,data:[],id:""}}},components:{auditDetail:f["default"],datetimeRange:m["default"]},watch:{data:function(){var t=this;this.$nextTick((function(){t.$refs.crud.refreshTable()}))}},methods:{rowView:function(t){var e=this;t.id?(this.detailDialog.id=t.id,p(this.detailDialog.id).then((function(t){e.detailDialog.data=t.data.data,e.detailDialog.visible=!0}))):this.$message.error("数据有误！")},searchReset:function(){this.query={},this.onLoad(this.page)},searchChange:function(t,e){t.approvalTime&&t.approvalTime.length>0&&(t.approvalTimeStart=t.approvalTime[0]||"",t.approvalTimeEnd=t.approvalTime[1]||"",delete t.approvalTime),this.query=t,this.page.currentPage=1,this.onLoad(this.page,t),e()},currentChange:function(t){this.page.currentPage=t},sizeChange:function(t){this.page.pageSize=t},refreshChange:function(){this.onLoad(this.page,this.query)},onLoad:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,u(t.currentPage,t.pageSize,Object.assign(a,this.query)).then((function(t){var a=t.data.data;e.page.total=a.total,e.data=a.records,e.loading=!1}))}}},h=g,b=a("2877"),v=Object(b["a"])(h,i,r,!1,null,"6d9d7892",null);e["default"]=v.exports}}]);