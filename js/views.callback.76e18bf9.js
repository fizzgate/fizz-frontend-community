/*!
 * Fizz-Admin v3.2.0-beta1
 * (c) 2020-2024 Joker-Lee
 * AGPL v3 Licensed.
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views.callback"],{"0a6a":function(e,t,a){"use strict";a.d(t,"c",(function(){return l})),a.d(t,"e",(function(){return s})),a.d(t,"a",(function(){return u})),a.d(t,"f",(function(){return p})),a.d(t,"b",(function(){return d})),a.d(t,"d",(function(){return f}));a("8e6e"),a("ac6a"),a("456d");var r=a("bd86"),n=a("b5c6"),i=a("da71");function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){Object(r["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var l=function(e,t,a){return Object(n["a"])({url:"".concat(i["a"],"/registry-config/list"),method:"get",params:c(c({},a),{},{current:e,size:t})})},s=function(e){return Object(n["a"])({url:"".concat(i["a"],"/registry-config/remove"),method:"post",params:{ids:e}})},u=function(e){return Object(n["a"])({url:"".concat(i["a"],"/registry-config/save"),method:"post",data:e})},p=function(e){return Object(n["a"])({url:"".concat(i["a"],"/registry-config/update"),method:"post",data:e})},d=function(e){return Object(n["a"])({url:"".concat(i["a"],"/registry-config/detail/").concat(e),method:"get"})},f=function(){return Object(n["a"])({url:"".concat(i["a"],"/registry-config/registry-name-list"),method:"get"})}},"0a91":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("basic-container",[t("el-card",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"box-card"},[t("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[t("api-header",{attrs:{"service-name":e.serviceName,"group-name":e.groupName,"page-name":e.pageName}})],1),t("h3",[t("i",{staticClass:"el-icon-edit-outline avue-group__icon"}),e._v("基础信息")]),t("el-form",{ref:"formData",attrs:{model:e.formData,rules:e.rules,size:"small",disabled:e.disabled,"label-width":"120px"}},[t("el-form-item",{attrs:{label:"网关分组：",prop:"gatewayGroup"}},[t("el-select",{attrs:{placeholder:"请选择网关分组",filterable:"",clearable:""},model:{value:e.formData.gatewayGroup,callback:function(t){e.$set(e.formData,"gatewayGroup",t)},expression:"formData.gatewayGroup"}},e._l(e.groupOptions,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label+"("+e.value+")",value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"回调方式：",prop:"callbackType"}},[t("el-radio-group",{model:{value:e.formData.callbackType,callback:function(t){e.$set(e.formData,"callbackType",t)},expression:"formData.callbackType"}},e._l(e.callbackMode,(function(a,r){return t("el-radio",{key:r,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1),t("el-form-item",{attrs:{label:"访问：",prop:"access"}},[t("el-radio-group",{model:{value:e.formData.access,callback:function(t){e.$set(e.formData,"access",t)},expression:"formData.access"}},e._l(e.accessType,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v(e._s(a.label))])})),1)],1),"a"===e.formData.callbackType?[e._l(e.formData.callbackRespHeaders,(function(a,r){return t("div",{key:r,staticClass:"multiple-config"},[t("el-form-item",{attrs:{label:"响应头".concat(r+1,"："),prop:"callbackRespHeaders."+r+".key",rules:{required:!0,message:"字段名不能为空",trigger:"blur"}}},[t("el-input",{attrs:{placeholder:"字段名（例：content-type",clearable:""},model:{value:a.key,callback:function(t){e.$set(a,"key",t)},expression:"item.key"}})],1),t("el-form-item",{attrs:{"label-width":"10px",prop:"callbackRespHeaders."+r+".value",rules:{required:!0,message:"字段值不能为空",trigger:"blur"}}},[t("el-input",{attrs:{placeholder:"字段值（例：application/json",clearable:""},model:{value:a.value,callback:function(t){e.$set(a,"value",t)},expression:"item.value"}})],1),t("div",[r?e._e():t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.addHeaders()}}}),r?t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.deleteRow(r,e.formData.callbackRespHeaders)}}}):e._e()],1)],1)})),t("el-form-item",{attrs:{label:"响应体：",prop:"callbackRespBody"}},[t("el-input",{staticClass:"lg-input",attrs:{type:"textarea",autosize:{minRows:3,maxRows:6},placeholder:"例：{ ''name'': ''wei'' }",clearable:""},model:{value:e.formData.callbackRespBody,callback:function(t){e.$set(e.formData,"callbackRespBody",t)},expression:"formData.callbackRespBody"}})],1)]:e._e(),t("el-form-item",{attrs:{label:"请求方法：",prop:"method"}},[t("el-select",{attrs:{placeholder:"请选择请求方法",clearable:""},model:{value:e.formData.method,callback:function(t){e.$set(e.formData,"method",t)},expression:"formData.method"}},e._l(e.apiMethod,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),t("el-form-item",{attrs:{label:"前端服务名：",prop:"service"}},[t("el-input",{attrs:{placeholder:"请输入服务名",clearable:""},model:{value:e.formData.service,callback:function(t){e.$set(e.formData,"service",t)},expression:"formData.service"}})],1),t("el-form-item",{attrs:{label:"前端路径：",prop:"path"}},[t("el-input",{staticClass:"lg-input",attrs:{placeholder:"请输入前端路径",clearable:""},model:{value:e.formData.path,callback:function(t){e.$set(e.formData,"path",t)},expression:"formData.path"}}),t("div",{staticClass:"key-tips"},[e._v("调用方访问路径，不支持模糊匹配，如：/member/getMebInfo")])],1),t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.addBackendConfig()}}},[e._v("新增后端订阅者")]),e._l(e.formData.callbackReceivers,(function(a,r){return t("div",{key:r,staticClass:"multiple-config"},[t("el-form-item",{attrs:{label:"【后端订阅者".concat(r+1,"】类型："),"label-width":"180px",required:""}},[t("el-radio-group",{on:{change:function(t){return e.changeType(a)}},model:{value:a.type,callback:function(t){e.$set(a,"type",t)},expression:"item.type"}},[t("el-radio",{attrs:{label:1}},[e._v("服务编排")]),t("el-radio",{attrs:{label:2}},[e._v("服务发现")])],1)],1),2===a.type?t("el-form-item",{attrs:{label:"注册中心：","label-width":"92px",prop:"callbackReceivers."+r+".registryName",rules:[{required:!0,message:"注册中心不能为空",trigger:"change"}]}},[t("el-select",{attrs:{filterable:"",placeholder:"请选择 注册中心",clearable:""},on:{change:function(t){return e.changeRegister(a)}},model:{value:a.registryName,callback:function(t){e.$set(a,"registryName",t)},expression:"item.registryName"}},e._l(e.registerList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.value,value:e.value}})})),1)],1):e._e(),t("el-form-item",{attrs:{label:"服务名：","label-width":"80px",prop:"callbackReceivers."+r+".service",rules:{required:!0,message:"服务名不能为空",trigger:"change"}}},[1===a.type?[t("el-select",{attrs:{filterable:"",placeholder:"请选择服务名",clearable:""},model:{value:a.service,callback:function(t){e.$set(a,"service",t)},expression:"item.service"}},e._l(e.aggregateServiceOptions,(function(e,a){return t("el-option",{key:a,attrs:{label:e.value,value:e.value}})})),1)]:2===a.type?[t("el-select",{attrs:{filterable:"",placeholder:"请选择服务名",clearable:""},model:{value:a.service,callback:function(t){e.$set(a,"service",t)},expression:"item.service"}},e._l(e.registerMap[a.registryName],(function(e,a){return t("el-option",{key:a,attrs:{label:e.value,value:e.value}})})),1)]:e._e()],2),t("el-form-item",{attrs:{label:"路径：","label-width":"80px",prop:"callbackReceivers."+r+".path",rules:[{required:!0,message:"路径不能为空",trigger:"blur"},{pattern:/^(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/,message:"请填写正确的路径",trigger:"blur"}]}},[t("el-input",{staticClass:"backend-path",attrs:{placeholder:"转发目标路径，不支持模糊匹配",clearable:""},model:{value:a.path,callback:function(t){e.$set(a,"path",t)},expression:"item.path"}})],1),t("div",[t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.deleteRow(r,e.formData.callbackReceivers)}}})],1)],1)})),t("el-form-item",{attrs:{label:"调用方(appID)：",prop:"appEnabled"}},[t("el-checkbox",{model:{value:e.formData.appEnabled,callback:function(t){e.$set(e.formData,"appEnabled",t)},expression:"formData.appEnabled"}},[e._v("启用")]),t("div",{staticClass:"key-tips"},[e._v("\n          限制调用方访问，请求URL需在请求头中加应用授权\n          "),t("tooltip-appid",{staticClass:"link",attrs:{title:"示例"}}),e._v("，不启用不限制\n        ")],1)],1),e.formData.appEnabled?t("div",{staticStyle:{margin:"0 0 18px 120px"}},[t("el-button",{staticStyle:{"margin-bottom":"8px"},attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){e.appidDrawer=!0}}},[e._v("添加")]),t("el-table",{attrs:{data:e.appidData,border:"",stripe:"",size:"mini","max-height":"240"}},[t("el-table-column",{attrs:{width:"50",align:"center"},scopedSlots:e._u([{key:"header",fn:function(a){return[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleAppidCheckAll},model:{value:e.appidCheckAll,callback:function(t){e.appidCheckAll=t},expression:"appidCheckAll"}})]}},{key:"default",fn:function(a){return[t("el-checkbox",{on:{change:e.handleAppidCheck},model:{value:a.row.enabled,callback:function(t){e.$set(a.row,"enabled",t)},expression:"scope.row.enabled"}})]}}],null,!1,469018870)}),t("el-table-column",{attrs:{label:"appID"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n              "+e._s(t.row.appName)+" ("+e._s(t.row.app)+")\n            ")]}}],null,!1,3248570262)}),t("el-table-column",{attrs:{align:"center",label:"操作",width:"60"},scopedSlots:e._u([{key:"default",fn:function(a){return[t("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(t){return t.preventDefault(),e.deleteRow(a.$index,e.appidData)}}},[e._v("\n                删除\n              ")])]}}],null,!1,1536003634)})],1)],1):e._e()],2),t("plugin-config-con",{ref:"pluginConfigCon",attrs:{disabled:e.disabled||"f"===e.formData.access,config:e.apiPlugins,groupConfig:e.groupPlugins,showType:""},on:{emitData:function(t){return e.apiPlugins=t}}}),e.disabled?e._e():t("footer",[t("el-button",{attrs:{size:"small",icon:"el-icon-circle-check",loading:e.loading,type:"primary"},on:{click:e.handleSubmit}},[e._v("保存")]),t("el-button",{attrs:{size:"small",icon:"el-icon-circle-close"},on:{click:e.handleClose}},[e._v("取消")])],1)],1),t("el-drawer",{ref:"appidDrawer",attrs:{"append-to-body":"",title:"添加调用方(appID)",size:"50%",visible:e.appidDrawer},on:{"update:visible":function(t){e.appidDrawer=t}}},[t("div",[t("div",{staticStyle:{"padding-bottom":"50px"}},[t("add-appid",{attrs:{selection:e.selectionAppid},on:{"update:selection":function(t){e.selectionAppid=t}}})],1),t("footer",{staticClass:"drawer-footer"},[t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.handleAppidDrawer()}}},[e._v("确 定")]),t("el-button",{attrs:{size:"small"},on:{click:function(t){e.appidDrawer=!1}}},[e._v("取 消")])],1)])])],1)},n=[],i=(a("8e6e"),a("456d"),a("6762"),a("2fdb"),a("4f7f"),a("5df3"),a("1c4c"),a("ac6a"),a("7514"),a("7f7f"),a("28a5"),a("bd86")),o=a("5880"),c=a("27fc"),l=a("b30b"),s=a("0a6a"),u=a("0468"),p=a("3bfd"),d=a("9b51"),f=a("c8b6"),h=a("17e0"),g=a("378a");function m(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function b(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?m(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):m(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var v={name:"detail",components:{apiHeader:d["default"],addAppid:f["default"],tooltipAppid:h["default"],pluginConfigCon:g["default"]},data:function(){return{loading:!1,formData:{},accessType:c["a"],callbackMode:c["c"],rules:{gatewayGroup:[{required:!0,message:"必填",trigger:"change"}],callbackType:[{required:!0,message:"必填",trigger:"change"}],access:[{required:!0,message:"必填",trigger:"change"}],service:[{required:!0,message:"必填",trigger:"blur"}],path:[{required:!0,message:"必填",trigger:"blur"},{pattern:/^(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/,message:"请参照例子填写正确的路径",trigger:"blur"}],callbackRespBody:[{required:!0,message:"必填",trigger:"blur"}]},apiPlugins:[],appidDrawer:!1,selectionAppid:[],appidData:[],appidCheckAll:!1,isIndeterminate:!1,apiMethod:[{label:"AUTO",value:""},{label:"GET",value:"GET"},{label:"POST",value:"POST"},{label:"PUT",value:"PUT"},{label:"DELETE",value:"DELETE"},{label:"PATCH",value:"PATCH"},{label:"HEAD",value:"HEAD"},{label:"OPTIONS",value:"OPTIONS"},{label:"TRACE",value:"TRACE"}],groupPlugins:[],registerList:[],registerMap:{}}},computed:b(b({},Object(o["mapGetters"])(["permission","aggregateServiceOptions","discoveryServiceOptions","groupOptions","pluginOptions"])),{},{permissionList:function(){return{publishBtn:this.vaildData(this.permission.aggregate_api_publish,!1)}},originId:function(){return this.$route.query.originId||""},actionType:function(){var e=this.$route.path.split("/");return e[e.length-1]||"add"},disabled:function(){return"view"===this.actionType||!1},pageName:function(){return"add"===this.actionType?"新增回调配置":this.$route.name},groupName:function(){var e=this,t=this.groupOptions.find((function(t){return t.value===e.formData.gatewayGroup}));return t&&t.label||""},serviceName:function(){return this.formData.service||""}}),watch:{appidData:{deep:!0,handler:function(){this.handleAppidCheck()}},"formData.gatewayGroup":function(){this.getGroupDetail(this.formData.gatewayGroup)}},created:function(){this.getGroupOptions(),this.getAggregateServiceOptions(),this.getPluginOptions(),this.getRegisterNameList(),this.init()},beforeRouteUpdate:function(e,t,a){e.fullPath!==t.fullPath&&(a(),this.init())},methods:b(b({},Object(o["mapActions"])(["getAggregateServiceOptions","getGroupOptions","getPluginOptions"])),{},{deleteRow:function(e,t){t.splice(e,1)},addHeaders:function(){this.formData.callbackRespHeaders.push({key:"",value:""})},addBackendConfig:function(){this.formData.callbackReceivers.push({type:1,service:"",path:"",registryName:""})},addPlugin:function(e){var t=this.apiPlugins.concat(e);this.apiPlugins=t},initPlugins:function(e,t){var a=this,r=[];return e&&e.length&&e.forEach((function(e){var n=a.pluginOptions.find((function(t){return t.id===e.plugin}));n&&(t&&(e=b({apiPluginConfigs:e.gatewayGroupPluginConfigs},e),delete e.gatewayGroupPluginConfigs),r.push(Object.assign({},n,e)))})),r},addAppid:function(e){var t={},a=this.appidData.concat(e);a=Array.from(new Set(a)),a=a.reduce((function(e,a){var r=a.app;return t[r]||(t[r]=!0,e.push(a)),e}),[]),this.appidData=a.map((function(e){return{app:e.app,appName:e.appName,enabled:!1!==e.enabled}}))},handleAppidDrawer:function(){this.addAppid(this.selectionAppid),this.appidDrawer=!1},handleAppidCheck:function(){var e=this.appidData.filter((function(e){return!0===e.enabled})),t=e.length;this.appidCheckAll=t===this.appidData.length,this.isIndeterminate=t>0&&t<this.appidData.length},handleAppidCheckAll:function(e){this.appidData=this.appidData.map((function(t){return t.enabled=e,t})),this.isIndeterminate=!1},isRepeatReceivers:function(){var e=this.formData.callbackReceivers||[],t={};for(var a in e){if(t[e[a].path]&&t[e[a].type]&&t[e[a].service]&&t[e[a].registryName])return!0;t[e[a].path]=!0,t[e[a].type]=!0,t[e[a].service]=!0,t[e[a].registryName]=!0}return!1},handleSubmitData:function(){var e=Object.assign({},this.formData);return e.proxyMode=4,e.apiPlugins=this.apiPlugins,e.apps=this.appidData,"s"===e.callbackType&&(delete e.callbackRespHeaders,delete e.callbackRespBody),e},handleSubmit:function(){var e=this;this.$refs.formData.validate((function(t){if(t){var a=e.isRepeatReceivers();if(a)return e.$message.error("后端服务不可重复"),!1;e.$refs.pluginConfigCon.validate().then((function(){if(t){var a=e.handleSubmitData();"add"===e.actionType?e.add(a):e.update(a)}}),(function(t){e.$message.error(t)}))}else e.$message.error("请完善基础信息")}))},handleClose:function(){this.$router.$avueRouter.closeTag(),this.$router.push({path:"/callback/config"})},getDetail:function(){var e=this;this.originId?["edit","view"].includes(this.actionType)&&Object(l["b"])(this.originId).then((function(t){e.formData=t.data.data||{},e.formData.callbackRespHeaders&&e.formData.callbackRespHeaders.length||(e.formData.callbackRespHeaders=[{key:"",value:""}]),e.apiPlugins=e.initPlugins(e.formData.apiPlugins),e.appidData=e.formData.apps||[],e.formData.callbackReceivers.forEach((function(t){e.getDiscoveryServiceOptions(t.registryName)}))})):this.formData={callbackType:"s",access:"a",service:"",appEnabled:!1,method:"",callbackReceivers:[{type:1,service:"",path:"",registryName:""}],callbackRespHeaders:[{key:"",value:""}]}},add:function(e){var t=this;return this.loading=!0,Object(l["a"])(e).then((function(){t.$message.success("保存成功"),setTimeout((function(){t.handleClose()}),300)})).finally((function(){t.loading=!1}))},update:function(e){var t=this;return this.loading=!0,Object(l["e"])(e).then((function(){t.$message.success("修改成功"),t.init()})).finally((function(){t.loading=!1}))},init:function(){"add"===this.actionType&&(this.formData={},this.apiPlugins=[],this.appidData=[],this.groupPlugins=[]),this.getDetail()},getGroupDetail:function(e){var t=this;Object(u["d"])(e).then((function(e){if(200===e.data.code){var a=e.data.data.gatewayGroupPlugins;t.groupPlugins=t.initPlugins(a,!0)}}))},getRegisterNameList:function(){var e=this;Object(s["d"])().then((function(t){if(200===t.data.code){var a=t.data.data;a.forEach((function(t){e.registerList.push({label:t,value:t})}))}}))},changeRegister:function(e){e.service="",this.getDiscoveryServiceOptions(e.registryName)},getDiscoveryServiceOptions:function(e){var t=this;e&&Object(p["d"])({registryName:e}).then((function(a){var r=a.data.data||[],n=[];r.forEach((function(e){n.push({label:e,value:e})})),t.$set(t.registerMap,e,n)}))},changeType:function(e){e.service="",e.registryName=""}})},y=v,O=(a("6716"),a("2877")),k=Object(O["a"])(y,r,n,!1,null,"4a906d97",null);t["default"]=k.exports},"0c58":function(e,t,a){},1677:function(e,t,a){},"16cd":function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return n})),a.d(t,"c",(function(){return i}));a("456d"),a("ac6a"),a("a481");function r(e){var t=/[[($^.\]*\\?+{}\\|)]/gi;return e.replace(t,(function(e){return"\\".concat(e)}))}function n(e){return e&&"string"===typeof e?e.replace(/(^\s*)|(\s*$)/g,""):e}function i(e){return Object.keys(e).forEach((function(t){"string"===typeof e[t]&&(e[t]=n(e[t]))})),e}},"17e0":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("el-popover",{attrs:{"popper-class":"tooltip-dark",placement:"top",title:e.title}},[t("div",{staticClass:"content"},[e._v("\n    "+e._s(e.data.appIdKey)+": 10001 "),t("br"),e._v("\n    "+e._s(e.data.signKey)+": e4502ba3a71448bbbcecef22b305d2ba "),t("br"),e.ts?t("span",[e._v(e._s(e.data.timestampKey)+": 1605255335977 ")]):e._e(),t("br")]),t("span",{attrs:{slot:"reference"},slot:"reference"},[e._v("("+e._s(e.title)+")")])])},n=[],i=a("24a7"),o={name:"tooltip-appid",props:{title:{type:String,default:"示例"},ts:{type:Boolean,default:!0}},data:function(){return{data:{}}},methods:{getCustomHeaderInfo:function(){var e=this;Object(i["d"])().then((function(t){if(200===t.data.code){var a=t.data.data;e.data={appIdKey:a.appIdKey||"fizz-appid",signKey:a.signKey||"fizz-sign",timestampKey:a.timestampKey||"fizz-ts"}}}))}},mounted:function(){this.getCustomHeaderInfo()}},c=o,l=(a("4ede"),a("2877")),s=Object(l["a"])(c,r,n,!1,null,null,null);t["default"]=s.exports},"2f4c":function(e,t,a){"use strict";a("4372")},3355:function(e,t,a){},"35e2":function(e,t,a){"use strict";a("3355")},4372:function(e,t,a){},"4c19":function(e,t,a){"use strict";a.r(t);a("386d");var r=function(){var e=this,t=e._self._c;return t("basic-container",[t("avue-crud",{ref:"crud",attrs:{"before-open":e.beforeOpen,data:e.data,page:e.page,search:e.search,option:e.option,"table-loading":e.loading,permission:e.permissionList},on:{"update:page":function(t){e.page=t},"update:search":function(t){e.search=t},"row-del":e.rowDel,"search-change":e.searchChange,"search-reset":e.searchReset,"selection-change":e.selectionChange,"current-change":e.currentChange,"size-change":e.sizeChange,"refresh-change":e.refreshChange,"on-load":e.onLoad},scopedSlots:e._u([{key:"access",fn:function(a){var r=a.row;return["a"==r.access?t("el-tag",{attrs:{type:"success"}},[e._v("允许")]):e._e(),"f"==r.access?t("el-tag",{attrs:{type:"danger"}},[e._v("禁止")]):e._e()]}},{key:"gatewayGroupSearch",fn:function(a){return[t("el-select",{attrs:{placeholder:"网关分组",filterable:"",clearable:""},model:{value:e.search.gatewayGroup,callback:function(t){e.$set(e.search,"gatewayGroup",t)},expression:"search.gatewayGroup"}},e._l(e.groupOptions,(function(e,a){return t("el-option",{key:a,attrs:{label:e.label+"("+e.value+")",value:e.value}})})),1)]}},{key:"pluginNamesSearch",fn:function(a){return[t("el-select",{attrs:{placeholder:"插件",multiple:"",filterable:"",clearable:"","collapse-tags":""},model:{value:e.search.plugin,callback:function(t){e.$set(e.search,"plugin",t)},expression:"search.plugin"}},e._l(e.pluginOptions,(function(e){return t("el-option",{key:e.id,attrs:{label:e.chnName,value:e.id}})})),1)]}},{key:"methodSearch",fn:function(a){return[t("el-select",{attrs:{placeholder:"请求方法",multiple:"",clearable:"","collapse-tags":""},model:{value:e.search.method,callback:function(t){e.$set(e.search,"method",t)},expression:"search.method"}},e._l(e.apiMethod,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]}}]),model:{value:e.form,callback:function(t){e.form=t},expression:"form"}})],1)},n=[],i=(a("8e6e"),a("ac6a"),a("456d"),a("bd86")),o=a("5880"),c=a("c54a"),l=a("27fc"),s=a("b30b");function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var d={data:function(){return{form:{},query:{},loading:!0,page:{pageSize:10,currentPage:1,total:0},option:{dialogWidth:900,border:!0,index:!0,viewBtn:!0,columnBtn:!1,menuPosition:"right",column:[{label:"网关分组",prop:"gatewayGroup",search:!0,searchslot:!0,overHidden:!0,type:"select",dicData:[]},{label:"回调方式",prop:"callbackType",dicData:l["c"],search:!0,type:"select"},{label:"前端服务名",prop:"service",search:!0,searchLabelWidth:90,overHidden:!0},{label:"前端路径",prop:"path",search:!0,searchLabelWidth:100,overHidden:!0},{label:"请求方法",prop:"method",search:!0,type:"select",searchslot:!0},{label:"插件",prop:"pluginNames",search:!0,searchslot:!0,overHidden:!0,type:"select"},{label:"访问",prop:"access",width:70,slot:!0,search:!0,type:"select",dicData:l["a"]}]},data:[],search:{}}},computed:p(p({},Object(o["mapGetters"])(["permission","apiMethod","groupOptions","pluginOptions"])),{},{permissionList:function(){return{addBtn:this.vaildData(this.permission.proxy_api_add,!1),editBtn:this.vaildData(this.permission.proxy_api_edit,!1),viewBtn:this.vaildData(this.permission.proxy_api_view,!1),delBtn:this.vaildData(this.permission.proxy_api_delete,!1)}}}),created:function(){this.getPluginOptions(),this.getGroupOptions()},watch:{groupOptions:function(e){var t=this.findObject(this.option.column,"gatewayGroup");t.dicData=e||[]}},methods:p(p({},Object(o["mapActions"])(["getGroupOptions","getPluginOptions"])),{},{beforeOpen:function(e,t){if("add"===t||this.form.id){var a="/callback/detail/".concat(t);this.$router.push({path:a,query:{originId:this.form.id}})}else this.$message.error("数据缺失，无法操作！")},rowDel:function(e){var t=this;this.$confirm("确定将选择数据删除?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return Object(s["d"])(e.id)})).then((function(){t.onLoad(t.page),t.$message({type:"success",message:"删除成功"})}))},searchReset:function(){this.query={},this.onLoad(this.page)},searchChange:function(e,t){e.method&&Object(c["b"])(e.method)&&(e.method_in=e.method.join(",")||"",delete e.method),e.plugin&&Object(c["b"])(e.plugin)&&(e.pluginId_in=e.plugin.join(",")||"",delete e.plugin),this.query=e,this.page.currentPage=1,this.onLoad(this.page,e),t()},currentChange:function(e){this.page.currentPage=e},sizeChange:function(e){this.page.pageSize=e},refreshChange:function(){this.onLoad(this.page,this.query)},onLoad:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,Object(s["c"])(e.currentPage,e.pageSize,Object.assign(a,this.query)).then((function(e){var a=e.data.data;t.page.total=a.total,t.data=a.records,t.loading=!1}))}})},f=d,h=a("2877"),g=Object(h["a"])(f,r,n,!1,null,null,null);t["default"]=g.exports},"4c7d":function(e,t,a){"use strict";a.d(t,"c",(function(){return l})),a.d(t,"b",(function(){return s})),a.d(t,"d",(function(){return u})),a.d(t,"a",(function(){return p}));a("8e6e"),a("ac6a"),a("456d");var r=a("bd86"),n=a("b5c6"),i=a("da71");function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){Object(r["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var l=function(e,t,a){return Object(n["a"])({url:"".concat(i["a"],"/callback-request/list"),method:"get",params:c(c({},a),{},{current:e,size:t})})},s=function(e){return Object(n["a"])({url:"".concat(i["a"],"/callback-request/detail/").concat(e),method:"get"})},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["a"])({url:"".concat(i["a"],"/callback-request/replay"),method:"post",data:e})},p=function(e){return Object(n["a"])({url:"".concat(i["a"],"/callback-request/callback-receivers/").concat(e),method:"get"})}},"4ede":function(e,t,a){"use strict";a("917c")},"62e9":function(e,t,a){},6716:function(e,t,a){"use strict";a("1677")},"6cdf":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"formData",staticClass:"plugin-form",attrs:{disabled:e.disabled,model:e.formData,size:"small"}},[t("plugin-form-item",{attrs:{pluginConfig:e.pluginConfig,formData:e.formData}})],1)],1)},n=[],i=(a("6762"),a("2fdb"),a("75fc")),o=(a("7514"),a("ac6a"),a("456d"),a("7f7f"),a("c5f6"),a("16cd")),c=a("c54a"),l=a("80a3"),s={components:{pluginFormItem:l["default"]},data:function(){return{formData:{},pluginConfigCache:{},result:[]}},props:{disabled:{type:Boolean,default:!1},config:{type:[Array,String],required:!0},data:{type:[Array,Object]},order:{type:[String,Number]},name:{type:String}},computed:{pluginConfig:function(){var e=this.config||"";return e&&"string"===typeof e&&(e=JSON.parse(e)),this.renderData(e||[])},watchInit:function(){return{pluginConfig:this.pluginConfig,data:this.data}}},watch:{watchInit:{immediate:!0,deep:!0,handler:function(){this.initData()}}},methods:{validate:function(){var e=this;return this.handleData(),new Promise((function(t,a){e.$refs.formData.validate((function(r,n){if(e.order||Object(c["d"])(e.order,"number")||a("插件【".concat(e.name,"】: 执行顺序不能为空")),r)t();else{if(n){var i=Object.keys(n)[0],o=n[i][0]["message"]||"未完善插件配置";a("插件【".concat(e.name,"】: ").concat(o))}a()}}))}))},resetForm:function(e){this.$refs[e].resetFields()},handleData:function(){var e=this,t=[],a=Object.assign({},this.formData);Object.keys(a).forEach((function(r){var n=e.pluginConfigCache.find((function(e){return e.field===r}))||{};if("checkbox"===n.component&&!a[r].length)return!1;var i={item:r,type:n.dataType,value:JSON.stringify(a[r])};t.push(i)})),this.result=[],this.filterResult(this.pluginConfig,Object(o["c"])(t)),console.log(JSON.stringify(this.result,null,4)),this.$emit("update:data",this.result)},filterResult:function(e,t){var a=this;e.forEach((function(e){var r=t.filter((function(t){return t.item==e.field}));if(r.length>0){a.result=[].concat(Object(i["a"])(a.result),Object(i["a"])(r));var n=e.options;if(n&&n.length>0){var o=n.filter((function(e){return e.value==r[0].value}));o.length>0&&o[0].refData&&a.filterResult(o[0].refData,t)}}}))},initData:function(){var e=this,t={};this.pluginConfigCache.forEach((function(a){if("checkbox"===a.component&&(t[a.field]=[]),Object.keys(a).some((function(e){return"default"===e}))&&(t[a.field]=a.default),e.data&&e.data.length>0){var r=e.data.find((function(e){return e.item===a.field}));r&&(t[a.field]=JSON.parse(r.value))}})),this.formData=Object.assign({},this.formData,t)},getOpt:function(e,t){e=JSON.parse(JSON.stringify(e));var a=e.filter((function(e){return e.vIf===t}));return a.map((function(e){return delete e.vIf,e})),a},renderData:function(e){var t=this;this.pluginConfigCache=e;var a=function a(r){r.forEach((function(r){if(["radio","select","checkbox"].includes(r.component)){var n=r.options;n.map((function(r){r.refs&&r.refs.length>0&&(r.refData=[],r.refs.forEach((function(n){var o,c=t.getOpt(e,n);c.length>0&&(a(c),(o=r.refData).push.apply(o,Object(i["a"])(c)))})))}))}}))};return a(e),e.filter((function(e){return!e.vIf}))}}},u=s,p=(a("ffb0"),a("2877")),d=Object(p["a"])(u,r,n,!1,null,null,null);t["default"]=d.exports},"7de4":function(e,t,a){"use strict";a.r(t);a("386d");var r=function(){var e=this,t=e._self._c;return t("basic-container",[t("avue-crud",{ref:"crud",attrs:{search:e.search,"before-open":e.beforeOpen,data:e.data,page:e.page,option:e.option,"table-loading":e.loading},on:{"update:search":function(t){e.search=t},"update:page":function(t){e.page=t},"search-change":e.searchChange,"search-reset":e.searchReset,"current-change":e.currentChange,"size-change":e.sizeChange,"refresh-change":e.refreshChange,"on-load":e.onLoad},scopedSlots:e._u([{key:"createTimeSearch",fn:function(a){var r=a.size;return[t("datetime-range",{attrs:{defaultValue:e.search.createTime,"start-placeholder":"开始日期","end-placeholder":"结束日期",type:"datetime",size:r,defaultTime:["00:00:00","00:00:00"]},on:{"update:defaultValue":function(t){return e.$set(e.search,"createTime",t)},"update:default-value":function(t){return e.$set(e.search,"createTime",t)},change:function(t){return e.search.createTime=t}}})]}},{key:"recvTimeSearch",fn:function(a){var r=a.size;return[t("datetime-range",{attrs:{defaultValue:e.search.recvTime,"start-placeholder":"开始日期","end-placeholder":"结束日期",type:"datetime",size:r,defaultTime:["00:00:00","00:00:00"]},on:{"update:defaultValue":function(t){return e.$set(e.search,"recvTime",t)},"update:default-value":function(t){return e.$set(e.search,"recvTime",t)},change:function(t){return e.search.recvTime=t}}})]}},{key:"result",fn:function(a){var r=a.row;return[1===r.result?t("span",{staticClass:"color-success"},[e._v("成功")]):2===r.result?t("span",{staticClass:"color-danger"},[e._v("失败")]):t("span",[e._v(e._s(r.result))])]}},{key:"receiversLabel",fn:function(a){return[t("span",[e._v("\n        "+e._s((1===a.row.mode?"按原路径回放时的部署":2===a.row.mode&&"接收回放的服务")||"回放部署或服务")+"\n        :\n      ")])]}},{key:"receiversForm",fn:function(a){var r=a.row;return[t("div",[1===r.mode?t("div",e._l(e.handleHeaders(r.receivers),(function(a,r){return t("div",{key:r},[t("b",[e._v(e._s(a.key)+":")]),a.value.ip?t("span",[e._v(e._s(a.value.ip)+":"+e._s(a.value.port))]):t("span",[e._v(e._s(a.value))])])})),0):2===r.mode?t("div",[t("el-table",{attrs:{data:JSON.parse(r.receivers),border:"",stripe:"",size:"mini"}},[t("el-table-column",{attrs:{label:"服务类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n                "+e._s((1===t.row.type?"服务编排":2===t.row.type&&"服务发现")||t.row.type)+"\n              ")]}}],null,!0)}),t("el-table-column",{attrs:{prop:"service",label:"服务名"}}),t("el-table-column",{attrs:{prop:"path",label:"路径"}})],1)],1):t("div",[e._v(e._s(r.receivers))])])]}},{key:"headersForm",fn:function(a){return[t("div",e._l(e.handleHeaders(e.form.headers),(function(a,r){return t("div",{key:r},[t("b",[e._v(e._s(a.key)+"：")]),e._v(" "+e._s(a.value.join("; "))+"\n        ")])})),0)]}},{key:"bodyForm",fn:function(a){return[t("el-input",{staticClass:"playback-body",attrs:{type:"textarea",resize:"none",autosize:{minRows:3,maxRows:6},readonly:""},model:{value:a.row.body,callback:function(t){e.$set(a.row,"body",t)},expression:"scope.row.body"}})]}},{key:"resultForm",fn:function(a){return[t("el-tag",{attrs:{size:"small",type:"success"}},[e._v("成功")]),1===a.row.result?t("el-tag",{attrs:{size:"small",type:"success"}},[e._v("成功")]):2===a.row.result?t("el-tag",{attrs:{size:"small",type:"danger"}},[e._v("失败")]):t("span",[e._v(e._s(a.row.result))])]}},{key:"errMsgForm",fn:function(a){return[t("el-input",{staticClass:"playback-body",attrs:{type:"textarea",resize:"none",autosize:{minRows:3,maxRows:6},readonly:""},model:{value:a.row.errMsg,callback:function(t){e.$set(a.row,"errMsg",t)},expression:"scope.row.errMsg"}})]}}]),model:{value:e.form,callback:function(t){e.form=t},expression:"form"}})],1)},n=[],i=(a("8e6e"),a("6762"),a("2fdb"),a("456d"),a("ac6a"),a("f559"),a("bd86")),o=a("5880"),c=a("27fc"),l=a("b5c6"),s=a("da71");function u(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?u(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var d=function(e,t,a){return Object(l["a"])({url:"".concat(s["a"],"/callback-request-replay-log/list"),method:"get",params:p(p({},a),{},{current:e,size:t})})},f=function(e){return Object(l["a"])({url:"".concat(s["a"],"/callback-request-replay-log/detail/").concat(e),method:"get"})},h=a("8e7d");function g(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function m(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?g(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):g(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var b=[{label:"成功",value:1},{label:"失败",value:2}],v={components:{datetimeRange:h["default"]},data:function(){return{search:{},form:{},query:{},loading:!0,page:{pageSize:10,currentPage:1,total:0},option:{dialogWidth:900,border:!0,index:!0,viewBtn:!0,addBtn:!1,delBtn:!1,editBtn:!1,columnBtn:!1,menuPosition:"right",menuWidth:80,searchLabelWidth:90,labelWidth:160,column:[{label:"回放ID",prop:"id"},{label:"回放时间",prop:"createTime",search:!0,searchslot:!0,searchRange:!0,searchSpan:12,type:"datetime",valueFormat:"yyyy-MM-dd HH:mm:ss",width:150},{label:"操作人",prop:"createBy",search:!0,overHidden:!0},{label:"请求ID",prop:"callbackRequestId",search:!0},{label:"请求源IP",prop:"origin",search:!0},{label:"请求时间",prop:"recvTime",search:!0,searchslot:!0,searchRange:!0,searchSpan:12,type:"datetime",valueFormat:"yyyy-MM-dd HH:mm:ss",width:150},{label:"请求方法",prop:"method",search:!0,type:"select",dicData:c["b"]},{label:"前端服务名",prop:"service",search:!0,overHidden:!0},{label:"前端路径",prop:"path",search:!0,overHidden:!0},{label:"查询字符串",prop:"query",search:!0,overHidden:!0},{label:"回放方式",prop:"mode",search:!0,type:"select",dicData:c["d"],overHidden:!0},{label:"回放部署或服务",prop:"receivers",hide:!0,formslot:!0,labelslot:!0,span:24},{label:"请求头",prop:"headers",hide:!0,formslot:!0,span:24},{label:"请求体",prop:"body",hide:!0,formslot:!0,span:24},{label:"回放结果",prop:"result",search:!0,slot:!0,formslot:!0,type:"select",dicData:b},{label:"回放失败信息",prop:"errMsg",hide:!0,formslot:!0,display:!1,span:24}]},data:[]}},computed:m(m({},Object(o["mapGetters"])(["permission"])),{},{callbackRequestId:function(){return this.$route.query.callbackRequestId||""}}),beforeRouteUpdate:function(e,t,a){e.fullPath!==t.fullPath&&(this.option.column=this.option.column.map((function(e){return e.searchValue&&(e.searchValue=""),e})),this.query={},a(),this.onLoad(this.page,Object.assign({},e.query)))},watch:{callbackRequestId:{immediate:!0,handler:function(e){if(e){this.query.callbackRequestId=e;var t=this.findObject(this.option.column,"callbackRequestId");t.searchValue=e}}},data:function(){var e=this;this.$nextTick((function(){e.$refs.crud.refreshTable()}))}},methods:{handleHeaders:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[];return"string"===typeof e&&e.startsWith("{")&&(e=JSON.parse(e)),Object.keys(e).forEach((function(a){t.push({key:a,value:e[a]})})),t},beforeOpen:function(e,t){var a=this;["edit","view"].includes(t)&&f(this.form.id).then((function(e){if(a.form=e.data.data,2===a.form.result){var t=a.findObject(a.option.column,"errMsg");t.display=!0}})),e()},searchReset:function(){this.query={},this.onLoad(this.page)},searchChange:function(e,t){e.createTime&&(e.createTimeStart=e.createTime[0]||"",e.createTimeEnd=e.createTime[1]||"",delete e.createTime),e.recvTime&&(e.recvTimeStart=e.recvTime[0]||"",e.recvTimeEnd=e.recvTime[1]||"",delete e.recvTime),this.query=e,this.page.currentPage=1,this.onLoad(this.page,e),t()},currentChange:function(e){this.page.currentPage=e},sizeChange:function(e){this.page.pageSize=e},refreshChange:function(){this.onLoad(this.page,this.query)},onLoad:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,d(e.currentPage,e.pageSize,Object.assign(a,this.query)).then((function(e){var a=e.data.data;t.page.total=a.total,t.data=a.records,t.loading=!1}))}}},y=v,O=(a("fa27"),a("2877")),k=Object(O["a"])(y,r,n,!1,null,null,null);t["default"]=k.exports},"7df7":function(e,t,a){"use strict";a("62e9")},"7fb3":function(e,t,a){"use strict";a.r(t);a("386d");var r=function(){var e=this,t=e._self._c;return t("basic-container",[t("avue-crud",{ref:"crud",attrs:{"before-open":e.beforeOpen,data:e.data,page:e.page,option:e.option,search:e.search,"table-loading":e.loading,permission:e.permissionList},on:{"update:page":function(t){e.page=t},"update:search":function(t){e.search=t},"search-change":e.searchChange,"search-reset":e.searchReset,"selection-change":e.selectionChange,"current-change":e.currentChange,"size-change":e.sizeChange,"refresh-change":e.refreshChange,"on-load":e.onLoad},scopedSlots:e._u([{key:"recvTimeSearch",fn:function(a){var r=a.size;return[t("datetime-range",{attrs:{defaultValue:e.search.recvTime,"start-placeholder":"开始日期","end-placeholder":"结束日期",type:"datetime",size:r,defaultTime:["00:00:00","00:00:00"]},on:{"update:defaultValue":function(t){return e.$set(e.search,"recvTime",t)},"update:default-value":function(t){return e.$set(e.search,"recvTime",t)},change:function(t){return e.search.recvTime=t}}})]}},{key:"targetsForm",fn:function(a){return[t("div",e._l(e.form.targets,(function(a,r){return t("div",{key:r},[t("b",[e._v(e._s(a.key)+":")]),a.value.ip?t("span",[e._v(e._s(a.value.ip)+":"+e._s(a.value.port))]):t("span",[e._v(e._s(a.value))])])})),0)]}},{key:"headersForm",fn:function(a){return[t("div",e._l(e.form.headers,(function(a,r){return t("div",{key:r},[t("b",[e._v(e._s(a.key)+"：")]),e._v(" "+e._s(a.value.join("; "))+"\n        ")])})),0)]}},{key:"bodyForm",fn:function(a){return[a.row.body?t("el-input",{staticClass:"playback-body",attrs:{type:"textarea",resize:"none",autosize:{minRows:3,maxRows:6},readonly:""},model:{value:a.row.body,callback:function(t){e.$set(a.row,"body",t)},expression:"scope.row.body"}}):t("div",[e._v(e._s(a.row.body))])]}},{key:"menu",fn:function(a){var r=a.row,n=a.type,i=a.size;return[e.permissionList.playbackBtn?t("el-button",{attrs:{icon:"el-icon-video-play",size:i,type:n},on:{click:function(t){return e.playback(r.id,r.callbackConfigId)}}},[e._v("回 放\n      ")]):e._e(),t("el-button",{attrs:{icon:"el-icon-document",size:i,type:n},on:{click:function(t){return e.goLogList(r)}}},[e._v("日 志\n      ")])]}}]),model:{value:e.form,callback:function(t){e.form=t},expression:"form"}}),t("playback-dialog",{attrs:{visible:e.playbackDialog.visible,id:e.playbackDialog.id,"config-id":e.playbackDialog.configId},on:{"update:visible":function(t){return e.$set(e.playbackDialog,"visible",t)}}})],1)},n=[],i=(a("8e6e"),a("6762"),a("2fdb"),a("456d"),a("f559"),a("4f7f"),a("5df3"),a("1c4c"),a("ac6a"),a("bd86")),o=a("5880"),c=a("27fc"),l=a("4c7d"),s=a("d4b8"),u=a("8e7d");function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var f={data:function(){return{search:{recvTime:[]},form:{},query:{},loading:!0,page:{pageSize:10,currentPage:1,total:0},selectionList:[],option:{dialogWidth:900,border:!0,index:!0,tip:!1,dialogClickModal:!1,viewBtn:!0,addBtn:!1,delBtn:!1,editBtn:!1,columnBtn:!1,menuPosition:"right",menuWidth:200,searchLabelWidth:90,labelWidth:120,column:[{label:"请求ID",prop:"id"},{label:"请求时间",prop:"recvTime",search:!0,searchslot:!0,searchRange:!0,searchSpan:12,type:"datetime",valueFormat:"yyyy-MM-dd HH:mm:ss"},{label:"请求源IP",prop:"origin",search:!0,editDisabled:!0,overHidden:!0},{label:"请求方法",prop:"method",search:!0,type:"select",dicData:c["b"]},{label:"前端服务名",prop:"service",search:!0,overHidden:!0},{label:"前端路径",prop:"path",search:!0,overHidden:!0},{label:"查询字符串",prop:"query",search:!0,overHidden:!0},{label:"接收的服务实例",prop:"targets",hide:!0,formslot:!0,span:24},{label:"请求头",prop:"headers",hide:!0,formslot:!0,span:24},{label:"请求体",prop:"body",hide:!0,formslot:!0,span:24}]},data:[],playbackDialog:{visible:!1,id:"",configId:""}}},computed:d(d({},Object(o["mapGetters"])(["permission"])),{},{permissionList:function(){return{playbackBtn:this.vaildData(this.permission.callback_playback_btn,!1)}},configIds:function(){var e=[];return this.selectionList.forEach((function(t){e.push(t.callbackConfigId)})),e=Array.from(new Set(e)),e.join(",")},ids:function(){var e=[];return this.selectionList.forEach((function(t){e.push(t.id)})),e=Array.from(new Set(e)),e.join(",")}}),components:{playbackDialog:s["default"],datetimeRange:u["default"]},watch:{data:function(){var e=this;this.$nextTick((function(){e.$refs.crud.refreshTable()}))}},methods:{goLogList:function(e){this.$router.push({path:"/callback/log",query:{callbackRequestId:e.id}})},handleObject:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=[];return"string"===typeof e&&e.startsWith("{")&&(e=JSON.parse(e)),Object.keys(e).forEach((function(a){t.push({key:a,value:e[a]})})),t},playback:function(e,t){this.playbackDialog.id=e,this.playbackDialog.configId=t,this.playbackDialog.visible=!0},handlePlayback:function(){0!==this.selectionList.length?this.playback(this.ids,this.configIds):this.$message.warning("请选择至少一条数据")},beforeOpen:function(e,t){var a=this;["edit","view"].includes(t)&&Object(l["b"])(this.form.id).then((function(e){a.form=e.data.data,a.form.targets=a.handleObject(a.form.targets),a.form.headers=a.handleObject(a.form.headers)})),e()},searchReset:function(){this.query={},this.onLoad(this.page)},searchChange:function(e,t){e.recvTime&&(e.startTime=e.recvTime[0]||"",e.endTime=e.recvTime[1]||"",delete e.recvTime),this.query=e,this.page.currentPage=1,this.onLoad(this.page,e),t()},selectionChange:function(e){this.selectionList=e},selectionClear:function(){this.selectionList=[],this.$refs.crud&&this.$refs.crud.toggleSelection()},currentChange:function(e){this.page.currentPage=e},sizeChange:function(e){this.page.pageSize=e},refreshChange:function(){this.onLoad(this.page,this.query)},onLoad:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,Object(l["c"])(e.currentPage,e.pageSize,Object.assign(a,this.query)).then((function(e){var a=e.data.data;t.page.total=a.total,t.data=a.records,t.loading=!1,t.selectionClear()}))}}},h=f,g=(a("97a6"),a("2877")),m=Object(g["a"])(h,r,n,!1,null,null,null);t["default"]=m.exports},"80a3":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",[e.pluginConfig.length?e._l(e.pluginConfig,(function(a,r){return t("el-form-item",{key:r,attrs:{label:a.label,prop:a.field,rules:a.rules}},["input"===a.component?[["number","long","double"].some((function(e){return e===a.dataType}))?t("el-input",{attrs:{type:"number",placeholder:a.placeholder+"??",autocomplete:"off",clearable:""},model:{value:e.formData[a.field],callback:function(t){e.$set(e.formData,a.field,e._n(t))},expression:"formData[comp.field]"}}):t("el-input",{attrs:{placeholder:a.placeholder,autocomplete:"off",clearable:""},model:{value:e.formData[a.field],callback:function(t){e.$set(e.formData,a.field,t)},expression:"formData[comp.field]"}})]:e._e(),"select"===a.component?[t("el-select",{attrs:{placeholder:a.placeholder,clearable:""},model:{value:e.formData[a.field],callback:function(t){e.$set(e.formData,a.field,t)},expression:"formData[comp.field]"}},e._l(a.options,(function(e){return t("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)]:e._e(),"radio"===a.component?[t("el-radio-group",{model:{value:e.formData[a.field],callback:function(t){e.$set(e.formData,a.field,t)},expression:"formData[comp.field]"}},e._l(a.options,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value}},[e._v("\n                "+e._s(a.label)+"\n              ")])})),1)]:e._e(),"checkbox"===a.component?[t("el-checkbox-group",{model:{value:e.formData[a.field],callback:function(t){e.$set(e.formData,a.field,t)},expression:"formData[comp.field]"}},e._l(a.options,(function(a){return t("el-checkbox",{key:a.value,attrs:{label:a.value}},[e._v("\n                "+e._s(a.label)+"\n              ")])})),1)]:e._e(),"textarea"===a.component?[t("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:6},placeholder:a.placeholder,autocomplete:"off",clearable:""},model:{value:e.formData[a.field],callback:function(t){e.$set(e.formData,a.field,t)},expression:"formData[comp.field]"}})]:e._e(),t("div",{staticStyle:{color:"#999","font-size":"12px"}},[e._v("\n            "+e._s(a.desc)+"\n             "),a.tooltipValue?t("el-popover",{attrs:{"popper-class":"tooltip-dark",placement:"top",title:a.tooltipLabel||"使用说明",width:a.tooltipWidth||500}},[t("div",{staticClass:"content"},[e._v("\n                  "+e._s(a.tooltipValue)+"\n                ")]),t("span",{attrs:{slot:"reference"},slot:"reference"},[e._v("("+e._s(a.tooltipLabel||"使用说明")+")")])]):e._e()],1),e.getRefData(e.formData[a.field],a).length>0?t("div",{staticClass:"cycle-con"},[t("plugin-form-item",{attrs:{pluginConfig:e.getRefData(e.formData[a.field],a),formData:e.formData}})],1):e._e()],2)})):[t("el-alert",{attrs:{title:"当前插件配置有误",type:"warning",closable:!1}})]],2)},n=[],i={name:"pluginFormItem",data:function(){return{}},props:{pluginConfig:{type:Array,default:function(){return[]}},formData:{type:Object,default:function(){return{}}}},methods:{getRefData:function(e,t){try{var a=t.options,r=a.filter((function(t){return t.value==e}))[0];if(r.refData&&r.refData.length>0){var n=r.refData.map((function(e){return delete e.ref,e}));return n}return[]}catch(i){}return[]}}},o=i,c=(a("7df7"),a("2877")),l=Object(c["a"])(o,r,n,!1,null,null,null);t["default"]=l.exports},"8e7d":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"datatime-range",class:e.className},[t("div",{staticClass:"picker-item"},[t("el-date-picker",{attrs:{type:e.type,placeholder:e.startPlaceholder,align:"right","picker-options":e.startPickerOptions,clearable:e.startClear,readonly:e.readonly,"value-format":e.valueFormat,size:e.size,"default-time":e.defaultTime[0]},on:{change:e.changeTime},model:{value:e.startTime,callback:function(t){e.startTime=t},expression:"startTime"}})],1),t("span",{staticClass:"interval"},[e._v("-")]),t("div",{staticClass:"picker-item"},[t("el-date-picker",{attrs:{type:e.type,placeholder:e.endPlaceholder,align:"right","picker-options":e.endPickerOptions,clearable:e.endClear,readonly:e.readonly,"value-format":e.valueFormat,size:e.size,"default-time":e.defaultTime[1]},on:{change:e.changeTime},model:{value:e.endTime,callback:function(t){e.endTime=t},expression:"endTime"}})],1)])},n=[],i=(a("6b54"),a("6762"),a("2fdb"),{name:"datatime-range",props:{className:{type:String,default:""},readonly:{type:Boolean,default:!1},size:{type:String,default:"small",validator:function(e){return-1!==["large","small","mini"].indexOf(e)}},type:{type:String,default:"datetime",validator:function(e){return-1!==["year","month","date","week","datetime"].indexOf(e)}},defaultValue:{type:Array,default:function(){return["",""]}},valueFormat:{type:String,default:"yyyy-MM-dd HH:mm:ss"},startOptions:{type:Object,default:function(){return{}}},endOptions:{type:Object,default:function(){return{}}},notMaxtTodayStart:{type:Boolean,default:!0},notMaxtTodayEnd:{type:Boolean,default:!0},startPlaceholder:{type:String,default:"请选择开始时间"},endPlaceholder:{type:String,default:"请选择结束时间"},defaultTime:{type:String|Array,default:function(e){return"string"===typeof e?[e,e]:e||["",""]}},clearable:{type:Boolean,default:!0},startClearable:{},endClearable:{}},computed:{startPickerOptions:function(){return["date","datetime"].includes(this.type)?Object.assign({},this.beginDate(),this.defaultOption,this.startOptions):Object.assign({},this.defaultOption,this.startOptions)},endPickerOptions:function(){return["date","datetime"].includes(this.type)?Object.assign({},this.processDate(),this.defaultOption,this.endOptions):Object.assign({},this.defaultOption,this.endOptions)}},data:function(){return{startTime:"",endTime:"",defaultOption:{},distance:0,startClear:!1,endClear:!1}},watch:{defaultValue:{immediate:!0,handler:function(){this.startTime=this.defaultValue[0]||"",this.endTime=this.defaultValue[1]||""}}},methods:{beginDate:function(){var e=this;return{disabledDate:function(t){var a=(new Date).getTime(),r=t.getTime();if(e.endTime){var n=new Date(e.endTime).getTime();return e.notMaxtTodayStart?Math.min(n,a)<r:n<r}if(e.notMaxtTodayStart)return a<r}}},processDate:function(){var e=this;return{disabledDate:function(t){var a=(new Date).getTime(),r=t.getTime();if(e.startTime){var n=new Date(e.startTime).getTime();return e.notMaxtTodayEnd?n-e.distance>r||r>a:n-e.distance>r}if(e.notMaxtTodayEnd)return a<r}}},changeTime:function(){if(this.distance=0,this.startTime&&"datetime"===this.type){var e=new Date(this.startTime);(e.getHours()>0||e.getMinutes()>0||e.getSeconds()>0)&&(this.distance=864e5)}if(this.startTime&&this.endTime){var t=new Date(this.startTime).getTime(),a=new Date(this.endTime).getTime();if(t>a)return this.$message({showClose:!0,message:"开始时间不能大于结束时间！",type:"warning"}),void(this.startTime=this.endTime)}this.$emit("change",[this.startTime,this.endTime]),this.$emit("update:time",[this.startTime,this.endTime])}},mounted:function(){this.startClear="[object Boolean]"!==Object.prototype.toString.call(this.startClearable)?this.clearable:this.startClearable,this.endClear="[object Boolean]"!==Object.prototype.toString.call(this.endClearable)?this.clearable:this.endClearable}}),o=i,c=(a("35e2"),a("2877")),l=Object(c["a"])(o,r,n,!1,null,"4969b99b",null);t["default"]=l.exports},"917c":function(e,t,a){},"97a6":function(e,t,a){"use strict";a("e2a3")},"9b51":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("header",{staticClass:"api-header"},[e.groupName?t("el-tag",[e._v("网关分组[ "+e._s(e.groupName)+" ]")]):e._e(),e._v(" \n  "),e.serviceName?t("el-tag",[e._v("服务[ "+e._s(e.serviceName)+" ]")]):e._e(),e._v(" \n  "),t("b",[e._v(e._s(e.pageName))])],1)},n=[],i=(a("7f7f"),{name:"index",props:{serviceName:{type:String,default:""},groupName:{type:String,default:""},pageName:{type:String,default:function(){return this.$route.name||""}}}}),o=i,c=a("2877"),l=Object(c["a"])(o,r,n,!1,null,"7c207ce7",null);t["default"]=l.exports},b30b:function(e,t,a){"use strict";a.d(t,"c",(function(){return l})),a.d(t,"d",(function(){return s})),a.d(t,"a",(function(){return u})),a.d(t,"e",(function(){return p})),a.d(t,"b",(function(){return d}));a("8e6e"),a("ac6a"),a("456d");var r=a("bd86"),n=a("b5c6"),i=a("da71");function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){Object(r["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var l=function(e,t,a){return Object(n["a"])({url:"".concat(i["a"],"/callback-config/list"),method:"get",params:c(c({},a),{},{current:e,size:t})})},s=function(e){return Object(n["a"])({url:"".concat(i["a"],"/callback-config/remove"),method:"post",params:{ids:e}})},u=function(e){return Object(n["a"])({url:"".concat(i["a"],"/callback-config/save"),method:"post",data:e})},p=function(e){return Object(n["a"])({url:"".concat(i["a"],"/callback-config/update"),method:"post",data:e})},d=function(e){return Object(n["a"])({url:"".concat(i["a"],"/callback-config/detail/").concat(e),method:"get"})}},c8b6:function(e,t,a){"use strict";a.r(t);a("386d");var r=function(){var e=this,t=e._self._c;return t("avue-crud",{ref:"crud",attrs:{id:"addAppidTable",data:e.data,page:e.page,search:e.search,option:e.option,"table-loading":e.loading},on:{"update:page":function(t){e.page=t},"update:search":function(t){e.search=t},"search-change":e.searchChange,"search-reset":e.searchReset,"selection-change":e.selectionChange,"current-change":e.currentChange,"size-change":e.sizeChange,"refresh-change":e.refreshChange,"on-load":e.onLoad},scopedSlots:e._u([{key:"tags",fn:function(t){var a=t.row;return[e._v("\n    "+e._s(a.tags.join(","))+"\n  ")]}},{key:"tagsSearch",fn:function(a){return[t("el-input",{attrs:{placeholder:"标签",clearable:""},model:{value:e.search.tagCondition,callback:function(t){e.$set(e.search,"tagCondition",t)},expression:"search.tagCondition"}})]}}])})},n=[],i=(a("ac6a"),a("24a7")),o={data:function(){return{loading:!0,query:{},page:{pageSize:10,currentPage:1,total:0,pageSizes:[10,20,30,40,50,100,1e3,3e3,5e3]},search:{},option:{size:"mini",border:!0,selection:!0,tip:!1,columnBtn:!1,addBtn:!1,menu:!1,searchMenuSpan:12,column:[{label:"appID",prop:"app",search:!0,searchSpan:12},{label:"应用名",prop:"appName",search:!0,searchSpan:12},{label:"标签",prop:"tags",search:!0,searchSpan:12,searchslot:!0,slot:!0}]},data:[],selectionList:[]}},props:{selection:{type:[Object,Array]}},computed:{ids:function(){var e=[];return this.selectionList.forEach((function(t){e.push(t.id)})),e.join(",")}},watch:{selectionList:{deep:!0,handler:function(){this.emitData()}}},methods:{emitData:function(){this.$emit("update:selection",this.selectionList)},searchReset:function(){this.query={},this.onLoad(this.page)},searchChange:function(e,t){this.query=e,this.page.currentPage=1,this.onLoad(this.page,e),t()},selectionChange:function(e){this.selectionList=e},selectionClear:function(){this.selectionList=[],this.$refs.crud.toggleSelection()},currentChange:function(e){this.page.currentPage=e},sizeChange:function(e){this.page.pageSize=e},refreshChange:function(){this.onLoad(this.page,this.query)},onLoad:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,Object(i["f"])(e.currentPage,e.pageSize,Object.assign(a,this.query)).then((function(e){var a=e.data.data;t.page.total=a.total,t.data=a.records,t.loading=!1,t.selectionClear()}))}}},c=o,l=a("2877"),s=Object(l["a"])(c,r,n,!1,null,null,null);t["default"]=s.exports},d4b8:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e._self._c;return t("el-drawer",{attrs:{"append-to-body":"","before-close":e.handleClose,visible:e.visible,title:"回放数据 ID-【".concat(e.id,"】"),size:"60%"},on:{"update:visible":function(t){e.visible=t}}},[t("el-form",{ref:"formData",attrs:{model:e.formData,rules:e.rules,size:"small"}},[t("el-form-item",{attrs:{label:"回放方式:",prop:"mode",rules:{required:!0,message:"请选择回放方式",trigger:"change"}}},e._l(e.playbackMode,(function(a,r){return t("el-radio",{key:r,attrs:{label:a.value},model:{value:e.formData.mode,callback:function(t){e.$set(e.formData,"mode",t)},expression:"formData.mode"}},[e._v(e._s(a.label))])})),1),2===e.formData.mode?[t("el-form-item",{attrs:{label:"回放服务:",required:""}},[t("el-button",{attrs:{size:"mini",type:"primary",icon:"el-icon-plus"},on:{click:function(t){return e.addBackendConfig()}}}),t("el-table",{staticStyle:{margin:"10px 0 20px"},attrs:{data:e.callbackReceivers,border:"",stripe:"",size:"mini","max-height":"240"}},[t("el-table-column",{attrs:{width:"50",align:"center"},scopedSlots:e._u([{key:"header",fn:function(a){return[t("el-checkbox",{attrs:{indeterminate:e.isIndeterminate},on:{change:e.handleCheckAll},model:{value:e.checkAll,callback:function(t){e.checkAll=t},expression:"checkAll"}})]}},{key:"default",fn:function(a){return[t("el-checkbox",{on:{change:e.handleCheckbox},model:{value:a.row.check,callback:function(t){e.$set(a.row,"check",t)},expression:"scope.row.check"}})]}}],null,!1,3696716012)}),t("el-table-column",{attrs:{label:"服务类型"},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v("\n            "+e._s((1===t.row.type?"服务编排":2===t.row.type&&"服务发现")||t.row.type)+"\n          ")]}}],null,!1,477322755)}),t("el-table-column",{attrs:{prop:"service",label:"服务名"}}),t("el-table-column",{attrs:{prop:"path",label:"路径"}})],1),e._l(e.formData.receivers,(function(a,r){return t("div",{key:r,staticClass:"multiple-config"},[t("el-form-item",{attrs:{label:"【新增服务".concat(r+1,"】类型："),"label-width":"180px",required:""}},[t("el-radio-group",{on:{change:function(t){return e.changeType(a)}},model:{value:a.type,callback:function(t){e.$set(a,"type",t)},expression:"item.type"}},[t("el-radio",{attrs:{label:1}},[e._v("服务编排")]),t("el-radio",{attrs:{label:2}},[e._v("服务发现")])],1)],1),2===a.type?t("el-form-item",{attrs:{label:"注册中心：","label-width":"92px",prop:"receivers."+r+".registryName",rules:[{required:!0,message:"注册中心不能为空",trigger:"change"}]}},[t("el-select",{attrs:{filterable:"",placeholder:"请选择 注册中心",clearable:""},on:{change:function(t){return e.changeRegister(a)}},model:{value:a.registryName,callback:function(t){e.$set(a,"registryName",t)},expression:"item.registryName"}},e._l(e.registerList,(function(e,a){return t("el-option",{key:a,attrs:{label:e.value,value:e.value}})})),1)],1):e._e(),t("el-form-item",{attrs:{label:"服务名：","label-width":"80px",prop:"receivers."+r+".service",rules:{required:!0,message:"服务名不能为空",trigger:"change"}}},[1===a.type?[t("el-select",{attrs:{placeholder:"请选择服务名",filterable:"",clearable:""},model:{value:a.service,callback:function(t){e.$set(a,"service",t)},expression:"item.service"}},e._l(e.aggregateServiceOptions,(function(e,a){return t("el-option",{key:a,attrs:{label:e.value,value:e.value}})})),1)]:2===a.type?[t("el-select",{attrs:{filterable:"",placeholder:"请选择服务名",clearable:""},model:{value:a.service,callback:function(t){e.$set(a,"service",t)},expression:"item.service"}},e._l(e.registerMap[a.registryName],(function(e,a){return t("el-option",{key:a,attrs:{label:e.value,value:e.value}})})),1)]:e._e()],2),t("el-form-item",{attrs:{label:"路径：","label-width":"80px",prop:"receivers."+r+".path",rules:[{required:!0,message:"路径不能为空",trigger:"blur"},{pattern:/^(\/($|[a-zA-Z0-9.,?'\\+&%$#=~_-]+))*$/,message:"请填写正确的路径",trigger:"blur"}]}},[t("el-input",{staticClass:"backend-path",attrs:{placeholder:"转发目标路径，不支持模糊匹配",clearable:""},model:{value:a.path,callback:function(t){e.$set(a,"path",t)},expression:"item.path"}})],1),t("div",[t("el-button",{attrs:{size:"mini",type:"danger",icon:"el-icon-delete",circle:""},on:{click:function(t){return e.deleteRow(r,e.formData.receivers)}}})],1)],1)}))],2)]:e._e()],2),t("footer",{staticClass:"drawer-footer"},[t("el-button",{attrs:{size:"small",type:"primary",loading:e.loading},on:{click:e.hadnleConfirm}},[e._v("确 定")]),t("el-button",{attrs:{size:"small"},on:{click:function(t){return e.handleClose()}}},[e._v("取 消")])],1)],1)},n=[],i=(a("8e6e"),a("456d"),a("ac6a"),a("bd86")),o=(a("c5f6"),a("5880")),c=a("27fc"),l=a("4c7d"),s=a("3bfd"),u=a("0a6a");function p(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function d(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?p(Object(a),!0).forEach((function(t){Object(i["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var f={name:"publish-dialog",data:function(){return{loading:!1,formData:{receivers:[]},rules:{},playbackMode:c["d"],callbackReceivers:[],isIndeterminate:!1,checkAll:!1,registerMap:{},registerList:[]}},props:{visible:{type:Boolean,default:!1},name:{type:String,default:"*"},id:{type:[String,Number],required:!0},configId:{type:[String,Number],required:!0}},watch:{visible:function(e){e||(this.remark="")},configId:function(e){e&&this.getCallbackReceivers(e)},callbackReceivers:{deep:!0,handler:function(){this.handleCheckbox()}}},computed:d(d({},Object(o["mapGetters"])(["aggregateServiceOptions","discoveryServiceOptions"])),{},{checkList:function(){return this.callbackReceivers.filter((function(e){return!0===e.check}))||[]}}),created:function(){this.getAggregateServiceOptions(),this.getRegisterNameList()},methods:d(d({},Object(o["mapActions"])(["getAggregateServiceOptions"])),{},{deleteRow:function(e,t){t.splice(e,1)},addBackendConfig:function(){this.formData.receivers.push({type:1,service:"",path:"",registryName:""})},getCallbackReceivers:function(e){var t=this;Object(l["a"])(e).then((function(e){t.callbackReceivers=e.data.data||[]}))},handleCheckbox:function(){var e=this.callbackReceivers.filter((function(e){return!0===e.check})),t=e.length;this.checkAll=t===this.callbackReceivers.length,this.isIndeterminate=t>0&&t<this.callbackReceivers.length},handleCheckAll:function(e){this.callbackReceivers=this.callbackReceivers.map((function(t){return t.check=e,t})),this.isIndeterminate=!1},hadnleConfirm:function(){var e=this;this.$refs.formData.validate((function(t){if(t){var a={id:e.id,mode:e.formData.mode};if(e.formData.receivers.map((function(e){return 1===e.type&&delete e.registryName,e})),a.receivers=(e.checkList||[]).concat(e.formData.receivers||[]),2===e.formData.mode&&!a.receivers.length)return e.$message.error("选择接收回放的服务，服务不能为空"),!1;e.loading=!0,Object(l["d"])(a).then((function(){e.$message.success("回放成功"),e.$emit("update:visible",!1)})).finally((function(){e.loading=!1}))}}))},handleClose:function(e){this.$emit("update:visible",!1),e&&e()},changeRegister:function(e){e.service="",this.getDiscoveryServiceOptions(e.registryName)},getDiscoveryServiceOptions:function(e){var t=this;e&&Object(s["d"])({registryName:e}).then((function(a){var r=a.data.data||[],n=[];r.forEach((function(e){n.push({label:e,value:e})})),t.$set(t.registerMap,e,n)}))},getRegisterNameList:function(){var e=this;Object(u["d"])().then((function(t){if(200===t.data.code){var a=t.data.data;a.forEach((function(t){e.registerList.push({label:t,value:t})}))}}))},changeType:function(e){e.service="",e.registryName=""}})},h=f,g=(a("2f4c"),a("2877")),m=Object(g["a"])(h,r,n,!1,null,"10b73090",null);t["default"]=m.exports},e2a3:function(e,t,a){},fa27:function(e,t,a){"use strict";a("0c58")},fb07:function(e,t,a){},ffb0:function(e,t,a){"use strict";a("fb07")}}]);