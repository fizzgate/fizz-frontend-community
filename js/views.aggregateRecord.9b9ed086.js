/*!
 * Fizz-Admin v2.2.3
 * (c) 2020-2021 Joker-Lee
 * AGPL v3 Licensed.
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views.aggregateRecord"],{"0f98":function(t,e,a){},"100c":function(t,e,a){},"134f":function(t,e,a){"use strict";a.d(e,"b",(function(){return s})),a.d(e,"a",(function(){return c}));a("8e6e"),a("ac6a"),a("456d");var i=a("ade3"),r=a("b5c6"),n=a("da71");function o(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function l(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?o(Object(a),!0).forEach((function(e){Object(i["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var s=function(t,e,a){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply/listApproval"),method:"get",params:l(l({},a),{},{current:t,size:e})})},c=function(t){return Object(r["a"])({url:"".concat(n["a"],"/blade-aggregate-apply/approve"),method:"post",data:t})}},"163d":function(t,e,a){"use strict";a("5cf2")},"1a1f":function(t,e,a){"use strict";a.r(e);var i,r,n=a("0f43"),o={name:"apply",data:function(){return{form:{},query:{},loading:!0,page:{pageSize:10,currentPage:1,total:0},data:[],detailDialog:{visible:!1,data:[],id:""}}},watch:{data:function(){var t=this;this.$nextTick((function(){t.$refs.crud.refreshTable()}))}},methods:{rowView:function(t){var e=this;this.detailDialog.id=t.id,Object(n["d"])(this.detailDialog.id).then((function(t){e.detailDialog.data=t.data.data,e.detailDialog.visible=!0}))},searchReset:function(){this.option.column=this.option.column.map((function(t){return delete t.searchValue,t})),this.query={},this.onLoad(this.page)},searchChange:function(t,e){if(t.createTime&&t.createTime.length>0&&(t.createTimeStart=t.createTime[0],t.createTimeEnd=t.createTime[1],delete t.createTime),new Date(t.createTimeStart)>new Date(t.createTimeEnd))return this.$message.error("请选择结束时间晚于开始时间"),!1;this.query=t,this.page.currentPage=1,this.onLoad(this.page,t),e()},currentChange:function(t){this.page.currentPage=t},sizeChange:function(t){this.page.pageSize=t},refreshChange:function(){this.onLoad(this.page,this.query)}}},l=o,s=a("2877"),c=Object(s["a"])(l,i,r,!1,null,"7d40383e",null);e["default"]=c.exports},"1e65":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("basic-container",[a("avue-crud",{ref:"crud",attrs:{data:t.data,page:t.page,option:t.option,"table-loading":t.loading,permission:t.permissionList},on:{"update:page":function(e){t.page=e},"search-change":t.searchChange,"search-reset":t.searchReset,"current-change":t.currentChange,"size-change":t.sizeChange,"refresh-change":t.refreshChange,"on-load":t.onLoad},scopedSlots:t._u([{key:"type",fn:function(e){var a=e.row;return[t._v("\n      "+t._s((0===a.type?"发布":1===a.type&&"下线")||a.type)+"\n    ")]}},{key:"status",fn:function(e){var i=e.row;return[1===i.status?a("span",{staticClass:"color-danger"},[t._v("审核不通过")]):2===i.status?a("span",{staticClass:"color-success"},[t._v("审核通过")]):a("span",[t._v(t._s(0===i.status?"待审核":3===i.status&&"撤回"))])]}},{key:"menu",fn:function(e){var i=e.row,r=e.type,n=e.size;e.index;return[a("el-button",{attrs:{size:n,type:r},on:{click:function(e){return t.rowView(i)}}},[t._v("查看")]),t.permissionList.auditBtn&&0===i.status?a("el-button",{attrs:{size:n,type:r},on:{click:function(e){return t.rowAudit(i)}}},[t._v("审核")]):t._e()]}}])}),a("audit-detail",{attrs:{visible:t.detailDialog.visible,audit:!0,id:t.detailDialog.id,data:t.detailDialog.data,callback:t.refreshChange},on:{"update:visible":function(e){return t.$set(t.detailDialog,"visible",e)}}}),a("el-dialog",{attrs:{title:"["+t.auditDialog.title+"]-审核","append-to-body":"",visible:t.auditDialog.visible,width:"500px"},on:{"update:visible":function(e){return t.$set(t.auditDialog,"visible",e)}}},[a("el-form",{attrs:{size:"small","label-width":"100px"}},[a("el-form-item",{attrs:{label:"审核结果：",required:""}},[a("el-radio-group",{model:{value:t.auditDialog.type,callback:function(e){t.$set(t.auditDialog,"type",e)},expression:"auditDialog.type"}},t._l(t.auditState,(function(e){return a("el-radio",{key:e.value,attrs:{label:e.value}},[t._v(t._s(e.label))])})),1)],1),a("el-form-item",{attrs:{label:"审核备注："}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"审核备注（选填）"},model:{value:t.auditDialog.remark,callback:function(e){t.$set(t.auditDialog,"remark",e)},expression:"auditDialog.remark"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small",loading:t.auditDialog.loading},on:{click:t.auditConfirm}},[t._v("确 定\n      ")]),a("el-button",{attrs:{size:"small"},on:{click:function(e){t.auditDialog.visible=!1}}},[t._v("取 消")])],1)],1)],1)},r=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("ade3")),o=a("134f"),l=a("cec1"),s=a("5880"),c=a("1a1f"),u=a("218b");function p(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function d(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?p(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):p(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var f={data:function(){return{query:{status:0},option:{dialogWidth:900,border:!0,index:!0,addBtn:!1,editBtn:!1,delBtn:!1,columnBtn:!1,menuWidth:100,menuPosition:"right",column:[{label:"申请时间",prop:"createTime",searchRange:!0,search:!0,searchSpan:12,type:"datetime",valueFormat:"yyyy-MM-dd HH:mm:ss"},{label:"标题",prop:"title",search:!0,minWidth:180},{label:"操作类型",prop:"type",slot:!0,width:80},{label:"申请人",prop:"createBy"},{label:"审核状态",prop:"status",slot:!0,width:100,search:!0,type:"select",searchValue:0,dicData:l["a"]}]},auditDialog:{visible:!1,loading:!1,title:"",id:"",remark:""}}},mixins:[c["default"]],components:{auditDetail:u["default"]},computed:d(d({},Object(s["mapGetters"])(["permission"])),{},{permissionList:function(){return{auditBtn:this.vaildData(this.permission.aggregate_apply_audit,!1),viewBtn:this.vaildData(this.permission.aggregateRecord_audit_view,!1)}},auditState:function(){return l["b"]}}),methods:{rowView:function(t){this.detailDialog.id=t.id;var e="/aggregateRecord/auditDetail";this.$router.push({path:e,query:{originId:t.id}})},rowAudit:function(t){this.auditDialog.id=t.id,this.auditDialog.title=t.title,this.auditDialog.visible=!0},auditConfirm:function(){var t=this;if(!this.auditDialog.type)return this.$message.error("请选择审核结果"),!1;var e={};return e.id=this.auditDialog.id,e.approvalResult=this.auditDialog.type,e.approvalRemark=this.auditDialog.remark,this.auditDialog.loading=!0,Object(o["a"])(e).then((function(){t.$message.success("审核成功"),t.onLoad(t.page),t.auditDialog.visible=!1,t.auditDialog.loading=!1})).catch((function(){t.auditDialog.loading=!1}))},onLoad:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,Object(o["b"])(t.currentPage,t.pageSize,Object.assign(a,this.query)).then((function(t){var a=t.data.data;e.page.total=a.total,e.data=a.records,e.loading=!1}))}}},m=f,b=a("2877"),g=Object(b["a"])(m,i,r,!1,null,null,null);e["default"]=g.exports},"218b":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"audit-detail",attrs:{title:t.title,"append-to-body":"",top:"5vh",width:"60%",visible:t.visible,"before-close":t.handleClose},on:{"update:visible":function(e){t.visible=e}}},[a("div",{staticClass:"apply-table-wrap"},[a("div",{staticClass:"b-tip"},[t._v("操作以下接口：")]),a("el-table",{attrs:{data:t.tableData,border:"",stripe:"",size:"mini","max-height":"200"}},[a("el-table-column",{attrs:{prop:"serviceName",label:"所属服务"}}),a("el-table-column",{attrs:{prop:"name",label:"接口名"}})],1)],1),a("el-form",{ref:"auditForm",staticClass:"data-form",attrs:{model:t.auditForm,rules:t.rules,disabled:!t.permissionList.auditBtn,size:"mini","label-width":"100px"}},[a("el-form-item",{attrs:{label:"标题："}},[t._v("\n      "+t._s(t.auditForm.title)+"\n    ")]),a("el-form-item",{attrs:{label:"申请类型："}},[t._v("\n      "+t._s((0===t.auditForm.type?"发布":1===t.auditForm.type&&"下线")||t.auditForm.type||"-")+"\n    ")]),a("el-form-item",{attrs:{label:"申请原因："}},[t._v("\n      "+t._s(t.auditForm.reason)+"\n    ")]),a("el-form-item",{attrs:{label:"申请人："}},[t._v("\n      "+t._s(t.auditForm.applyBy||t.auditForm.createBy)+"\n    ")]),a("el-form-item",{attrs:{label:"申请时间："}},[t._v("\n      "+t._s(t.auditForm.createTime)+"\n    ")]),t.auditPermission?[a("el-form-item",{attrs:{label:"审核结果：",prop:"approvalResult",required:""}},[a("el-radio-group",{model:{value:t.auditForm.approvalResult,callback:function(e){t.$set(t.auditForm,"approvalResult",e)},expression:"auditForm.approvalResult"}},t._l(t.auditState,(function(e){return a("el-radio",{key:e.value,attrs:{label:e.value}},[t._v(t._s(e.label))])})),1)],1),a("el-form-item",{attrs:{label:"审核备注：",prop:"approvalRemark"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"审核备注（选填）"},model:{value:t.auditForm.approvalRemark,callback:function(e){t.$set(t.auditForm,"approvalRemark",e)},expression:"auditForm.approvalRemark"}})],1)]:[a("el-form-item",{attrs:{label:"审核人："}},[t._v("\n        "+t._s(t.auditForm.approvalBy)+"\n      ")]),a("el-form-item",{attrs:{label:"审核结果："}},[2===t.auditForm.approvalResult?a("el-tag",{attrs:{size:"mini",type:"success"}},[t._v("审核通过")]):1===t.auditForm.approvalResult?a("el-tag",{attrs:{size:"mini",type:"danger"}},[t._v("审核不通过")]):a("span",[t._v(t._s(t.auditForm.approvalResult))])],1),a("el-form-item",{attrs:{label:"审核备注："}},[t._v("\n        "+t._s(t.auditForm.approvalRemark)+"\n      ")]),a("el-form-item",{attrs:{label:"审核时间："}},[t._v("\n        "+t._s(t.auditForm.approvalTime)+"\n      ")])]],2),t.auditPermission?a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t.permissionList.auditBtn?a("el-button",{attrs:{type:"primary",size:"small",loading:t.loading},on:{click:t.confirm}},[t._v("审核\n    ")]):t._e(),a("el-button",{attrs:{size:"small"},on:{click:function(e){return t.handleClose()}}},[t._v("取消")])],1):t._e()],1)},r=[],n=(a("8e6e"),a("456d"),a("ac6a"),a("ade3")),o=(a("c5f6"),a("5880")),l=a("134f"),s=a("cec1");function c(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function u(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?c(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var p={name:"apply-detail",data:function(){return{loading:!1,tableData:[],auditForm:{type:"",remark:""}}},props:{visible:{type:Boolean,default:!1},title:{type:String,default:"发布|下线审核"},audit:{type:Boolean,default:!1},id:{type:[String,Number],required:!0},data:{type:Object,required:!0},callback:{type:Function}},computed:u(u({},Object(o["mapGetters"])(["permission"])),{},{permissionList:function(){return{auditBtn:this.vaildData(this.permission.aggregate_apply_audit,!1)}},auditState:function(){return s["b"]},auditPermission:function(){return this.permissionList.auditBtn&&this.audit&&0===this.auditForm.status||!1}}),components:{},watch:{data:{immediate:!0,handler:function(){this.init()}}},methods:{confirm:function(){var t=this;if(!this.auditForm.approvalResult)return this.$message.error("请选择审核结果"),!1;var e={};return e.id=this.auditForm.id,e.approvalResult=this.auditForm.approvalResult,e.approvalRemark=this.auditForm.approvalRemark,this.loading=!0,Object(l["a"])(e).then((function(){t.callback&&"function"===typeof t.callback&&t.callback(),t.$message.success("审核成功"),t.$emit("update:visible",!1),t.loading=!1})).catch((function(){t.loading=!1}))},init:function(){this.auditForm=this.data;var t=[];(this.data.configs||[]).forEach((function(e){t.push(Object.assign({id:e.configId,name:e.configName},e))})),this.tableData=t},handleClose:function(t){this.$emit("update:visible",!1),t&&t()}}},d=p,f=(a("7fc3"),a("5d17"),a("2877")),m=Object(f["a"])(d,i,r,!1,null,"2092a22f",null);e["default"]=m.exports},"340c":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("basic-container",[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"audit-detail"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("b",[t._v("发布|下线审核详情")])]),a("div",{staticClass:"apply-table-wrap"},[a("div",{staticClass:"b-tip"},[t._v("操作以下接口：")]),a("el-table",{attrs:{data:t.tableData,border:"",stripe:"",size:"mini","max-height":"200"}},[a("el-table-column",{attrs:{prop:"serviceName",label:"所属服务"}}),a("el-table-column",{attrs:{prop:"name",label:"接口名"}})],1)],1),a("el-form",{ref:"auditForm",staticClass:"data-form",attrs:{model:t.auditForm,rules:t.rules,disabled:!t.permissionList.auditBtn,size:"mini","label-width":"100px"}},[a("el-form-item",{attrs:{label:"标题："}},[t._v("\n        "+t._s(t.auditForm.title)+"\n      ")]),a("el-form-item",{attrs:{label:"申请类型："}},[t._v("\n        "+t._s((0===t.auditForm.type?"发布":1===t.auditForm.type&&"下线")||t.auditForm.type||"-")+"\n      ")]),a("el-form-item",{attrs:{label:"申请原因："}},[t._v("\n        "+t._s(t.auditForm.reason)+"\n      ")]),a("el-form-item",{attrs:{label:"申请人："}},[t._v("\n        "+t._s(t.auditForm.applyBy||t.auditForm.createBy)+"\n      ")]),a("el-form-item",{attrs:{label:"申请时间："}},[t._v("\n        "+t._s(t.auditForm.createTime)+"\n      ")]),t.auditPermission?[a("el-form-item",{attrs:{label:"审核结果：",prop:"approvalResult",required:""}},[a("el-radio-group",{model:{value:t.auditForm.approvalResult,callback:function(e){t.$set(t.auditForm,"approvalResult",e)},expression:"auditForm.approvalResult"}},t._l(t.auditState,(function(e){return a("el-radio",{key:e.value,attrs:{label:e.value}},[t._v(t._s(e.label))])})),1)],1),a("el-form-item",{attrs:{label:"审核备注：",prop:"approvalRemark"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:3,maxRows:5},placeholder:"审核备注（选填）"},model:{value:t.auditForm.approvalRemark,callback:function(e){t.$set(t.auditForm,"approvalRemark",e)},expression:"auditForm.approvalRemark"}})],1)]:[a("el-form-item",{attrs:{label:"审核人："}},[t._v("\n          "+t._s(t.auditForm.approvalBy)+"\n        ")]),a("el-form-item",{attrs:{label:"审核结果："}},[2===t.auditForm.approvalResult?a("el-tag",{attrs:{size:"mini",type:"success"}},[t._v("审核通过")]):1===t.auditForm.approvalResult?a("el-tag",{attrs:{size:"mini",type:"danger"}},[t._v("审核不通过")]):a("span",[t._v(t._s(t.auditForm.approvalResult))])],1),a("el-form-item",{attrs:{label:"审核备注："}},[t._v("\n          "+t._s(t.auditForm.approvalRemark)+"\n        ")]),a("el-form-item",{attrs:{label:"审核时间："}},[t._v("\n          "+t._s(t.auditForm.approvalTime)+"\n        ")])]],2),t.auditPermission?a("footer",[t.permissionList.auditBtn?a("el-button",{attrs:{type:"primary",size:"small",icon:"el-icon-circle-check",loading:t.loading},on:{click:t.confirm}},[t._v("审核\n      ")]):t._e(),a("el-button",{attrs:{size:"small",icon:"el-icon-circle-close"},on:{click:function(e){return t.handleClose()}}},[t._v("取消")])],1):t._e()],1)],1)},r=[],n=(a("8e6e"),a("456d"),a("ac6a"),a("ade3")),o=a("5880"),l=a("134f"),s=a("cec1"),c=a("0f43");function u(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function p(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?u(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):u(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var d={name:"audit-detail",data:function(){return{loading:!1,tableData:[],auditForm:{type:"",remark:""}}},computed:p(p({},Object(o["mapGetters"])(["permission"])),{},{permissionList:function(){return{auditBtn:this.vaildData(this.permission.aggregate_apply_audit,!1)}},auditState:function(){return s["b"]},auditPermission:function(){return this.permissionList.auditBtn&&0===this.auditForm.status||!1},originId:function(){return this.$route.query.originId||""}}),components:{},watch:{originId:{immediate:!0,handler:function(t){t&&this.init()}}},methods:{init:function(){var t=this;Object(c["d"])(this.originId).then((function(e){var a=e.data.data,i=[];t.auditForm=a,(a.configs||[]).forEach((function(t){i.push(Object.assign({id:t.configId,name:t.configName},t))})),t.tableData=i}))},confirm:function(){var t=this;if(!this.auditForm.approvalResult)return this.$message.error("请选择审核结果"),!1;var e={};return e.id=this.auditForm.id,e.approvalResult=this.auditForm.approvalResult,e.approvalRemark=this.auditForm.approvalRemark,this.loading=!0,Object(l["a"])(e).then((function(){t.init(),t.$message.success("审核成功"),t.loading=!1})).catch((function(){t.loading=!1}))},handleClose:function(){this.$router.$avueRouter.closeTag(),this.$router.push({path:"/aggregateRecord/audit"})}}},f=d,m=(a("39cf"),a("3b96"),a("2877")),b=Object(m["a"])(f,i,r,!1,null,"5382e071",null);e["default"]=b.exports},"39cf":function(t,e,a){"use strict";a("849e")},"3b96":function(t,e,a){"use strict";a("9542")},"480d":function(t,e,a){"use strict";a("100c")},"5cf2":function(t,e,a){},"5d17":function(t,e,a){"use strict";a("c2ee")},6119:function(t,e,a){"use strict";a("8076")},"62bb":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("basic-container",[a("el-card",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"audit-detail"},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("b",[t._v("发布|下线申请详情")])]),a("div",{staticClass:"apply-table-wrap"},[a("div",{staticClass:"b-tip"},[t._v("操作以下接口：")]),a("el-table",{attrs:{data:t.tableData,border:"",stripe:"",size:"mini","max-height":"200"}},[a("el-table-column",{attrs:{prop:"serviceName",label:"所属服务"}}),a("el-table-column",{attrs:{prop:"name",label:"接口名"}}),a("el-table-column",{attrs:{align:"center",label:"状态",width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.formData.id===e.row.applyId?[t._v("\n              "+t._s(t.getApprovalStateName(e.row.approvalState))+"\n            ")]:[t._v("-")]]}}])}),2===t.formData.status?a("el-table-column",{attrs:{fixed:"right",align:"center",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.formData.id===e.row.applyId?[t.permissionList.publishBtn&&2===e.row.approvalState?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.publish(e.row)}}},[t._v("\n                发布\n              ")]):t._e(),t.permissionList.offlineBtn&&3===e.row.approvalState?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.offline(e.row)}}},[t._v("\n                下线\n              ")]):t._e(),!t.permissionList.revokeBtn||2!==e.row.approvalState&&3!==e.row.approvalState?t._e():a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.rowRevoke(e.row)}}},[t._v("\n                撤回\n              ")])]:t._e()]}}],null,!1,945224970)}):t._e()],1)],1),a("el-form",{staticClass:"data-form",attrs:{size:"mini","label-width":"100px"}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"标题："}},[t._v("\n            "+t._s(t.formData.title)+"\n          ")])],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请人："}},[t._v("\n            "+t._s(t.formData.createBy)+"\n          ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核人："}},[t._v("\n            "+t._s(t.formData.approvalBy)+"\n          ")])],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请类型："}},[t._v("\n            "+t._s((0===t.formData.type?"发布":1===t.formData.type&&"下线")||t.formData.type||"-")+"\n          ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核结果："}},[1===t.formData.approvalResult?a("el-tag",{attrs:{size:"mini",type:"danger"}},[t._v("审核不通过")]):2===t.formData.approvalResult?a("el-tag",{attrs:{size:"mini",type:"success"}},[t._v("审核通过")]):a("span",[t._v(t._s(t.formData.approvalResult))])],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请原因："}},[t._v("\n            "+t._s(t.formData.reason)+"\n          ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核备注："}},[t._v("\n            "+t._s(t.formData.approvalRemark)+"\n          ")])],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请时间："}},[t._v("\n            "+t._s(t.formData.createTime)+"\n          ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核时间："}},[t._v("\n            "+t._s(t.formData.approvalTime)+"\n          ")])],1)],1)],1),t.logData&&0!==t.logData.length?[a("el-divider",[t._v("操作日志")]),a("el-table",{attrs:{data:t.logData,border:"",stripe:"",size:"mini","max-height":"300"}},[a("el-table-column",{attrs:{align:"center",label:"操作类型",width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n            "+t._s(t.getOpTypeName(e.row.opType))+"\n          ")]}}],null,!1,3264585741)}),a("el-table-column",{attrs:{prop:"serviceName",label:"所属服务"}}),a("el-table-column",{attrs:{prop:"name",label:"接口名"}}),a("el-table-column",{attrs:{prop:"opBy",label:"操作人"}}),a("el-table-column",{attrs:{prop:"opTime",label:"操作时间"}}),a("el-table-column",{attrs:{prop:"remark",label:"备注"}})],1)]:t._e(),0===t.formData.status||2===t.formData.status?a("footer",[2===t.formData.status?[t.permissionList.rollback?a("el-button",{attrs:{type:"primary",size:"small",loading:t.rollbackLoading,plain:""},on:{click:t.rollback}},[t._v("\n          批量回滚\n        ")]):t._e(),0===t.formData.type&&t.permissionList.batchPublishBtn||1===t.formData.type&&t.permissionList.batchOfflineBtn?a("el-button",{attrs:{type:"primary",size:"small",loading:t.executeLoading,plain:""},on:{click:t.execute}},[t._v("\n          "+t._s((0===t.formData.type?"批量发布":1===t.formData.type&&"批量下线")||"批量执行")+"\n        ")]):t._e()]:t._e(),0===t.formData.status?[t.permissionList.applyBtn?a("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:t.changeAudit}},[t._v("\n          修改审核人\n        ")]):t._e(),t.permissionList.revokeBtn?a("el-button",{attrs:{type:"primary",size:"small",loading:t.revokeLoading},on:{click:t.revoke}},[t._v("撤回\n        ")]):t._e()]:t._e(),a("el-button",{attrs:{size:"small"},on:{click:function(e){return t.handleClose()}}},[t._v("返回")])],2):t._e(),a("revoke-dialog",{attrs:{visible:t.revokeDialog.visible,form:t.revokeDialog.form,id:t.revokeDialog.id,callback:t.init},on:{"update:visible":function(e){return t.$set(t.revokeDialog,"visible",e)}}}),a("publish-dialog",{attrs:{visible:t.publishDialog.visible,name:t.publishDialog.name,id:t.publishDialog.id,callback:t.init},on:{"update:visible":function(e){return t.$set(t.publishDialog,"visible",e)}}}),a("el-dialog",{attrs:{"append-to-body":"",title:"修改审核人",visible:t.auditDialogVisible},on:{"update:visible":function(e){t.auditDialogVisible=e}}},[a("el-form",{attrs:{model:t.auditForm,size:"small"}},[a("el-form-item",{attrs:{label:"审核人"}},[a("el-select",{attrs:{placeholder:"请选择审核人"},model:{value:t.auditForm.approvalUser,callback:function(e){t.$set(t.auditForm,"approvalUser",e)},expression:"auditForm.approvalUser"}},t._l(t.approvalUsers,(function(t){return a("el-option",{key:t.userId,attrs:{label:t.userName,value:t.userId}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleAuditChange}},[t._v("确 定")]),a("el-button",{attrs:{size:"small"},on:{click:function(e){t.auditDialogVisible=!1}}},[t._v("取 消")])],1)],1)],2)],1)},r=[],n=(a("8e6e"),a("456d"),a("7f7f"),a("7514"),a("ac6a"),a("ade3")),o=a("0f43"),l=a("708f"),s=a("f874"),c=a("cec1"),u=a("5880"),p=a("047b"),d=a("c43f");function f(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function m(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?f(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var b={name:"apply-detail",data:function(){return{revokeLoading:!1,executeLoading:!1,rollbackLoading:!1,tableData:[],logData:[],approvalUsers:[],formData:{},publishDialog:{visible:!1,title:"接口",name:"",id:""},revokeDialog:{visible:!1,form:{},id:""},auditForm:{applyId:"",approvalUser:""},auditDialogVisible:!1}},computed:m(m({},Object(u["mapGetters"])(["permission"])),{},{permissionList:function(){return{applyBtn:this.vaildData(this.permission.aggregate_api_apply,!1),publishBtn:this.vaildData(this.permission.aggregate_api_publish,!1),offlineBtn:this.vaildData(this.permission.aggregate_api_offline,!1),batchPublishBtn:this.vaildData(this.permission.aggregate_apply_batchPublish,!1),batchOfflineBtn:this.vaildData(this.permission.aggregate_apply_batchOffline,!1),revokeBtn:this.vaildData(this.permission.aggregate_apply_revoke,!1),rollback:this.vaildData(this.permission.aggregate_apply_rollback,!1)}},ids:function(){var t=[];return this.tableData.forEach((function(e){t.push(e.id||e.configId)})),t},originId:function(){return this.$route.query.originId||""}}),components:{publishDialog:p["default"],revokeDialog:d["default"]},watch:{originId:{immediate:!0,handler:function(t){t&&this.init()}}},methods:{getOpTypeName:function(t){var e=c["c"].find((function(e){return parseInt(e.value)===t}));return e&&e.label||t},getApprovalStateName:function(t){var e=s["b"].find((function(e){return parseInt(e.value)===t}));return e&&e.label||""},getApprovalUsers:function(){var t=this;if(!this.ids||0===this.ids.length)return!1;Object(l["e"])({configIds:this.ids}).then((function(e){var a=e.data.data;t.approvalUsers=a.approvalUsers||[]}))},handleAuditChange:function(){var t=this;this.auditDialogVisible=!1;var e={};return e.applyId=this.auditForm.applyId,e.approvalUserId=this.auditForm.approvalUser,Object(o["a"])(e).then((function(){t.$message.success("修改成功"),t.init(),t.auditDialogVisible=!1}))},changeAudit:function(){this.getApprovalUsers(),this.auditForm.applyId=this.formData.id,this.auditForm.approvalUser=this.formData.approvalUser,this.auditDialogVisible=!0},rowRevoke:function(t){this.revokeDialog.id=this.originId,this.revokeDialog.visible=!0,this.revokeDialog.form=t},revoke:function(){var t=this;this.$confirm("确定撤回该申请?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return t.revokeLoading=!0,Object(o["g"])(t.originId).then((function(){t.$message.success("撤回成功"),t.init(),t.revokeLoading=!1})).catch((function(){t.revokeLoading=!1}))}))},execute:function(){var t=this;this.$confirm("确定批量执行该申请的操作?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return t.executeLoading=!0,Object(o["b"])(t.originId).then((function(){t.$message.success("操作成功"),t.init(),t.executeLoading=!1})).catch((function(){t.executeLoading=!1}))}))},rollback:function(){var t=this;this.$confirm("确定批量回滚该申请的操作?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return t.rollbackLoading=!0,Object(o["h"])(t.originId).then((function(){t.init(),t.$message.success("回滚成功"),t.rollbackLoading=!1})).catch((function(){t.rollbackLoading=!1}))}))},offline:function(t){var e=this;this.$confirm("确定下线【".concat(t.name,"】此接口吗?"),{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return Object(l["i"])(t.id)})).then((function(){e.$message.success("下线成功"),e.init()}))},publish:function(t){t.id?(this.publishDialog.visible=!0,this.publishDialog.name=t.name,this.publishDialog.id=t.id):this.$message.error("数据缺失，无法发布！")},handleClose:function(){this.$router.$avueRouter.closeTag(),this.$router.push({path:"/aggregateRecord/apply"})},getApplyLog:function(){var t=this;return this.logData=[],Object(o["c"])(this.originId).then((function(e){t.logData=e.data.data}))},getDetail:function(){var t=this;Object(o["d"])(this.originId).then((function(e){var a=e.data.data,i=[];t.formData=a,(a.configs||[]).forEach((function(t){i.push(Object.assign({id:t.configId,name:t.configName},t))})),t.tableData=i}))},init:function(){this.getDetail(),this.getApplyLog()}}},g=b,h=(a("6119"),a("480d"),a("2877")),v=Object(h["a"])(g,i,r,!1,null,"33c684c2",null);e["default"]=v.exports},6356:function(t,e,a){"use strict";a("b3f0")},7079:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{staticClass:"apply-detail",attrs:{title:"发布|下线申请","append-to-body":"",top:"5vh",width:"70%",visible:t.visible,"before-close":t.handleClose},on:{"update:visible":function(e){t.visible=e}}},[a("div",{staticClass:"apply-table-wrap"},[a("div",{staticClass:"b-tip"},[t._v("操作以下接口：")]),a("el-table",{attrs:{data:t.tableData,border:"",stripe:"",size:"mini","max-height":"200"}},[a("el-table-column",{attrs:{prop:"serviceName",label:"所属服务"}}),a("el-table-column",{attrs:{prop:"name",label:"接口名"}}),a("el-table-column",{attrs:{align:"center",label:"状态",width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.formData.id===e.row.applyId?[t._v("\n            "+t._s(t.getApprovalStateName(e.row.approvalState))+"\n          ")]:[t._v("-")]]}}])}),2===t.formData.status?a("el-table-column",{attrs:{fixed:"right",align:"center",label:"操作",width:"100"},scopedSlots:t._u([{key:"default",fn:function(e){return[t.formData.id===e.row.applyId?[t.permissionList.publishBtn&&2===e.row.approvalState?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.publish(e.row)}}},[t._v("\n              发布\n            ")]):t._e(),t.permissionList.offlineBtn&&3===e.row.approvalState?a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.offline(e.row)}}},[t._v("\n              下线\n            ")]):t._e(),!t.permissionList.revokeBtn||2!==e.row.approvalState&&3!==e.row.approvalState?t._e():a("el-button",{attrs:{type:"text",size:"small"},nativeOn:{click:function(a){return a.preventDefault(),t.rowRevoke(e.row)}}},[t._v("\n              撤回\n            ")])]:t._e()]}}],null,!1,4163813898)}):t._e()],1)],1),a("el-form",{staticClass:"data-form",attrs:{size:"mini","label-width":"100px"}},[a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{attrs:{label:"标题："}},[t._v("\n          "+t._s(t.formData.title)+"\n        ")])],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请人："}},[t._v("\n          "+t._s(t.formData.createBy)+"\n        ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核人："}},[t._v("\n          "+t._s(t.formData.approvalBy)+"\n        ")])],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请类型："}},[t._v("\n          "+t._s((0===t.formData.type?"发布":1===t.formData.type&&"下线")||t.formData.type||"-")+"\n        ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核结果："}},[1===t.formData.approvalResult?a("el-tag",{attrs:{size:"mini",type:"danger"}},[t._v("审核不通过")]):2===t.formData.approvalResult?a("el-tag",{attrs:{size:"mini",type:"success"}},[t._v("审核通过")]):a("span",[t._v(t._s(t.formData.approvalResult))])],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请原因："}},[t._v("\n          "+t._s(t.formData.reason)+"\n        ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核备注："}},[t._v("\n          "+t._s(t.formData.approvalRemark)+"\n        ")])],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"申请时间："}},[t._v("\n          "+t._s(t.formData.createTime)+"\n        ")])],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"审核时间："}},[t._v("\n          "+t._s(t.formData.approvalTime)+"\n        ")])],1)],1)],1),t.logData&&0!==t.logData.length?[a("el-divider",[t._v("操作日志")]),a("el-table",{attrs:{data:t.logData,border:"",stripe:"",size:"mini","max-height":"300"}},[a("el-table-column",{attrs:{align:"center",label:"操作类型",width:"110"},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v("\n          "+t._s(t.getOpTypeName(e.row.opType))+"\n        ")]}}],null,!1,3314202637)}),a("el-table-column",{attrs:{prop:"serviceName",label:"所属服务"}}),a("el-table-column",{attrs:{prop:"name",label:"接口名"}}),a("el-table-column",{attrs:{prop:"opBy",label:"操作人"}}),a("el-table-column",{attrs:{prop:"opTime",label:"操作时间"}}),a("el-table-column",{attrs:{prop:"remark",label:"备注"}})],1)]:t._e(),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[2===t.formData.status?[t.permissionList.rollback?a("el-button",{attrs:{type:"primary",size:"small",loading:t.rollbackLoading,plain:""},on:{click:t.rollback}},[t._v("\n        批量回滚\n      ")]):t._e(),0===t.formData.type&&t.permissionList.batchPublishBtn||1===t.formData.type&&t.permissionList.batchOfflineBtn?a("el-button",{attrs:{type:"primary",size:"small",loading:t.executeLoading,plain:""},on:{click:t.execute}},[t._v("\n        "+t._s((0===t.formData.type?"批量发布":1===t.formData.type&&"批量下线")||"批量执行")+"\n      ")]):t._e()]:t._e(),0===t.formData.status?[t.permissionList.applyBtn?a("el-button",{attrs:{type:"primary",size:"small",plain:""},on:{click:t.changeAudit}},[t._v("\n        修改审核人\n      ")]):t._e(),t.permissionList.revokeBtn?a("el-button",{attrs:{type:"primary",size:"small",loading:t.revokeLoading},on:{click:t.revoke}},[t._v("撤回\n      ")]):t._e()]:t._e(),a("el-button",{attrs:{size:"small"},on:{click:function(e){return t.handleClose()}}},[t._v("取消")])],2),a("revoke-dialog",{attrs:{visible:t.revokeDialog.visible,form:t.revokeDialog.form,id:t.revokeDialog.id,callback:t.revokeCallback},on:{"update:visible":function(e){return t.$set(t.revokeDialog,"visible",e)}}}),a("publish-dialog",{attrs:{visible:t.publishDialog.visible,name:t.publishDialog.name,id:t.publishDialog.id,callback:t.publishCallback},on:{"update:visible":function(e){return t.$set(t.publishDialog,"visible",e)}}}),a("el-dialog",{attrs:{"append-to-body":"",title:"修改审核人",visible:t.auditDialogVisible},on:{"update:visible":function(e){t.auditDialogVisible=e}}},[a("el-form",{attrs:{model:t.auditForm,size:"small"}},[a("el-form-item",{attrs:{label:"审核人"}},[a("el-select",{attrs:{placeholder:"请选择审核人"},model:{value:t.auditForm.approvalUser,callback:function(e){t.$set(t.auditForm,"approvalUser",e)},expression:"auditForm.approvalUser"}},t._l(t.approvalUsers,(function(t){return a("el-option",{key:t.userId,attrs:{label:t.userName,value:t.userId}})})),1)],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:t.handleAuditChange}},[t._v("确 定")]),a("el-button",{attrs:{size:"small"},on:{click:function(e){t.auditDialogVisible=!1}}},[t._v("取 消")])],1)],1)],2)},r=[],n=(a("8e6e"),a("456d"),a("7f7f"),a("7514"),a("ac6a"),a("ade3")),o=(a("c5f6"),a("0f43")),l=a("708f"),s=a("4870"),c=a("5880"),u=a("047b"),p=a("c43f");function d(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function f(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?d(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var m={name:"apply-detail",data:function(){return{revokeLoading:!1,executeLoading:!1,rollbackLoading:!1,tableData:[],logData:[],approvalUsers:[],formData:{},publishDialog:{visible:!1,title:"接口",name:"",id:""},revokeDialog:{visible:!1,form:{},id:""},auditForm:{applyId:"",approvalUser:""},auditDialogVisible:!1}},props:{visible:{type:Boolean,default:!1},id:{type:[String,Number],required:!0},data:{type:Object,required:!0},callback:{type:Function}},computed:f(f({},Object(c["mapGetters"])(["permission"])),{},{permissionList:function(){return{applyBtn:this.vaildData(this.permission.aggregate_api_apply,!1),publishBtn:this.vaildData(this.permission.aggregate_api_publish,!1),offlineBtn:this.vaildData(this.permission.aggregate_api_offline,!1),batchPublishBtn:this.vaildData(this.permission.aggregate_apply_batchPublish,!1),batchOfflineBtn:this.vaildData(this.permission.aggregate_apply_batchOffline,!1),revokeBtn:this.vaildData(this.permission.aggregate_apply_revoke,!1),rollback:this.vaildData(this.permission.aggregate_apply_rollback,!1)}},ids:function(){var t=[];return this.tableData.forEach((function(e){t.push(e.id||e.configId)})),t}}),components:{publishDialog:u["default"],revokeDialog:p["default"]},watch:{visible:function(t){t&&this.getApplyLog()},data:{immediate:!0,handler:function(){this.init()}}},methods:{getOpTypeName:function(t){var e=s["e"].find((function(e){return parseInt(e.value)===t}));return e&&e.label||t},getApprovalStateName:function(t){var e=s["d"].find((function(e){return parseInt(e.value)===t}));return e&&e.label||""},getApprovalUsers:function(){var t=this;if(!this.ids||0===this.ids.length)return!1;Object(l["e"])({configIds:this.ids}).then((function(e){var a=e.data.data;t.approvalUsers=a.approvalUsers||[]}))},handleAuditChange:function(){var t=this;this.auditDialogVisible=!1;var e={};return e.applyId=this.auditForm.applyId,e.approvalUserId=this.auditForm.approvalUser,Object(o["a"])(e).then((function(){t.$message.success("修改成功"),t.auditDialogVisible=!1,setTimeout((function(){t.handleClose(),t.callback&&"function"===typeof t.callback&&t.callback()}),300)}))},changeAudit:function(){this.getApprovalUsers(),this.auditForm.applyId=this.formData.id,this.auditForm.approvalUser=this.formData.approvalUser,this.auditDialogVisible=!0},rowRevoke:function(t){this.revokeDialog.id=this.id,this.revokeDialog.visible=!0,this.revokeDialog.form=t},revoke:function(){var t=this;this.$confirm("确定撤回该申请?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return t.revokeLoading=!0,Object(o["g"])(t.id).then((function(){t.callback&&"function"===typeof t.callback&&t.callback(),t.$message.success("撤回成功"),t.$emit("update:visible",!1),t.revokeLoading=!1})).catch((function(){t.revokeLoading=!1}))}))},revokeCallback:function(){this.changeState(this.revokeDialog.form.id,7),this.getApplyLog()},execute:function(){var t=this;this.$confirm("确定批量执行该申请的操作?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return t.executeLoading=!0,Object(o["b"])(t.id).then((function(){t.callback&&"function"===typeof t.callback&&t.callback(),t.$message.success("操作成功"),t.$emit("update:visible",!1),t.executeLoading=!1})).catch((function(){t.executeLoading=!1}))}))},rollback:function(){var t=this;this.$confirm("确定批量回滚该申请的操作?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return t.rollbackLoading=!0,Object(o["h"])(t.id).then((function(){t.callback&&"function"===typeof t.callback&&t.callback(),t.$message.success("回滚成功"),t.$emit("update:visible",!1),t.rollbackLoading=!1})).catch((function(){t.rollbackLoading=!1}))}))},offline:function(t){var e=this;this.$confirm("确定下线【".concat(t.name,"】此接口吗?"),{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return Object(l["i"])(t.id)})).then((function(){e.$message({type:"success",message:"下线成功"}),e.changeState(t.id)}))},publish:function(t){t.id?(this.publishDialog.visible=!0,this.publishDialog.name=t.name,this.publishDialog.id=t.id):this.$message.error("数据缺失，无法发布！")},publishCallback:function(){this.changeState(this.publishDialog.id)},changeState:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5;this.tableData.map((function(a){if(a.id===t)return a.approvalState=e,a}))},init:function(){this.formData=this.data;var t=[];(this.data.configs||[]).forEach((function(e){t.push(Object.assign({id:e.configId,name:e.configName},e))})),this.tableData=t},handleClose:function(t){this.$emit("update:visible",!1),t&&t()},getApplyLog:function(){var t=this;return this.logData=[],Object(o["c"])(this.id).then((function(e){t.logData=e.data.data}))}}},b=m,g=(a("6356"),a("163d"),a("2877")),h=Object(g["a"])(b,i,r,!1,null,"0c56b194",null);e["default"]=h.exports},"7ec3":function(t,e,a){"use strict";a("0f98")},"7fc3":function(t,e,a){"use strict";a("a945")},8076:function(t,e,a){},"849e":function(t,e,a){},"8fe7":function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("basic-container",[a("avue-crud",{ref:"crud",attrs:{data:t.data,page:t.page,option:t.option,"table-loading":t.loading,permission:t.permissionList},on:{"update:page":function(e){t.page=e},"search-change":t.searchChange,"search-reset":t.searchReset,"current-change":t.currentChange,"size-change":t.sizeChange,"refresh-change":t.refreshChange,"on-load":t.onLoad},scopedSlots:t._u([{key:"type",fn:function(e){var a=e.row;return[t._v("\n      "+t._s((0===a.type?"发布":1===a.type&&"下线")||a.type)+"\n    ")]}},{key:"status",fn:function(e){var i=e.row;return[1===i.status?a("span",{staticClass:"color-danger"},[t._v("审核不通过")]):2===i.status?a("span",{staticClass:"color-success"},[t._v("审核通过")]):a("span",[t._v(t._s(0===i.status?"待审核":3===i.status&&"撤回"))])]}},{key:"menu",fn:function(e){var i=e.row,r=e.type,n=e.size;e.index;return[a("el-button",{attrs:{size:n,type:r},on:{click:function(e){return t.rowView(i)}}},[t._v("查看")]),!t.permissionList.applyBtn||3!==i.status&&1!==i.status?t._e():a("el-button",{attrs:{size:n,type:r},on:{click:function(e){return t.rowEidt(i)}}},[t._v("编辑")]),t.permissionList.revokeBtn&&0===i.status?a("el-button",{attrs:{size:n,type:r},on:{click:function(e){return t.rowRevoke(i)}}},[t._v("撤回")]):t._e()]}}])},[a("template",{slot:"menuLeft"},[t.permissionList.applyBtn?a("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:t.handleApply}},[t._v("发布|下线申请\n      ")]):t._e()],1)],2),a("apply-detail",{attrs:{visible:t.detailDialog.visible,id:t.detailDialog.id,data:t.detailDialog.data,callback:t.refreshChange},on:{"update:visible":function(e){return t.$set(t.detailDialog,"visible",e)}}}),a("apply-dialog",{attrs:{visible:t.applyDialog.visible,list:t.applyDialog.list,form:t.applyDialog.form,id:t.applyDialog.id,callback:t.refreshChange},on:{"update:visible":function(e){return t.$set(t.applyDialog,"visible",e)}}})],1)},r=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("ade3")),o=a("0f43"),l=a("cec1"),s=a("5880"),c=a("1a1f"),u=a("7079"),p=a("247e");function d(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function f(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?d(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):d(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var m={data:function(){return{applyDialog:{visible:!1,list:[]},option:{dialogWidth:900,border:!0,index:!0,addBtn:!1,editBtn:!1,delBtn:!1,columnBtn:!1,menuWidth:100,menuPosition:"right",column:[{label:"申请时间",prop:"createTime",searchRange:!0,search:!0,searchSpan:12,type:"datetime",valueFormat:"yyyy-MM-dd HH:mm:ss"},{label:"标题",prop:"title",search:!0,minWidth:180},{label:"操作类型",prop:"type",slot:!0,width:80},{label:"申请状态",prop:"status",slot:!0,width:100,search:!0,type:"select",dicData:l["a"]},{label:"审核人",prop:"approvalBy"},{label:"审核时间",prop:"approvalTime"}]}}},mixins:[c["default"]],components:{applyDetail:u["default"],applyDialog:p["default"]},computed:f(f({},Object(s["mapGetters"])(["permission"])),{},{permissionList:function(){return{viewBtn:this.vaildData(this.permission.aggregateRecord_apply_view,!1),revokeBtn:this.vaildData(this.permission.aggregate_apply_revoke,!1),applyBtn:this.vaildData(this.permission.aggregate_api_apply,!1)}}}),methods:{rowView:function(t){var e="/aggregateRecord/applyDetail";this.$router.push({path:e,query:{originId:t.id}})},rowEidt:function(t){var e=this;this.applyDialog.id=t.id,Object(o["d"])(t.id).then((function(t){var a=t.data.data;e.applyDialog.visible=!0,e.applyDialog.form=a,e.applyDialog.list=a.configs}))},handleApply:function(){this.applyDialog.id="",this.applyDialog.list=[],this.applyDialog.form={},this.applyDialog.visible=!0},rowRevoke:function(t){var e=this;this.$confirm("确定撤回【".concat(t.title,"】申请吗?"),{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return Object(o["g"])(t.id)})).then((function(){e.onLoad(e.page),e.$message({type:"success",message:"撤回成功"})}))},onLoad:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,Object(o["e"])(t.currentPage,t.pageSize,Object.assign(a,this.query)).then((function(t){var a=t.data.data;e.page.total=a.total,e.data=a.records,e.loading=!1}))}}},b=m,g=a("2877"),h=Object(g["a"])(b,i,r,!1,null,null,null);e["default"]=h.exports},9542:function(t,e,a){},a945:function(t,e,a){},b3f0:function(t,e,a){},c2ee:function(t,e,a){},c43f:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("el-dialog",{attrs:{title:"撤回关联配置","append-to-body":"",visible:t.visible,"before-close":t.handleClose,width:"500px"},on:{"update:visible":function(e){t.visible=e}}},[a("div",{staticClass:"b-tip"},[t._v("确定撤回该申请的【"+t._s(t.form.name)+"】接口吗?")]),a("el-form",{ref:"revokeForm",attrs:{model:t.revokeForm,rules:t.rules,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"备注：",prop:"remark"}},[a("el-input",{attrs:{type:"textarea",autosize:{minRows:2,maxRows:4},placeholder:"请输入备注"},model:{value:t.revokeForm.remark,callback:function(e){t.$set(t.revokeForm,"remark",e)},expression:"revokeForm.remark"}})],1)],1),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small",loading:t.loading},on:{click:t.confirm}},[t._v("确 定\n    ")]),a("el-button",{attrs:{size:"small"},on:{click:function(e){return t.handleClose()}}},[t._v("取 消")])],1)],1)},r=[],n=(a("c5f6"),a("0f43")),o={name:"publish-dialog",data:function(){return{loading:!1,revokeForm:{},rules:{remark:[{required:!0,message:"备注不能为空",trigger:"blur"}]}}},props:{visible:{type:Boolean,default:!1},form:{type:Object,default:function(){return{}}},id:{type:[String,Number],required:!0},callback:{type:Function}},watch:{visible:function(t){t||(this.revokeForm.remark="")}},methods:{confirm:function(){var t=this;this.id?this.$refs.revokeForm.validate((function(e){if(e)return t.loading=!0,Object(n["i"])({applyId:t.id,configId:t.form.id,remark:t.revokeForm.remark}).then((function(){t.callback&&"function"===typeof t.callback&&t.callback(),t.$message.success("撤回成功"),t.$emit("update:visible",!1)})).finally((function(){t.loading=!1}))})):this.$message.error("信息错误，请重新选择！")},handleClose:function(t){this.$emit("update:visible",!1),t&&t()}}},l=o,s=(a("7ec3"),a("2877")),c=Object(s["a"])(l,i,r,!1,null,"9763a388",null);e["default"]=c.exports},e4d1:function(t,e,a){"use strict";a.r(e);var i=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("basic-container",{staticClass:"aggregate-operation-log"},[a("avue-crud",{ref:"crud",attrs:{data:t.data,page:t.page,option:t.option,"table-loading":t.loading},on:{"update:page":function(e){t.page=e},"search-change":t.searchChange,"search-reset":t.searchReset,"current-change":t.currentChange,"size-change":t.sizeChange,"refresh-change":t.refreshChange,"on-load":t.onLoad},scopedSlots:t._u([{key:"type",fn:function(e){var a=e.row;return[t._v("\n      "+t._s((0===a.type?"发布":1===a.type&&"下线")||a.type||"-")+"\n    ")]}},{key:"approvalResult",fn:function(e){var i=e.row;e.size;return[2===i.approvalResult?a("span",{staticClass:"color-success"},[t._v("通过")]):t._e(),1===i.approvalResult?a("span",{staticClass:"color-danger"},[t._v("不通过")]):t._e()]}},{key:"menu",fn:function(e){var i=e.row,r=e.type,n=e.size;return[a("el-button",{attrs:{icon:"el-icon-view",size:n,type:r},on:{click:function(e){return t.rowView(i)}}},[t._v("查看\n      ")])]}}])}),a("audit-detail",{attrs:{visible:t.detailDialog.visible,title:"发布|下线审核日志",id:t.detailDialog.id,data:t.detailDialog.data,callback:t.refreshChange},on:{"update:visible":function(e){return t.$set(t.detailDialog,"visible",e)}}})],1)},r=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("ade3")),o=a("b5c6"),l=a("da71");function s(t,e){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),a.push.apply(a,i)}return a}function c(t){for(var e=1;e<arguments.length;e++){var a=null!=arguments[e]?arguments[e]:{};e%2?s(Object(a),!0).forEach((function(e){Object(n["a"])(t,e,a[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(a,e))}))}return t}var u=function(t,e,a){return Object(o["a"])({url:"".concat(l["a"],"/blade-aggregate-apply-approval-log/list"),method:"get",params:c(c({},a),{},{current:t,size:e})})},p=function(t){return Object(o["a"])({url:"".concat(l["a"],"/blade-aggregate-apply-approval-log/detail/").concat(t),method:"get",params:{id:t}})},d=a("cec1"),f=a("218b"),m={name:"audit-log",data:function(){return{query:{},loading:!0,page:{pageSize:10,currentPage:1,total:0},option:{menuWidth:80,border:!0,index:!0,addBtn:!1,editBtn:!1,delBtn:!1,columnBtn:!1,menuPosition:"right",column:[{label:"申请时间",prop:"applyTime"},{label:"标题",prop:"title",search:!0},{label:"申请人",prop:"applyBy"},{label:"申请类型",prop:"type",width:80,slot:!0},{label:"审核人",prop:"approvalBy"},{label:"审核结果",prop:"approvalResult",slot:!0,width:80,search:!0,type:"select",dicData:d["b"]},{label:"审核时间",prop:"approvalTime",searchRange:!0,search:!0,searchSpan:12,type:"datetime",valueFormat:"yyyy-MM-dd HH:mm:ss"}]},data:[],detailDialog:{visible:!1,data:[],id:""}}},components:{auditDetail:f["default"]},watch:{data:function(){var t=this;this.$nextTick((function(){t.$refs.crud.refreshTable()}))}},methods:{rowView:function(t){var e=this;t.id?(this.detailDialog.id=t.id,p(this.detailDialog.id).then((function(t){e.detailDialog.data=t.data.data,e.detailDialog.visible=!0}))):this.$message.error("数据有误！")},searchReset:function(){this.query={},this.onLoad(this.page)},searchChange:function(t,e){t.approvalTime&&t.approvalTime.length>0&&(t.approvalTimeStart=t.approvalTime[0],t.approvalTimeEnd=t.approvalTime[1],delete t.approvalTime),this.query=t,this.page.currentPage=1,this.onLoad(this.page,t),e()},currentChange:function(t){this.page.currentPage=t},sizeChange:function(t){this.page.pageSize=t},refreshChange:function(){this.onLoad(this.page,this.query)},onLoad:function(t){var e=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,u(t.currentPage,t.pageSize,Object.assign(a,this.query)).then((function(t){var a=t.data.data;e.page.total=a.total,e.data=a.records,e.loading=!1}))}}},b=m,g=a("2877"),h=Object(g["a"])(b,i,r,!1,null,"5a3dfcee",null);e["default"]=h.exports}}]);