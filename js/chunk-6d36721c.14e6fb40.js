/*!
 * Fizz-Admin v3.2.0-beta1
 * (c) 2020-2024 Joker-Lee
 * AGPL v3 Licensed.
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6d36721c"],{"1f8e":function(e,t,r){"use strict";r("356d")},"21a0":function(e,t,r){},"288b":function(e,t,r){"use strict";r("9fec")},"356d":function(e,t,r){},6577:function(e,t,r){"use strict";r.r(t);var a=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"requestForm",staticClass:"request-item-form",attrs:{size:"small",model:e.requestForm,rules:e.rules,disabled:e.disabled,"label-width":"110px"}},[e._t("name"),t("el-form-item",{key:"serviceName",attrs:{label:"端点名：",prop:"serviceName"}},[t("el-select",{staticClass:"service-name-select",attrs:{placeholder:"请选择端点名",filterable:"",clearable:""},on:{change:e.changeServiceName},model:{value:e.requestForm.serviceName,callback:function(t){e.$set(e.requestForm,"serviceName",t)},expression:"requestForm.serviceName"}},e._l(e.httpServiceOptions,(function(r,a){return t("el-option",{key:a,attrs:{label:e.renderServiceName(r),value:r.service}})})),1),!e.disabled&&e.permissionList.serviceAddBtn?t("el-button",{staticStyle:{"margin-left":"10px"},attrs:{type:"primary",plain:""},on:{click:function(t){e.showHttpServiceAdd=!0}}},[e._v("新增SOAP服务\n    ")]):e._e()],1),t("el-form-item",{key:"method",attrs:{label:"请求方法：",prop:"method"}},[t("el-select",{attrs:{placeholder:"请选择请求方法",filterable:"",clearable:""},model:{value:e.requestForm.method,callback:function(t){e.$set(e.requestForm,"method",t)},expression:"requestForm.method"}},e._l(e.serviceMethodList,(function(e,r){return t("el-option",{key:r,attrs:{label:e.value,value:e.value}})})),1)],1),t("el-form-item",{staticClass:"form-item-with-unit",attrs:{label:"超时时间",prop:"timeout"}},[t("el-input-number",{attrs:{"controls-position":"right",min:0,placeholder:"例：10000"},model:{value:e.requestForm.timeout,callback:function(t){e.$set(e.requestForm,"timeout",t)},expression:"requestForm.timeout"}}),t("span",{staticClass:"unit"},[e._v("毫秒")])],1),t("el-form-item",{staticClass:"form-item-with-unit",attrs:{label:"失败重试",prop:"numRetries"}},[t("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.requestForm.numRetries,callback:function(t){e.$set(e.requestForm,"numRetries",t)},expression:"requestForm.numRetries"}}),t("span",{staticClass:"unit"},[e._v("次")])],1),t("el-form-item",{staticClass:"form-item-with-unit",attrs:{label:"重试间隔",prop:"retryInterval"}},[t("el-input-number",{attrs:{"controls-position":"right",min:0},model:{value:e.requestForm.retryInterval,callback:function(t){e.$set(e.requestForm,"retryInterval",t)},expression:"requestForm.retryInterval"}}),t("span",{staticClass:"unit"},[e._v("毫秒")])],1),t("el-form-item",{attrs:{label:"Fallback",prop:"fallback"}},[t("el-select",{attrs:{clearable:""},model:{value:e.requestForm.fallback.mode,callback:function(t){e.$set(e.requestForm.fallback,"mode",t)},expression:"requestForm.fallback.mode"}},[t("el-option",{attrs:{label:"stop",value:"stop"}}),t("el-option",{attrs:{label:"continue",value:"continue"}})],1)],1),e.requestForm.fallback&&"continue"===e.requestForm.fallback.mode?t("el-form-item",{attrs:{label:"Fallback响应Json",prop:"fallback.defaultResult"}},[t("el-input",{attrs:{type:"textarea",placeholder:"当Fallback=continue时填写"},model:{value:e.requestForm.fallback.defaultResult,callback:function(t){e.$set(e.requestForm.fallback,"defaultResult",t)},expression:"requestForm.fallback.defaultResult"}})],1):e._e(),t("el-form-item",{attrs:{label:"请求预处理",prop:"condition"}},[t("el-checkbox",{on:{change:e.conditionChange},model:{value:e.requestForm.conditionFlag,callback:function(t){e.$set(e.requestForm,"conditionFlag",t)},expression:"requestForm.conditionFlag"}},[e._v("设置预处理（预处理脚本返回true时才执行请求）\n      ")]),e.requestForm.conditionFlag?t("el-form-item",{attrs:{label:"脚本配置"}},[e.scriptId?t("div",[t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.openScript()}}},[e._v("\n            "+e._s("{ aggregate_config_script_id: ".concat(e.scriptId," }"))+"\n          ")]),t("el-button",{attrs:{type:"text"},on:{click:function(t){return e.deleteScript(e.scriptId)}}},[e._v("\n            删除\n          ")])],1):t("el-button",{attrs:{type:"text",disabled:e.disabled},on:{click:function(t){return e.openScript()}}},[e._v("\n          "+e._s(e.disabled?"无":"新增")+"\n        ")]),t("script-dialog",{attrs:{visible:e.scriptVisible,callback:e.scriptCallback,"business-type":e.businessType,disabled:e.disabled,id:e.scriptId,isDelScriptWithHttp:e.isDelScriptWithHttp},on:{"update:visible":function(t){e.scriptVisible=t},"update:id":function(t){e.scriptId=t}}})],1):e._e()],1),[t("el-form-item",{attrs:{label:"配置入参"}},[t("data-params",{key:"restRequest",staticClass:"highlight-border",attrs:{"business-type":e.businessType,"has-body":!0,data:e.requestForm.dataMapping.request,"has-query":!1,"multiple-values":!1,"content-type":e.requestForm.dataMapping.request.contentType,isDelScriptWithHttp:e.isDelScriptWithHttp,disabled:e.disabled},on:{"update:data":function(t){return e.$set(e.requestForm.dataMapping,"request",t)}}},[t("template",{slot:"body"},[t("el-form-item",{attrs:{label:"内容类型",prop:"contentType"}},[t("el-radio-group",{model:{value:e.requestForm.dataMapping.request.contentType,callback:function(t){e.$set(e.requestForm.dataMapping.request,"contentType",t)},expression:"requestForm.dataMapping.request.contentType"}},[t("el-radio",{attrs:{label:"application/soap+xml"}},[e._v("JSON")]),t("el-radio",{attrs:{label:"text/xml"}},[e._v("XML")])],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"application/xml"===e.requestForm.dataMapping.request.contentType,expression:"requestForm.dataMapping.request.contentType === 'application/xml'"}],staticClass:"key-tips"},[e._v("\n                入参按XML配置，网关会将JSON转换为原始的XML，请参考\n                "),t("el-link",{on:{click:function(t){e.xmlInoVisible=!0}}},[e._v("XML和JSON间的转换规则")])],1)],1)],1),t("template",{slot:"header"},[t("el-form-item",{attrs:{label:"内容类型",prop:"contentType"}},[t("el-radio-group",{model:{value:e.requestForm.dataMapping.request.contentType,callback:function(t){e.$set(e.requestForm.dataMapping.request,"contentType",t)},expression:"requestForm.dataMapping.request.contentType"}},[t("el-radio",{attrs:{label:"application/soap+xml"}},[e._v("JSON")]),t("el-radio",{attrs:{label:"application/xml"}},[e._v("XML")])],1),t("div",{directives:[{name:"show",rawName:"v-show",value:"application/xml"===e.requestForm.dataMapping.request.contentType,expression:"requestForm.dataMapping.request.contentType === 'application/xml'"}],staticClass:"key-tips"},[e._v("\n                入参按XML配置，网关会将JSON转换为原始的XML，请参考\n                "),t("el-link",{on:{click:function(t){e.xmlInoVisible=!0}}},[e._v("XML和JSON间的转换规则")])],1)],1)],1)],2)],1),t("el-form-item",{attrs:{label:"配置响应"}},[t("data-params",{key:"restResponse",staticClass:"highlight-border",attrs:{"header-name":"响应头","body-name":"响应体","business-type":e.businessType,"has-query":!1,data:e.requestForm.dataMapping.response,isDelScriptWithHttp:e.isDelScriptWithHttp,disabled:e.disabled},on:{"update:data":function(t){return e.$set(e.requestForm.dataMapping,"response",t)}}},[t("template",{slot:"body"},[t("el-form-item",{attrs:{label:"内容类型",prop:"contentType"}},[t("el-radio-group",{model:{value:e.requestForm.dataMapping.response.contentType,callback:function(t){e.$set(e.requestForm.dataMapping.response,"contentType",t)},expression:"requestForm.dataMapping.response.contentType"}},[t("el-radio",{attrs:{label:"auto"}},[e._v("Auto")]),t("el-radio",{attrs:{label:"application/soap+xml"}},[e._v("JSON")]),t("el-radio",{attrs:{label:"application/xml"}},[e._v("XML")]),t("el-radio",{attrs:{label:"text/plain"}},[e._v("Text")])],1),t("div",{staticClass:"key-tips"},[e._v("\n                Content-Type类型，默认根据响应头自动识别，如果响应头的Content-Type和响应内容类型不匹配时可手动选择内容类型。\n                当内容类型为XML时网关接收后会把它转换为JSON, 响应体按转换后的JSON格式配置即可\n              ")])],1),"application/xml"===e.requestForm.dataMapping.response.contentType?t("el-form-item",{attrs:{label:"数组节点路径",prop:"xmlArrPaths"}},[t("el-input",{attrs:{clearable:""},model:{value:e.requestForm.dataMapping.response.xmlArrPaths,callback:function(t){e.$set(e.requestForm.dataMapping.response,"xmlArrPaths",t)},expression:"requestForm.dataMapping.response.xmlArrPaths"}}),t("span",{staticClass:"key-tips"},[e._v("\n                输入XML响应体里数组节点的路径, 多个路径用逗号分隔，如：/root/data/user 用于指明user标签可能有多个要转换成一个JSON数组，\n                而不是转换成一个JSON对象。此字段仅在响应体为XML时有效。\n                "),t("el-link",{on:{click:function(t){e.xmlInoVisible=!0}}},[e._v("XML和JSON间的转换规则")])],1)],1):e._e()],1)],2)],1)]],2),t("service-dynamic-detail",{attrs:{type:"add",title:"新增SOAP服务","service-type":4,visible:e.showHttpServiceAdd,callback:e.getSoapServiceOptions},on:{"update:visible":function(t){e.showHttpServiceAdd=t}}}),t("xml-info",{attrs:{visible:e.xmlInoVisible},on:{"update:visible":function(t){e.xmlInoVisible=t}}})],1)},i=[],s=(r("8e6e"),r("456d"),r("ac6a"),r("c5f6"),r("bd86")),o=r("2fa9"),n=r("942a"),l=r("921f"),c=r("5880"),p=r("16cd"),u=r("c54a"),d=r("b5c6"),m=r("da71"),f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(d["a"])({url:"".concat(m["a"],"/web-service/service-method-list"),method:"post",data:e})},b=r("1763"),h=r("74a0"),v=r("9fa8"),g=r("c983"),q=r("7b22");function y(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function F(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?y(Object(r),!0).forEach((function(t){Object(s["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):y(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var O={name:"step-request-item",data:function(){return{page:{pageSize:1e5,currentPage:1,total:0},requestForm:{components:[]},rules:{type:[{required:!0,message:"必填",trigger:"change"}],method:[{required:!0,message:"必填",trigger:"change"}],serviceName:[{required:!0,message:"必填",trigger:"change"}],protocol:[{required:!0,message:"必填",trigger:"change"}],serviceType:[{required:!0,message:"必填",trigger:"change"}],path:[{required:!0,message:"必填",trigger:"blur"}],"fallback.defaultResult":[{validator:function(e,t,r){t&&!Object(u["k"])(t)?r(new Error("请输入正确格式的JSON")):r()},trigger:"blur"}]},scriptVisible:!1,scriptId:"",showRpcSelector:!1,showRpcAdd:!1,newUrlTrigger:!1,showHttpServiceAdd:!1,httpServiceOptions:[],xmlInoVisible:!1,registerList:[],serviceMethodList:[]}},computed:F(F({},Object(c["mapGetters"])(["apiMethod","permission"])),{},{permissionList:function(){return{serviceAddBtn:this.vaildData(this.permission.rpc_service_add,!1)}}}),props:{showAddComponent:{type:Boolean,default:!0},data:{type:Array,default:function(){return[]}},disabled:{type:Boolean,default:!1},businessType:{type:String},isDelScriptWithHttp:{type:Boolean,default:!0}},components:{scriptDialog:o["default"],dataParams:n["default"],rpcApiSelector:b["default"],rpcApiDetail:h["default"],serviceDynamicDetail:v["default"],xmlInfo:l["default"],addComponent:g["default"]},watch:{data:{immediate:!0,deep:!0,handler:function(){this.initData()}},"data.serviceName":{deep:!0,immediate:!0,handler:function(){this.getServiceMethodOptions(this.data.serviceName)}}},created:function(){this.getSoapServiceOptions()},methods:F(F({},Object(c["mapActions"])(["removeScript"])),{},{renderServiceName:function(e){return e.description?"".concat(e.service,"  (").concat(e.description,")"):e.service},getSoapServiceOptions:function(){var e=this;Object(q["d"])({type:4}).then((function(t){e.loading=!1,e.httpServiceOptions=t.data.data.records||[]}))},initData:function(){var e=this.data||{};this.scriptId&&(e.conditionFlag=!0),e.fallback||(e.fallback={}),e.dataMapping||(e.dataMapping={request:{},response:{}}),e.condition||(e.condition={}),e.components||(e.components=[]);var t="string"===typeof e.condition?JSON.parse(e.condition):e.condition;this.scriptId=t&&t["aggregate_config_script_id"]||"",this.requestForm=e},handleData:function(){return""===this.requestForm.timeout?delete this.requestForm.timeout:this.requestForm.timeout&&(this.requestForm.timeout=Number(this.requestForm.timeout)),this.requestForm.fallback&&""===this.requestForm.fallback.mode&&delete this.requestForm.fallback.mode,Object(p["c"])(this.requestForm)},emitData:function(){this.$emit("update:data",this.handleData())},validate:function(){var e=this;return this.emitData(),new Promise((function(t,r){e.$refs.requestForm.validate((function(e){e?t():r()}))}))},openScript:function(){this.scriptVisible=!0},conditionChange:function(e){e||(this.requestForm.condition={})},scriptCallback:function(){this.requestForm.condition=this.scriptId?{aggregate_config_script_id:this.scriptId}:{}},deleteScript:function(e){var t=this;this.$confirm("确定删除该脚本?",{type:"warning"}).then((function(){if(!t.isDelScriptWithHttp)return t.$store.commit("SET_WILL_DEL_SCRIPT_IDS",e),void t.delCallback();t.removeScript(e).then((function(){t.delCallback()}))}))},delCallback:function(){this.scriptId="",this.requestForm.condition={},this.$message.success("删除成功")},changeServiceName:function(e){this.$set(this.requestForm,"method",""),this.getServiceMethodOptions(e)},getServiceMethodOptions:function(e){var t=this;e?f({serviceName:e,type:4}).then((function(e){var r=e.data.data||[];t.serviceMethodList=[],r.forEach((function(e){t.serviceMethodList.push({label:e,value:e})}))})):this.serviceMethodList=[]}})},k=O,S=(r("288b"),r("c0f9"),r("2877")),_=Object(S["a"])(k,a,i,!1,null,"b7cfdef4",null);t["default"]=_.exports},"9fec":function(e,t,r){},ac60:function(e,t,r){"use strict";r.r(t);r("7f7f");var a=function(){var e=this,t=e._self._c;return t("div",[t("el-form",{ref:"requestForm",attrs:{model:e.requestForm,"label-width":"80px"}},[t("soapItem",e._b({ref:"requestItem",attrs:{showAddComponent:!1,data:e.requestForm,disabled:e.disabled,isDelScriptWithHttp:e.isDelScriptWithHttp},on:{"update:data":function(t){e.requestForm=t}}},"soapItem",e.$attrs,!1),[t("template",{slot:"name"},[t("el-form-item",{attrs:{label:"节点名称",prop:"name"}},[t("el-input",{attrs:{placeholder:"节点名称"},model:{value:e.requestForm.name,callback:function(t){e.$set(e.requestForm,"name",t)},expression:"requestForm.name"}})],1)],1)],2),t("footer",{staticClass:"drawer-footer"},[e.disabled||"detail"===e.dialogType?e._e():t("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.submitForm()}}},[e._v("\n        确 定\n      ")]),t("el-button",{attrs:{size:"small"},on:{click:e.onCancel}},[e._v("\n        "+e._s(e.disabled||"detail"===e.dialogType?"关 闭":" 取 消")+"\n      ")])],1)],1)],1)},i=[],s=(r("8e6e"),r("ac6a"),r("456d"),r("bd86")),o=r("6577"),n=r("78e6"),l=r("4c07");function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function p(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){Object(s["a"])(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u={name:"",components:{stepItem:l["default"],soapItem:o["default"],apiStep:n["default"]},watch:{"requestForm.name":{deep:!0,immediate:!0,handler:function(e){var t=e,r=this.$props.nodeData,a=r.id;if(t&&t!=a){var i=this.$props.lf.getModelById(r.id);i.changeId(t),this.$props.nodeData.id=t}}}},props:{disabled:{type:Boolean,default:!1},isDelScriptWithHttp:{type:Boolean,default:!0},nodeData:Object,lf:Object||String},created:function(){var e=this.$props.nodeData,t=e.properties,r=e.id;t&&(this.$data.requestForm=p(p({},this.$data.requestForm),t)),this.$data.requestForm=p(p({},this.$data.requestForm),{},{name:r})},data:function(){return{request:{},requestForm:{}}},methods:{submitForm:function(){var e=this,t=this.$props.nodeData;t.properties=this.$data.requestForm,this.$refs.requestItem&&this.$refs.requestItem.validate().then((function(){e.$props.lf.setProperties(t.id,e.$data.requestForm),e.$emit("setPropertiesFinish")})).catch((function(){e.$message.error("请完善步骤信息")}))},onCancel:function(){this.$emit("setPropertiesFinish")}}},d=u,m=(r("1f8e"),r("2877")),f=Object(m["a"])(d,a,i,!1,null,"295176e2",null);t["default"]=f.exports},c0f9:function(e,t,r){"use strict";r("21a0")}}]);