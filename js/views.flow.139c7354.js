/*!
 * Fizz-Admin v2.6.6
 * (c) 2020-2022 Joker-Lee
 * AGPL v3 Licensed.
 */
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["views.flow"],{"16cd":function(e,t,a){"use strict";a.d(t,"a",(function(){return r})),a.d(t,"b",(function(){return o}));a("456d"),a("ac6a"),a("a481");function r(e){return e&&"string"===typeof e?e.replace(/(^\s*)|(\s*$)/g,""):e}function o(e){return Object.keys(e).forEach((function(t){"string"===typeof e[t]&&(e[t]=r(e[t]))})),e}},"55fd":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("basic-container",[a("avue-crud",{ref:"crud",attrs:{"before-open":e.beforeOpen,data:e.data,page:e.page,search:e.search,option:e.option,"table-loading":e.loading,permission:e.permissionList},on:{"update:page":function(t){e.page=t},"update:search":function(t){e.search=t},"row-del":e.rowDel,"row-update":e.rowUpdate,"row-save":e.rowSave,"search-change":e.searchChange,"search-reset":e.searchReset,"current-change":e.currentChange,"size-change":e.sizeChange,"refresh-change":e.refreshChange,"on-load":e.onLoad},scopedSlots:e._u([{key:"serviceSearch",fn:function(t){return[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:e.search.service,callback:function(t){e.$set(e.search,"service",t)},expression:"search.service"}},e._l(e.frontendServiceOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]}}]),model:{value:e.form,callback:function(t){e.form=t},expression:"form"}}),a("el-dialog",{attrs:{"append-to-body":"",width:"900px","close-on-click-modal":!1,title:e.detailDialog.title,visible:e.detailDialog.visible},on:{"update:visible":function(t){return e.$set(e.detailDialog,"visible",t)}}},[a("el-form",{ref:"dialogForm",attrs:{model:e.dialogForm,rules:e.dialogRules,size:"small",disabled:"view"===e.detailDialog.type,"label-width":"155px"}},[a("el-form-item",{attrs:{label:"前端服务名",prop:"service"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:""},model:{value:e.dialogForm.service,callback:function(t){e.$set(e.dialogForm,"service",t)},expression:"dialogForm.service"}},e._l(e.frontendServiceOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"前端API路径",prop:"path"}},[a("el-input",{attrs:{placeholder:"请输入前端API路径",clearable:""},model:{value:e.dialogForm.path,callback:function(t){e.$set(e.dialogForm,"path",t)},expression:"dialogForm.path"}}),a("span",{staticClass:"key-tips"},[e._v("如果接口URL为http://网关IP:port/proxy/user-service/user/list, 则输入/user/list，如果不配置路径则按服务限流")])],1),a("el-form-item",{attrs:{label:"集群共享QPS",prop:"qps"}},[a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"num-tips"},[e._v(e._s(e.dialogForm.qps*e.machineCount||""))]),a("span",[e._v("  =  ")]),a("el-input",{staticStyle:{width:"180px"},attrs:{clearable:""},model:{value:e.dialogForm.qps,callback:function(t){e.$set(e.dialogForm,"qps",t)},expression:"dialogForm.qps"}}),a("span",[e._v("（单机）* "+e._s(e.machineCount))])],1)]),a("el-form-item",{attrs:{label:"集群共享并发数",prop:"concurrent"}},[a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"num-tips"},[e._v(e._s(e.dialogForm.concurrent*e.machineCount||""))]),a("span",[e._v("  =  ")]),a("el-input",{staticStyle:{width:"180px"},attrs:{clearable:""},model:{value:e.dialogForm.concurrent,callback:function(t){e.$set(e.dialogForm,"concurrent",t)},expression:"dialogForm.concurrent"}}),a("span",[e._v("（单机）* "+e._s(e.machineCount))])],1)]),a("el-form-item",{attrs:{label:"限流响应ContentType:",prop:"responseContentType"}},[a("el-input",{attrs:{placeholder:"请输入ContentType",clearable:""},model:{value:e.dialogForm.responseContentType,callback:function(t){e.$set(e.dialogForm,"responseContentType",t)},expression:"dialogForm.responseContentType"}}),a("span",{staticClass:"key-tips"},[e._v("如果不配置则使用默认规则里的限流响应ContentType")])],1),a("el-form-item",{attrs:{label:"限流响应报文：",prop:"responseContent"}},[a("el-input",{attrs:{type:"textarea",rows:"5",placeholder:"请输入响应报文",clearable:""},model:{value:e.dialogForm.responseContent,callback:function(t){e.$set(e.dialogForm,"responseContent",t)},expression:"dialogForm.responseContent"}}),a("span",{staticClass:"key-tips"},[e._v("如果不配置则使用默认规则里的限流响应报文")])],1)],1),"view"!==e.detailDialog.type?a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small",loading:e.detailDialog.loading},on:{click:e.submitForm}},[e._v("提 交\n      ")]),a("el-button",{attrs:{size:"small"},on:{click:function(t){e.detailDialog.visible=!1}}},[e._v("取 消")])],1):e._e()],1)],1)},o=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("6762"),a("2fdb"),a("ade3")),i=a("b5c6"),l=a("da71");function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){Object(n["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var p=function(e,t,a){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/path/list"),method:"get",params:c(c({},a),{},{current:e,size:t})})},u=function(e){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/path/detail/").concat(e),method:"get"})},d=function(e){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/path/remove"),method:"post",params:{ids:e}})},f=function(e){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/path/save"),method:"post",data:e})},g=function(e){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/path/update"),method:"post",data:e})},b=a("6be7"),m=a("5880"),h=a("16cd");function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function y(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(Object(a),!0).forEach((function(t){Object(n["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var D={name:"flow-api",data:function(){return{form:{},search:{},query:{},loading:!0,page:{pageSize:10,currentPage:1,total:0},option:{dialogWidth:900,border:!0,index:!0,dialogClickModal:!1,columnBtn:!1,menuPosition:"right",searchLabelWidth:95,column:[{label:"前端服务名",prop:"service",search:!0,searchslot:!0,searchSpan:8},{label:"前端API路径",prop:"path",search:!0},{label:"单机QPS",prop:"qps"},{label:"单机并发数",prop:"concurrent"}]},data:[],globalData:{},dialogForm:{},dialogRules:{service:[{required:!0,message:"必填",trigger:"change"}],path:[{pattern:/^[^\u4e00-\u9fa5]+$/,message:"请勿输入中文字符",trigger:"blur"},{pattern:/^(\/)+/,message:"请参照例子正确填写路径, 开头不可缺少 '/' 符号",trigger:"blur"}],qps:[{pattern:/^[1-9][0-9]*$/,message:"请输入大于0的整数",trigger:"blur"}],concurrent:[{pattern:/^[1-9][0-9]*$/,message:"请输入大于0的整数",trigger:"blur"}]},detailDialog:{visible:!1,title:"详情",type:"",loading:!1}}},computed:y(y({},Object(m["mapGetters"])(["permission","frontendServiceOptions"])),{},{machineCount:function(){return this.globalData.machineCount||0}}),watch:{data:function(){var e=this;this.$nextTick((function(){e.$refs.crud.refreshTable()}))}},created:function(){this.getGlobalRule(),this.getFrontendServiceOptions()},methods:y(y({},Object(m["mapActions"])(["getFrontendServiceOptions"])),{},{getGlobalRule:function(){var e=this;Object(b["a"])().then((function(t){var a=t.data.data;e.globalData=a||{}}))},submitForm:function(){var e=this;this.$refs.dialogForm.validate((function(t){if(t){var a=Object(h["b"])(e.dialogForm);if(!a.qps&&!a.concurrent)return e.$message.error("单机QPS、单机并发数，请至少填写一个"),!1;"edit"===e.detailDialog.type?e.rowUpdate(a):e.rowSave(a)}}))},rowSave:function(e){var t=this;this.detailDialog.loading=!0,f(e).then((function(){t.onLoad(t.page),t.$message({type:"success",message:"保存成功"}),t.detailDialog.visible=!1}),(function(e){window.console.log(e)})).finally((function(){t.detailDialog.loading=!1}))},rowUpdate:function(e){var t=this;this.detailDialog.loading=!0,g(e).then((function(){t.onLoad(t.page),t.$message({type:"success",message:"修改成功"}),t.detailDialog.visible=!1}),(function(e){window.console.log(e)})).finally((function(){t.detailDialog.loading=!1}))},rowDel:function(e){var t=this;this.$confirm("你确定要删除此流控规则吗?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return d(e.id)})).then((function(){t.onLoad(t.page),t.$message({type:"success",message:"删除成功"})}))},beforeOpen:function(e,t){var a=this;switch(this.dialogForm={},this.detailDialog.type=t,t){case"add":this.detailDialog.title="新增";break;case"edit":this.detailDialog.title="编辑";break;case"view":this.detailDialog.title="查看";break;default:this.detailDialog.title="详情";break}["edit","view"].includes(t)?u(this.form.id).then((function(e){a.form=e.data.data,a.dialogForm=Object.assign({},e.data.data||{}),a.detailDialog.visible=!0})):this.detailDialog.visible=!0},searchReset:function(){this.query={},this.onLoad(this.page)},searchChange:function(e,t){this.query=e,this.page.currentPage=1,this.onLoad(this.page,e),t()},currentChange:function(e){this.page.currentPage=e},sizeChange:function(e){this.page.pageSize=e},refreshChange:function(){this.onLoad(this.page,this.query)},onLoad:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,p(e.currentPage,e.pageSize,Object.assign(a,this.query)).then((function(e){var a=e.data.data;t.page.total=a.total,t.data=a.records,t.loading=!1}))}})},O=D,w=(a("c42a"),a("2877")),C=Object(w["a"])(O,r,o,!1,null,"0c30ecab",null);t["default"]=C.exports},"62bb":function(e,t,a){},"6be7":function(e,t,a){"use strict";a.d(t,"a",(function(){return n})),a.d(t,"b",(function(){return i}));var r=a("b5c6"),o=a("da71"),n=function(){return Object(r["a"])({url:"".concat(o["a"],"/flow-control-rule/get-global-rule"),method:"get"})},i=function(e){return Object(r["a"])({url:"".concat(o["a"],"/flow-control-rule/save-global-rule"),method:"post",data:e})}},"859b":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("basic-container",[a("avue-crud",{ref:"crud",attrs:{"before-open":e.beforeOpen,data:e.data,page:e.page,search:e.search,option:e.option,"table-loading":e.loading,permission:e.permissionList},on:{"update:page":function(t){e.page=t},"update:search":function(t){e.search=t},"row-del":e.rowDel,"row-update":e.rowUpdate,"row-save":e.rowSave,"search-change":e.searchChange,"search-reset":e.searchReset,"current-change":e.currentChange,"size-change":e.sizeChange,"refresh-change":e.refreshChange,"on-load":e.onLoad},scopedSlots:e._u([{key:"appSearch",fn:function(t){return[a("el-select",{attrs:{placeholder:"请选择调用方",filterable:"",clearable:""},model:{value:e.search.app,callback:function(t){e.$set(e.search,"app",t)},expression:"search.app"}},e._l(e.appOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label+"("+e.value+")",value:e.value}})})),1)]}},{key:"serviceSearch",fn:function(t){return[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:e.search.service,callback:function(t){e.$set(e.search,"service",t)},expression:"search.service"}},e._l(e.frontendServiceOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]}}]),model:{value:e.form,callback:function(t){e.form=t},expression:"form"}}),a("el-dialog",{attrs:{"append-to-body":"",width:"900px","close-on-click-modal":!1,title:e.detailDialog.title,visible:e.detailDialog.visible},on:{"update:visible":function(t){return e.$set(e.detailDialog,"visible",t)}}},[a("el-form",{ref:"dialogForm",attrs:{model:e.dialogForm,rules:e.dialogRules,size:"small",disabled:"view"===e.detailDialog.type,"label-width":"155px"}},[a("el-form-item",{attrs:{label:"应用名(appID)",prop:"app"}},[a("el-select",{attrs:{placeholder:"请选择调用方",filterable:"",clearable:""},model:{value:e.dialogForm.app,callback:function(t){e.$set(e.dialogForm,"app",t)},expression:"dialogForm.app"}},e._l(e.appOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label+"("+e.value+")",value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"前端服务名",prop:"service"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:""},model:{value:e.dialogForm.service,callback:function(t){e.$set(e.dialogForm,"service",t)},expression:"dialogForm.service"}},e._l(e.frontendServiceOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"前端API路径",prop:"path"}},[a("el-input",{attrs:{placeholder:"请输入前端API路径",clearable:""},model:{value:e.dialogForm.path,callback:function(t){e.$set(e.dialogForm,"path",t)},expression:"dialogForm.path"}}),a("span",{staticClass:"key-tips"},[e._v("如果接口URL为http://网关IP:port/proxy/user-service/user/list, 则输入/user/list，如果不配置路径则按服务限流")])],1),a("el-form-item",{attrs:{label:"集群共享QPS",prop:"qps"}},[a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"num-tips"},[e._v(e._s(e.dialogForm.qps*e.machineCount||""))]),a("span",[e._v("  =  ")]),a("el-input",{staticStyle:{width:"180px"},attrs:{clearable:""},model:{value:e.dialogForm.qps,callback:function(t){e.$set(e.dialogForm,"qps",t)},expression:"dialogForm.qps"}}),a("span",[e._v("（单机）* "+e._s(e.machineCount))])],1)]),a("el-form-item",{attrs:{label:"集群共享并发数",prop:"concurrent"}},[a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"num-tips"},[e._v(e._s(e.dialogForm.concurrent*e.machineCount||""))]),a("span",[e._v("  =  ")]),a("el-input",{staticStyle:{width:"180px"},attrs:{clearable:""},model:{value:e.dialogForm.concurrent,callback:function(t){e.$set(e.dialogForm,"concurrent",t)},expression:"dialogForm.concurrent"}}),a("span",[e._v("（单机）* "+e._s(e.machineCount))])],1)]),a("el-form-item",{attrs:{label:"限流响应ContentType:",prop:"responseContentType"}},[a("el-input",{attrs:{placeholder:"请输入ContentType",clearable:""},model:{value:e.dialogForm.responseContentType,callback:function(t){e.$set(e.dialogForm,"responseContentType",t)},expression:"dialogForm.responseContentType"}}),a("span",{staticClass:"key-tips"},[e._v("如果不配置则使用默认规则里的限流响应ContentType")])],1),a("el-form-item",{attrs:{label:"限流响应报文：",prop:"responseContent"}},[a("el-input",{attrs:{type:"textarea",rows:"5",placeholder:"请输入响应报文",clearable:""},model:{value:e.dialogForm.responseContent,callback:function(t){e.$set(e.dialogForm,"responseContent",t)},expression:"dialogForm.responseContent"}}),a("span",{staticClass:"key-tips"},[e._v("如果不配置则使用默认规则里的限流响应报文")])],1)],1),"view"!==e.detailDialog.type?a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small",loading:e.detailDialog.loading},on:{click:e.submitForm}},[e._v("提 交\n      ")]),a("el-button",{attrs:{size:"small"},on:{click:function(t){e.detailDialog.visible=!1}}},[e._v("取 消")])],1):e._e()],1)],1)},o=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("6762"),a("2fdb"),a("ade3")),i=a("b5c6"),l=a("da71");function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){Object(n["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var p=function(e,t,a){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/app/list"),method:"get",params:c(c({},a),{},{current:e,size:t})})},u=function(e){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/app/detail/").concat(e),method:"get"})},d=function(e){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/app/remove"),method:"post",params:{ids:e}})},f=function(e){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/app/save"),method:"post",data:e})},g=function(e){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/app/update"),method:"post",data:e})},b=a("6be7"),m=a("5880"),h=a("16cd");function v(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function y(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?v(Object(a),!0).forEach((function(t){Object(n["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):v(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var D={name:"flow-appid",data:function(){return{form:{},search:{},query:{},loading:!0,page:{pageSize:10,currentPage:1,total:0},option:{dialogWidth:900,border:!0,index:!0,dialogClickModal:!1,columnBtn:!1,menuPosition:"right",searchLabelWidth:95,column:[{label:"应用名(appID)",prop:"app",search:!0,searchslot:!0,searchLabelWidth:110},{label:"前端服务名",prop:"service",search:!0,searchslot:!0,searchSpan:8},{label:"前端API路径",prop:"path",search:!0},{label:"单机QPS",prop:"qps"},{label:"单机并发数",prop:"concurrent"}]},data:[],globalData:{},dialogForm:{},dialogRules:{app:[{required:!0,message:"必填",trigger:"change"}],path:[{pattern:/^[^\u4e00-\u9fa5]+$/,message:"请勿输入中文字符",trigger:"blur"},{pattern:/^(\/)+/,message:"请参照例子正确填写路径, 开头不可缺少 '/' 符号",trigger:"blur"}],qps:[{pattern:/^[1-9][0-9]*$/,message:"请输入大于0的整数",trigger:"blur"}],concurrent:[{pattern:/^[1-9][0-9]*$/,message:"请输入大于0的整数",trigger:"blur"}]},detailDialog:{visible:!1,title:"详情",type:"",loading:!1}}},computed:y(y({},Object(m["mapGetters"])(["permission","frontendServiceOptions","appOptions"])),{},{machineCount:function(){return this.globalData.machineCount||0}}),watch:{data:function(){var e=this;this.$nextTick((function(){e.$refs.crud.refreshTable()}))}},created:function(){this.getGlobalRule(),this.getFrontendServiceOptions(),this.getAppOptions()},methods:y(y({},Object(m["mapActions"])(["getFrontendServiceOptions","getAppOptions"])),{},{getGlobalRule:function(){var e=this;Object(b["a"])().then((function(t){var a=t.data.data;e.globalData=a||{}}))},submitForm:function(){var e=this;this.$refs.dialogForm.validate((function(t){if(t){var a=Object(h["b"])(e.dialogForm);if(!a.qps&&!a.concurrent)return e.$message.error("单机QPS、单机并发数，请至少填写一个"),!1;"edit"===e.detailDialog.type?e.rowUpdate(a):e.rowSave(a)}}))},rowSave:function(e){var t=this;this.detailDialog.loading=!0,f(e).then((function(){t.onLoad(t.page),t.$message({type:"success",message:"保存成功"}),t.detailDialog.visible=!1}),(function(e){window.console.log(e)})).finally((function(){t.detailDialog.loading=!1}))},rowUpdate:function(e){var t=this;this.detailDialog.loading=!0,g(e).then((function(){t.onLoad(t.page),t.$message({type:"success",message:"修改成功"}),t.detailDialog.visible=!1}),(function(e){window.console.log(e)})).finally((function(){t.detailDialog.loading=!1}))},rowDel:function(e){var t=this;this.$confirm("你确定要删除此流控规则吗?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return d(e.id)})).then((function(){t.onLoad(t.page),t.$message({type:"success",message:"删除成功"})}))},beforeOpen:function(e,t){var a=this;switch(this.dialogForm={},this.detailDialog.type=t,t){case"add":this.detailDialog.title="新增";break;case"edit":this.detailDialog.title="编辑";break;case"view":this.detailDialog.title="查看";break;default:this.detailDialog.title="详情";break}["edit","view"].includes(t)?u(this.form.id).then((function(e){a.form=e.data.data,a.dialogForm=Object.assign({},e.data.data||{}),a.detailDialog.visible=!0})):this.detailDialog.visible=!0},searchReset:function(){this.query={},this.onLoad(this.page)},searchChange:function(e,t){this.query=e,this.page.currentPage=1,this.onLoad(this.page,e),t()},currentChange:function(e){this.page.currentPage=e},sizeChange:function(e){this.page.pageSize=e},refreshChange:function(){this.onLoad(this.page,this.query)},onLoad:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,p(e.currentPage,e.pageSize,Object.assign(a,this.query)).then((function(e){var a=e.data.data;t.page.total=a.total,t.data=a.records,t.loading=!1}))}})},O=D,w=(a("980c"),a("2877")),C=Object(w["a"])(O,r,o,!1,null,"9add8536",null);t["default"]=C.exports},"980c":function(e,t,a){"use strict";a("de00e")},"980c4":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("basic-container",[a("el-card",[a("div",{staticClass:"flow-default-header clearfix",attrs:{slot:"header"},slot:"header"},[a("b",[e._v("单机全局规则")]),a("el-button",{attrs:{size:"mini",type:"primary",disabled:e.editing},on:{click:function(t){e.editing=!0}}},[e._v("编辑")])],1),a("el-form",{ref:"formData",attrs:{model:e.formData,rules:e.rules,disabled:!e.editing,size:"small","label-width":"155px"}},[a("el-form-item",{attrs:{label:"全局配置:",prop:"globalEnabled"}},[a("div",{attrs:{slot:"label"},slot:"label"},[e._v("\n          全局配置\n          "),a("el-tooltip",{attrs:{placement:"top-start"}},[a("div",{attrs:{slot:"content"},slot:"content"},[e._v("\n              全局配置对整个节点进行流量控制。"),a("br"),e._v("\n              例如配置 集群共享并发数：2000=1000（单机）* 2，"),a("br"),e._v("\n              当单个节点的所有请求并发数超过 1000 时，会被限流。"),a("br")]),a("i",{staticClass:"el-icon-question"})]),e._v("\n          :\n        ")],1),a("el-checkbox",{model:{value:e.formData.globalEnabled,callback:function(t){e.$set(e.formData,"globalEnabled",t)},expression:"formData.globalEnabled"}},[e._v("启用")])],1),e.formData.globalEnabled?a("div",{staticStyle:{"padding-left":"115px"}},[a("el-form-item",{attrs:{label:"集群共享并发数:",prop:"globalConcurrent"}},[a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"num-tips"},[e._v(e._s(e.formData.globalConcurrent*e.machineCount||""))]),a("span",[e._v("  =  ")]),a("el-input",{staticClass:"number-input",attrs:{clearable:""},model:{value:e.formData.globalConcurrent,callback:function(t){e.$set(e.formData,"globalConcurrent",t)},expression:"formData.globalConcurrent"}}),a("span",[e._v("（单机）* "+e._s(e.machineCount))])],1)]),a("el-form-item",{attrs:{label:"集群共享QPS:",prop:"globalQps"}},[a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"num-tips"},[e._v(e._s(e.formData.globalQps*e.machineCount||""))]),a("span",[e._v("  =  ")]),a("el-input",{staticClass:"number-input",attrs:{clearable:""},model:{value:e.formData.globalQps,callback:function(t){e.$set(e.formData,"globalQps",t)},expression:"formData.globalQps"}}),a("span",[e._v("（单机）* "+e._s(e.machineCount))])],1)])],1):e._e(),a("el-form-item",{attrs:{label:"服务默认配置:",prop:"serviceDefaultEnabled"}},[a("el-checkbox",{model:{value:e.formData.serviceDefaultEnabled,callback:function(t){e.$set(e.formData,"serviceDefaultEnabled",t)},expression:"formData.serviceDefaultEnabled"}},[e._v("启用")])],1),e.formData.serviceDefaultEnabled?a("div",{staticStyle:{"padding-left":"115px"}},[a("el-form-item",{attrs:{label:"集群共享并发数:",prop:"serviceDefaultConcurrent"}},[a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"num-tips"},[e._v(e._s(e.formData.serviceDefaultConcurrent*e.machineCount||""))]),a("span",[e._v("  =  ")]),a("el-input",{staticClass:"number-input",attrs:{clearable:""},model:{value:e.formData.serviceDefaultConcurrent,callback:function(t){e.$set(e.formData,"serviceDefaultConcurrent",t)},expression:"formData.serviceDefaultConcurrent"}}),a("span",[e._v("（单机）* "+e._s(e.machineCount))])],1)]),a("el-form-item",{attrs:{label:"集群共享QPS:",prop:"serviceDefaultQps"}},[a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"num-tips"},[e._v(e._s(e.formData.serviceDefaultQps*e.machineCount||""))]),a("span",[e._v("  =  ")]),a("el-input",{staticClass:"number-input",attrs:{clearable:""},model:{value:e.formData.serviceDefaultQps,callback:function(t){e.$set(e.formData,"serviceDefaultQps",t)},expression:"formData.serviceDefaultQps"}}),a("span",[e._v("（单机）* "+e._s(e.machineCount))])],1)])],1):e._e(),a("el-form-item",{attrs:{label:"appid默认配置:",prop:"appIdDefaultEnabled"}},[a("el-checkbox",{model:{value:e.formData.appIdDefaultEnabled,callback:function(t){e.$set(e.formData,"appIdDefaultEnabled",t)},expression:"formData.appIdDefaultEnabled"}},[e._v("启用")])],1),e.formData.appIdDefaultEnabled?a("div",{staticStyle:{"padding-left":"115px"}},[a("el-form-item",{attrs:{label:"集群共享并发数:",prop:"appIdDefaultConcurrent"}},[a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"num-tips"},[e._v(e._s(e.formData.appIdDefaultConcurrent*e.machineCount||""))]),a("span",[e._v("  =  ")]),a("el-input",{staticClass:"number-input",attrs:{clearable:""},model:{value:e.formData.appIdDefaultConcurrent,callback:function(t){e.$set(e.formData,"appIdDefaultConcurrent",t)},expression:"formData.appIdDefaultConcurrent"}}),a("span",[e._v("（单机）* "+e._s(e.machineCount))])],1)]),a("el-form-item",{attrs:{label:"集群共享QPS:",prop:"appIdDefaultQps"}},[a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"num-tips"},[e._v(e._s(e.formData.appIdDefaultQps*e.machineCount||""))]),a("span",[e._v("  =  ")]),a("el-input",{staticClass:"number-input",attrs:{clearable:""},model:{value:e.formData.appIdDefaultQps,callback:function(t){e.$set(e.formData,"appIdDefaultQps",t)},expression:"formData.appIdDefaultQps"}}),a("span",[e._v("（单机）* "+e._s(e.machineCount))])],1)])],1):e._e(),a("el-form-item",{attrs:{label:"限流响应ContentType:",prop:"responseContentType"}},[a("el-input",{attrs:{placeholder:"请输入ContentType",clearable:""},model:{value:e.formData.responseContentType,callback:function(t){e.$set(e.formData,"responseContentType",t)},expression:"formData.responseContentType"}})],1),a("el-form-item",{attrs:{label:"限流响应报文：",prop:"responseContent"}},[a("el-input",{attrs:{type:"textarea",rows:"5",placeholder:"请输入响应报文",clearable:""},model:{value:e.formData.responseContent,callback:function(t){e.$set(e.formData,"responseContent",t)},expression:"formData.responseContent"}})],1)],1),e.editing?a("footer",[a("el-button",{attrs:{type:"primary",size:"small",loading:e.loading},on:{click:e.submitForm}},[e._v("提 交\n      ")]),a("el-button",{attrs:{size:"small"},on:{click:e.cancelForm}},[e._v("取 消")])],1):e._e()],1)],1)},o=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("ade3")),i=a("6be7"),l=a("5880"),s=a("16cd");function c(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function p(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?c(Object(a),!0).forEach((function(t){Object(n["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):c(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var u={name:"flow-default",data:function(){return{editing:!1,loading:!1,formData:{},data:{},rules:{globalConcurrent:[{pattern:/^[1-9][0-9]*$/,message:"请输入大于0的整数",trigger:"blur"}],globalQps:[{pattern:/^[1-9][0-9]*$/,message:"请输入大于0的整数",trigger:"blur"}],serviceDefaultConcurrent:[{pattern:/^[1-9][0-9]*$/,message:"请输入大于0的整数",trigger:"blur"}],serviceDefaultQps:[{pattern:/^[1-9][0-9]*$/,message:"请输入大于0的整数",trigger:"blur"}],appIdDefaultConcurrent:[{pattern:/^[1-9][0-9]*$/,message:"请输入大于0的整数",trigger:"blur"}],appIdDefaultQps:[{pattern:/^[1-9][0-9]*$/,message:"请输入大于0的整数",trigger:"blur"}]}}},computed:p(p({},Object(l["mapGetters"])(["permission"])),{},{machineCount:function(){return this.formData.machineCount||0}}),watch:{},created:function(){this.initData()},methods:{getGlobalRule:function(){var e=this;Object(i["a"])().then((function(t){var a=t.data.data;e.data=a||{},e.formData=Object.assign({},a)}))},cancelForm:function(){this.formData=Object.assign({},this.data),this.editing=!1},submitForm:function(){var e=this;this.$refs.formData.validate((function(t){if(t){if(e.formData.globalEnabled&&!e.formData.globalConcurrent&&!e.formData.globalQps)return e.$message.error("全局配置启用时, 需要设置单机QPS或单机并发数"),!1;if(e.formData.serviceDefaultEnabled&&!e.formData.serviceDefaultConcurrent&&!e.formData.serviceDefaultQps)return e.$message.error("服务默认配置启用时, 需要设置单机QPS或单机并发数"),!1;if(e.formData.appIdDefaultEnabled&&!e.formData.appIdDefaultConcurrent&&!e.formData.appIdDefaultQps)return e.$message.error("appID默认配置启用时, 需要设置单机QPS或单机并发数"),!1;var a=Object(s["b"])(e.formData);e.loading=!0,Object(i["b"])(a).then((function(){e.$message({type:"success",message:"保存成功"}),e.initData(),e.loading=!1,e.editing=!1})).catch((function(){e.loading=!1}))}}))},initData:function(){this.getGlobalRule()}}},d=u,f=(a("f72d"),a("2877")),g=Object(f["a"])(d,r,o,!1,null,"eeaacc02",null);t["default"]=g.exports},"9d9e":function(e,t,a){},c42a:function(e,t,a){"use strict";a("62bb")},d2bd:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("basic-container",[a("avue-crud",{ref:"crud",attrs:{"before-open":e.beforeOpen,data:e.data,page:e.page,search:e.search,option:e.option,"table-loading":e.loading,permission:e.permissionList},on:{"update:page":function(t){e.page=t},"update:search":function(t){e.search=t},"row-del":e.rowDel,"row-update":e.rowUpdate,"row-save":e.rowSave,"search-change":e.searchChange,"search-reset":e.searchReset,"current-change":e.currentChange,"size-change":e.sizeChange,"refresh-change":e.refreshChange,"on-load":e.onLoad},scopedSlots:e._u([{key:"serviceSearch",fn:function(t){return[a("el-select",{attrs:{filterable:"",clearable:""},model:{value:e.search.service,callback:function(t){e.$set(e.search,"service",t)},expression:"search.service"}},e._l(e.frontendServiceOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)]}}]),model:{value:e.form,callback:function(t){e.form=t},expression:"form"}}),a("el-dialog",{attrs:{"append-to-body":"",width:"900px","close-on-click-modal":!1,title:e.detailDialog.title,visible:e.detailDialog.visible},on:{"update:visible":function(t){return e.$set(e.detailDialog,"visible",t)}}},[a("el-form",{ref:"dialogForm",attrs:{model:e.dialogForm,rules:e.dialogRules,size:"small",disabled:"view"===e.detailDialog.type,"label-width":"155px"}},[a("el-form-item",{attrs:{label:"来源IP",prop:"ip"}},[a("el-input",{staticStyle:{width:"193px"},attrs:{placeholder:"请输入来源IP",clearable:""},model:{value:e.dialogForm.ip,callback:function(t){e.$set(e.dialogForm,"ip",t)},expression:"dialogForm.ip"}})],1),a("el-form-item",{attrs:{label:"前端服务名",prop:"service"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:""},model:{value:e.dialogForm.service,callback:function(t){e.$set(e.dialogForm,"service",t)},expression:"dialogForm.service"}},e._l(e.frontendServiceOptions,(function(e,t){return a("el-option",{key:t,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{attrs:{label:"前端API路径",prop:"path"}},[a("el-input",{attrs:{placeholder:"请输入前端API路径",clearable:""},model:{value:e.dialogForm.path,callback:function(t){e.$set(e.dialogForm,"path",t)},expression:"dialogForm.path"}}),a("span",{staticClass:"key-tips"},[e._v("如果接口URL为http://网关IP:port/proxy/user-service/user/list, 则输入/user/list，如果不配置路径则按服务限流")])],1),a("el-form-item",{attrs:{label:"集群共享QPS",prop:"qps"}},[a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"num-tips"},[e._v(e._s(e.dialogForm.qps*e.machineCount||""))]),a("span",[e._v("  =  ")]),a("el-input",{staticStyle:{width:"180px"},attrs:{clearable:""},model:{value:e.dialogForm.qps,callback:function(t){e.$set(e.dialogForm,"qps",t)},expression:"dialogForm.qps"}}),a("span",[e._v("（单机）* "+e._s(e.machineCount))])],1)]),a("el-form-item",{attrs:{label:"集群共享并发数",prop:"concurrent"}},[a("div",{staticStyle:{display:"flex"}},[a("div",{staticClass:"num-tips"},[e._v(e._s(e.dialogForm.concurrent*e.machineCount||""))]),a("span",[e._v("  =  ")]),a("el-input",{staticStyle:{width:"180px"},attrs:{clearable:""},model:{value:e.dialogForm.concurrent,callback:function(t){e.$set(e.dialogForm,"concurrent",t)},expression:"dialogForm.concurrent"}}),a("span",[e._v("（单机）* "+e._s(e.machineCount))])],1)]),a("el-form-item",{attrs:{label:"限流响应ContentType:",prop:"responseContentType"}},[a("el-input",{attrs:{placeholder:"请输入ContentType",clearable:""},model:{value:e.dialogForm.responseContentType,callback:function(t){e.$set(e.dialogForm,"responseContentType",t)},expression:"dialogForm.responseContentType"}}),a("span",{staticClass:"key-tips"},[e._v("如果不配置则使用默认规则里的限流响应ContentType")])],1),a("el-form-item",{attrs:{label:"限流响应报文：",prop:"responseContent"}},[a("el-input",{attrs:{type:"textarea",rows:"5",placeholder:"请输入响应报文",clearable:""},model:{value:e.dialogForm.responseContent,callback:function(t){e.$set(e.dialogForm,"responseContent",t)},expression:"dialogForm.responseContent"}}),a("span",{staticClass:"key-tips"},[e._v("如果不配置则使用默认规则里的限流响应报文")])],1)],1),"view"!==e.detailDialog.type?a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small",loading:e.detailDialog.loading},on:{click:e.submitForm}},[e._v("提 交\n      ")]),a("el-button",{attrs:{size:"small"},on:{click:function(t){e.detailDialog.visible=!1}}},[e._v("取 消")])],1):e._e()],1)],1)},o=[],n=(a("8e6e"),a("ac6a"),a("456d"),a("6762"),a("2fdb"),a("ade3")),i=a("b5c6"),l=a("da71");function s(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function c(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?s(Object(a),!0).forEach((function(t){Object(n["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):s(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var p=function(e,t,a){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/ip/list"),method:"get",params:c(c({},a),{},{current:e,size:t})})},u=function(e){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/ip/detail/").concat(e),method:"get"})},d=function(e){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/ip/remove"),method:"post",params:{ids:e}})},f=function(e){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/ip/save"),method:"post",data:e})},g=function(e){return Object(i["a"])({url:"".concat(l["a"],"/flow-control-rule/ip/update"),method:"post",data:e})},b=a("6be7"),m=a("5880"),h=a("16cd"),v=a("c54a");function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function D(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(Object(a),!0).forEach((function(t){Object(n["a"])(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}var O={name:"flow-ip",data:function(){return{form:{},search:{},query:{},loading:!0,page:{pageSize:10,currentPage:1,total:0},option:{dialogWidth:900,border:!0,index:!0,dialogClickModal:!1,columnBtn:!1,menuPosition:"right",searchLabelWidth:95,column:[{label:"来源IP",prop:"ip",search:!0},{label:"前端服务名",prop:"service",search:!0,searchslot:!0,searchSpan:8},{label:"前端API路径",prop:"path",search:!0},{label:"单机QPS",prop:"qps"},{label:"单机并发数",prop:"concurrent"}]},data:[],globalData:{},dialogForm:{},dialogRules:{ip:[{required:!0,message:"必填",trigger:"blur"},{validator:function(e,t,a){t&&!Object(v["j"])(Object(h["a"])(t))?a(new Error("请输入正确的IP")):a()},trigger:"blur"}],path:[{pattern:/^[^\u4e00-\u9fa5]+$/,message:"请勿输入中文字符",trigger:"blur"},{pattern:/^(\/)+/,message:"请参照例子正确填写路径, 开头不可缺少 '/' 符号",trigger:"blur"}],qps:[{pattern:/^[1-9][0-9]*$/,message:"请输入大于0的整数",trigger:"blur"}],concurrent:[{pattern:/^[1-9][0-9]*$/,message:"请输入大于0的整数",trigger:"blur"}]},detailDialog:{visible:!1,title:"详情",type:"",loading:!1}}},computed:D(D({},Object(m["mapGetters"])(["permission","frontendServiceOptions"])),{},{machineCount:function(){return this.globalData.machineCount||0}}),watch:{data:function(){var e=this;this.$nextTick((function(){e.$refs.crud.refreshTable()}))}},created:function(){this.getGlobalRule(),this.getFrontendServiceOptions()},methods:D(D({},Object(m["mapActions"])(["getFrontendServiceOptions"])),{},{getGlobalRule:function(){var e=this;Object(b["a"])().then((function(t){var a=t.data.data;e.globalData=a||{}}))},submitForm:function(){var e=this;this.$refs.dialogForm.validate((function(t){if(t){var a=Object(h["b"])(e.dialogForm);if(!a.qps&&!a.concurrent)return e.$message.error("单机QPS、单机并发数，请至少填写一个"),!1;"edit"===e.detailDialog.type?e.rowUpdate(a):e.rowSave(a)}}))},rowSave:function(e){var t=this;this.detailDialog.loading=!0,f(e).then((function(){t.onLoad(t.page),t.$message({type:"success",message:"保存成功"}),t.detailDialog.visible=!1}),(function(e){window.console.log(e)})).finally((function(){t.detailDialog.loading=!1}))},rowUpdate:function(e){var t=this;this.detailDialog.loading=!0,g(e).then((function(){t.onLoad(t.page),t.$message({type:"success",message:"修改成功"}),t.detailDialog.visible=!1}),(function(e){window.console.log(e)})).finally((function(){t.detailDialog.loading=!1}))},rowDel:function(e){var t=this;this.$confirm("你确定要删除此流控规则吗?",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){return d(e.id)})).then((function(){t.onLoad(t.page),t.$message({type:"success",message:"删除成功"})}))},beforeOpen:function(e,t){var a=this;switch(this.dialogForm={},this.detailDialog.type=t,t){case"add":this.detailDialog.title="新增";break;case"edit":this.detailDialog.title="编辑";break;case"view":this.detailDialog.title="查看";break;default:this.detailDialog.title="详情";break}["edit","view"].includes(t)?u(this.form.id).then((function(e){a.form=e.data.data,a.dialogForm=Object.assign({},e.data.data||{}),a.detailDialog.visible=!0})):this.detailDialog.visible=!0},searchReset:function(){this.query={},this.onLoad(this.page)},searchChange:function(e,t){this.query=e,this.page.currentPage=1,this.onLoad(this.page,e),t()},currentChange:function(e){this.page.currentPage=e},sizeChange:function(e){this.page.pageSize=e},refreshChange:function(){this.onLoad(this.page,this.query)},onLoad:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.loading=!0,p(e.currentPage,e.pageSize,Object.assign(a,this.query)).then((function(e){var a=e.data.data;t.page.total=a.total,t.data=a.records,t.loading=!1}))}})},w=O,C=(a("f458"),a("2877")),j=Object(C["a"])(w,r,o,!1,null,"86674b7c",null);t["default"]=j.exports},de00e:function(e,t,a){},ed02:function(e,t,a){},f458:function(e,t,a){"use strict";a("9d9e")},f72d:function(e,t,a){"use strict";a("ed02")}}]);